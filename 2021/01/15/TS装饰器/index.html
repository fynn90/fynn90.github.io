<!DOCTYPE html>
<html lang="zh-cn">
  <head>
    
<meta charset="UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=edge" />
<meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1"/>


<meta http-equiv="Cache-Control" content="no-transform" />
<meta http-equiv="Cache-Control" content="no-siteapp" />

<meta name="theme-color" content="#f8f5ec" />
<meta name="msapplication-navbutton-color" content="#f8f5ec">
<meta name="apple-mobile-web-app-capable" content="yes">
<meta name="apple-mobile-web-app-status-bar-style" content="#f8f5ec">



  <meta name="description" content="TSè£…é¥°å™¨"/>




  <meta name="keywords" content="decorator, Fynn's Blog" />










  <link rel="alternate" href="/atom.xml" title="Fynn's Blog" type="application/atom+xml">




  <link rel="shortcut icon" type="image/x-icon" href="/favicon.ico?v=2.6.0" />



<link rel="canonical" href="https://fynn90.github.io/2021/01/15/TSè£…é¥°å™¨/"/>


<link rel="stylesheet" type="text/css" href="/css/style.css?v=2.6.0" />



  <link rel="stylesheet" type="text/css" href="/lib/fancybox/jquery.fancybox.css" />




  
  <script id="baidu_analytics">
    var _hmt = _hmt || [];
    (function() {
      var hm = document.createElement("script");
      hm.src = "https://hm.baidu.com/hm.js?607980a031d3edcefed502ce80e77ffb";
      var s = document.getElementsByTagName("script")[0];
      s.parentNode.insertBefore(hm, s);
    })();
  </script>



  <script id="google_analytics">
    (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
        (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
        m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
        })(window,document,'script','//www.google-analytics.com/analytics.js','ga');

        ga('create', 'UA-115728733-1', 'auto');
        ga('send', 'pageview');
  </script>


  <script id="baidu_push">
(function(){
    var bp = document.createElement('script');
    var curProtocol = window.location.protocol.split(':')[0];
    if (curProtocol === 'https') {
        bp.src = 'https://zz.bdstatic.com/linksubmit/push.js';
    }
    else {
        bp.src = 'http://push.zhanzhang.baidu.com/push.js';
    }
    var s = document.getElementsByTagName("script")[0];
    s.parentNode.insertBefore(bp, s);
})();
</script>





  <script src="//cdn1.lncld.net/static/js/3.1.1/av-min.js"></script>
  <script id="leancloud">
    AV.init({
      appId: "jH321kB4p1r5FNrL8YBCwbrG-gzGzoHsz",
      appKey: "Q8vnaBtTzmVPbVX8tdzM7z7w"
    });
  </script>





    <title> TSè£…é¥°å™¨ - Fynn's Blog </title>
  <meta name="generator" content="Hexo 5.4.0"></head>

  <body><div id="mobile-navbar" class="mobile-navbar">
  <div class="mobile-header-logo">
    <a href="/." class="logo">Fynn's Blog</a>
  </div>
  <div class="mobile-navbar-icon">
    <span></span>
    <span></span>
    <span></span>
  </div>
</div>

<nav id="mobile-menu" class="mobile-menu slideout-menu">
  <ul class="mobile-menu-list">
    
      <a href="/">
        <li class="mobile-menu-item">
          
          
            é¦–é¡µ
          
        </li>
      </a>
    
      <a href="/archives/">
        <li class="mobile-menu-item">
          
          
            å½’æ¡£
          
        </li>
      </a>
    
      <a href="/categories/">
        <li class="mobile-menu-item">
          
          
            åˆ†ç±»
          
        </li>
      </a>
    
  </ul>
</nav>

    <div class="container" id="mobile-panel">
      <header id="header" class="header"><div class="logo-wrapper">
  <a href="/." class="logo">Fynn's Blog</a>
</div>

<nav class="site-navbar">
  
    <ul id="menu" class="menu">
      
        <li class="menu-item">
          <a class="menu-item-link" href="/">
            
            
              é¦–é¡µ
            
          </a>
        </li>
      
        <li class="menu-item">
          <a class="menu-item-link" href="/archives/">
            
            
              å½’æ¡£
            
          </a>
        </li>
      
        <li class="menu-item">
          <a class="menu-item-link" href="/categories/">
            
            
              åˆ†ç±»
            
          </a>
        </li>
      
    </ul>
  
</nav>

      </header>

      <main id="main" class="main">
        <div class="content-wrapper">
          <div id="content" class="content">
            
  
  <article class="post">
    <header class="post-header">
      <h1 class="post-title">
        
          TSè£…é¥°å™¨
        
      </h1>

      <div class="post-meta">
        <span class="post-time">
          2021-01-15
        </span>
        
          <div class="post-category">
            
              <a href="/categories/TypeScript/">TypeScript</a>
            
          </div>
        
        
        <div class="post-visits"
             data-url="/2021/01/15/TS%E8%A3%85%E9%A5%B0%E5%99%A8/"
             data-title="TSè£…é¥°å™¨">
            é˜…è¯»æ¬¡æ•°
          </div>
        
      </div>
    </header>

    
    
  <div class="post-toc" id="post-toc">
    <h2 class="post-toc-title">æ–‡ç« ç›®å½•</h2>
    <div class="post-toc-content">
      <ol class="toc"><li class="toc-item toc-level-2"><a class="toc-link" href="#%E4%B8%BA%E4%BB%80%E4%B9%88%E9%9C%80%E8%A6%81%E8%A3%85%E9%A5%B0%E5%99%A8"><span class="toc-text">ä¸ºä»€ä¹ˆéœ€è¦è£…é¥°å™¨</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#%E6%B2%A1%E6%9C%89%E4%BD%BF%E7%94%A8%E8%A3%85%E9%A5%B0%E5%99%A8%E6%96%B9%E5%BC%8F"><span class="toc-text">æ²¡æœ‰ä½¿ç”¨è£…é¥°å™¨æ–¹å¼</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E4%BD%BF%E7%94%A8%E8%A3%85%E9%A5%B0%E5%99%A8%E7%9A%84%E6%96%B9%E5%BC%8F"><span class="toc-text">ä½¿ç”¨è£…é¥°å™¨çš„æ–¹å¼</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E8%A3%85%E9%A5%B0%E5%99%A8%E5%87%BD%E6%95%B0%E6%89%A7%E8%A1%8C%E6%97%B6%E6%9C%BA"><span class="toc-text">è£…é¥°å™¨å‡½æ•°æ‰§è¡Œæ—¶æœº</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E5%A6%82%E4%BD%95%E5%90%AF%E7%94%A8"><span class="toc-text">å¦‚ä½•å¯ç”¨</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E8%A3%85%E9%A5%B0%E5%99%A8%E7%A7%8D%E7%B1%BB"><span class="toc-text">è£…é¥°å™¨ç§ç±»</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#Typescript-%E4%B8%AD%E7%9A%84-Decorator-%E7%AD%BE%E5%90%8D"><span class="toc-text">Typescript ä¸­çš„ Decorator ç­¾å</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#Class-%E8%A3%85%E9%A5%B0%E5%99%A8"><span class="toc-text">Class è£…é¥°å™¨</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#%E6%89%A9%E5%B1%95%E6%9E%84%E9%80%A0%E5%87%BD%E6%95%B0"><span class="toc-text">æ‰©å±•æ„é€ å‡½æ•°</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E4%BF%AE%E6%94%B9%E5%8E%9F%E6%9C%89%E5%B1%9E%E6%80%A7%E7%9A%84%E6%8F%8F%E8%BF%B0%E7%AC%A6"><span class="toc-text">ä¿®æ”¹åŸæœ‰å±æ€§çš„æè¿°ç¬¦</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E4%BD%BF%E7%94%A8%E9%97%AD%E5%8C%85%E6%9D%A5%E5%A2%9E%E5%BC%BA%E8%A3%85%E9%A5%B0%E5%99%A8%E7%9A%84%E5%8A%9F%E8%83%BD"><span class="toc-text">ä½¿ç”¨é—­åŒ…æ¥å¢å¼ºè£…é¥°å™¨çš„åŠŸèƒ½</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E8%A6%86%E7%9B%96%E6%97%A7%E7%9A%84%E6%9E%84%E9%80%A0%E5%87%BD%E6%95%B0"><span class="toc-text">è¦†ç›–æ—§çš„æ„é€ å‡½æ•°</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E5%A4%9A%E4%B8%AA%E8%A3%85%E9%A5%B0%E5%99%A8%E7%9A%84%E5%BA%94%E7%94%A8"><span class="toc-text">å¤šä¸ªè£…é¥°å™¨çš„åº”ç”¨</span></a></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#Method-%E8%A3%85%E9%A5%B0%E5%99%A8"><span class="toc-text">Method è£…é¥°å™¨</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#%E6%96%B9%E6%A1%88%E4%B8%80-%E4%BF%AE%E6%94%B9%E7%8E%B0%E6%9C%89%E6%8F%8F%E8%BF%B0%E7%AC%A6"><span class="toc-text">æ–¹æ¡ˆä¸€ ä¿®æ”¹ç°æœ‰æè¿°ç¬¦</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E6%96%B9%E6%A1%88%E4%BA%8C-%E8%BF%94%E5%9B%9E%E6%96%B0%E7%9A%84value%E6%8F%8F%E8%BF%B0%E7%AC%A6"><span class="toc-text">æ–¹æ¡ˆäºŒ è¿”å›æ–°çš„valueæè¿°ç¬¦</span></a></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#Property-%E8%A3%85%E9%A5%B0%E5%99%A8"><span class="toc-text">Property è£…é¥°å™¨</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#Parameter-%E8%A3%85%E9%A5%B0%E5%99%A8"><span class="toc-text">Parameter è£…é¥°å™¨</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E8%AE%BF%E9%97%AE%E7%AC%A6%E8%A3%85%E9%A5%B0%E5%99%A8"><span class="toc-text">è®¿é—®ç¬¦è£…é¥°å™¨</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E9%9D%99%E6%80%81%E7%B1%BB%E5%9E%8B%E5%92%8C%E5%AE%9E%E4%BE%8B%E7%B1%BB%E5%9E%8B"><span class="toc-text">é™æ€ç±»å‹å’Œå®ä¾‹ç±»å‹</span></a><ol class="toc-child"><li class="toc-item toc-level-5"><a class="toc-link" href="#%E4%BB%80%E4%B9%88%E6%98%AF%E9%9D%99%E6%80%81%E5%B1%9E%E6%80%A7%E5%92%8C%E5%AE%9E%E4%BE%8B%E5%B1%9E%E6%80%A7"><span class="toc-text">ä»€ä¹ˆæ˜¯é™æ€å±æ€§å’Œå®ä¾‹å±æ€§</span></a></li></ol></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E9%9D%99%E6%80%81%E5%B1%9E%E6%80%A7%E6%89%8B%E5%8A%A8%E8%8E%B7%E5%8F%96-descriptor"><span class="toc-text">é™æ€å±æ€§æ‰‹åŠ¨è·å– descriptor</span></a></li></ol></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E8%A3%85%E9%A5%B0%E5%99%A8%E6%89%A7%E8%A1%8C%E9%A1%BA%E5%BA%8F"><span class="toc-text">è£…é¥°å™¨æ‰§è¡Œé¡ºåº</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E8%A3%85%E9%A5%B0%E5%B7%A5%E5%8E%82%F0%9F%8F%AD"><span class="toc-text">è£…é¥°å·¥å‚ğŸ­</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E8%A3%85%E9%A5%B0%E5%99%A8%E7%9A%84%E5%BA%94%E7%94%A8"><span class="toc-text">è£…é¥°å™¨çš„åº”ç”¨</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#%E8%A3%85%E9%A5%B0%E5%99%A8%E4%BB%A3%E7%A0%81"><span class="toc-text">è£…é¥°å™¨ä»£ç </span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E6%8E%A7%E5%88%B6%E5%99%A8%E4%BB%A3%E7%A0%81"><span class="toc-text">æ§åˆ¶å™¨ä»£ç </span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E8%B7%AF%E7%94%B1%E5%99%A8%E4%BB%A3%E7%A0%81"><span class="toc-text">è·¯ç”±å™¨ä»£ç </span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%88%9B%E5%BB%BA%E8%B7%AF%E7%94%B1%E4%BB%A3%E7%A0%81"><span class="toc-text">åˆ›å»ºè·¯ç”±ä»£ç </span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#Refer-To"><span class="toc-text">Refer To</span></a></li></ol>
    </div>
  </div>


    <div class="post-content">
      
        <blockquote>
<p>è£…é¥°å™¨ï¼ˆDecoratorsï¼‰æ˜¯ä¸€ç§ç‰¹æ®Šçš„å£°æ˜ï¼Œå¯é™„åŠ åœ¨ç±»ã€æ–¹æ³•ã€è®¿é—®å™¨ã€å±æ€§ã€å‚æ•°å£°æ˜ä¸Šã€‚</p>
</blockquote>
<p>è£…é¥°å™¨ï¼ˆDecoratorsï¼‰å¯ä»¥é€šè¿‡<strong>éä¾µå…¥</strong>æ–¹å¼å¢å¼º<strong>ç±»</strong>ã€<strong>æ–¹æ³•</strong>ã€<strong>è®¿é—®å™¨</strong>ã€<strong>å±æ€§</strong>ã€<strong>å‚æ•°</strong>çš„èƒ½åŠ›ã€‚å¯ä»¥å°†ä¸šåŠ¡é€»è¾‘ä»£ç å’Œç‰¹æ®Šèƒ½åŠ›å’ŒæœåŠ¡çš„ä»£ç åˆ†å‰²å¼€æ¥ï¼Œä¿è¯ä»£ç çš„çµæ´»æ€§å’Œæ‰©å±•æ€§ï¼Œåˆç†çš„åˆ©ç”¨è£…é¥°å™¨å¯ä»¥æå¤§çš„æé«˜æˆ‘ä»¬çš„å¼€å‘æ•ˆç‡ã€‚</p>
<p><strong>æ³¨æ„ï¼š</strong> åŒæ ·çš„æ»¥ç”¨è£…é¥°å™¨ä¹Ÿä¼šä½¿ä»£ç æœ¬èº«é€»è¾‘å˜å¾—æ‰‘æœ”è¿·ç¦»ï¼Œå¦‚æœç¡®å®šä¸€æ®µä»£ç ä¸ä¼šåœ¨å…¶ä»–åœ°æ–¹ç”¨åˆ°ï¼Œæˆ–è€…ä¸€ä¸ªå‡½æ•°çš„æ ¸å¿ƒé€»è¾‘å°±æ˜¯è¿™äº›ä»£ç ï¼Œé‚£ä¹ˆå°±æ²¡æœ‰å¿…è¦å°†å®ƒå–å‡ºæ¥ä½œä¸ºä¸€ä¸ªè£…é¥°å™¨æ¥å­˜åœ¨ã€‚</p>
<h2 id="ä¸ºä»€ä¹ˆéœ€è¦è£…é¥°å™¨"><a href="#ä¸ºä»€ä¹ˆéœ€è¦è£…é¥°å™¨" class="headerlink" title="ä¸ºä»€ä¹ˆéœ€è¦è£…é¥°å™¨"></a>ä¸ºä»€ä¹ˆéœ€è¦è£…é¥°å™¨</h2><p>ä¾‹å¦‚ï¼š æˆ‘ä»¬æƒ³è®°å½•ä¸€ä¸ªæ–¹æ³•æ‰§è¡Œçš„è€—æ—¶</p>
<h3 id="æ²¡æœ‰ä½¿ç”¨è£…é¥°å™¨æ–¹å¼"><a href="#æ²¡æœ‰ä½¿ç”¨è£…é¥°å™¨æ–¹å¼" class="headerlink" title="æ²¡æœ‰ä½¿ç”¨è£…é¥°å™¨æ–¹å¼"></a>æ²¡æœ‰ä½¿ç”¨è£…é¥°å™¨æ–¹å¼</h3><figure class="highlight typescript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br></pre></td><td class="code"><pre><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Model1</span> </span>&#123;</span><br><span class="line">  <span class="function"><span class="title">getData</span>(<span class="params"></span>)</span> &#123;</span><br><span class="line">    <span class="keyword">let</span> start = <span class="keyword">new</span> <span class="built_in">Date</span>().valueOf()</span><br><span class="line">    <span class="keyword">try</span> &#123;</span><br><span class="line">      <span class="comment">// æ­¤å¤„çœç•¥è·å–æ•°æ®çš„é€»è¾‘</span></span><br><span class="line">      <span class="keyword">return</span> [&#123;</span><br><span class="line">        <span class="attr">id</span>: <span class="number">1</span>,</span><br><span class="line">        <span class="attr">name</span>: <span class="string">&#x27;Niko&#x27;</span></span><br><span class="line">      &#125;, &#123;</span><br><span class="line">        <span class="attr">id</span>: <span class="number">2</span>,</span><br><span class="line">        <span class="attr">name</span>: <span class="string">&#x27;Bellic&#x27;</span></span><br><span class="line">      &#125;]</span><br><span class="line">    &#125; <span class="keyword">finally</span> &#123;</span><br><span class="line">      <span class="keyword">let</span> end = <span class="keyword">new</span> <span class="built_in">Date</span>().valueOf()</span><br><span class="line">      <span class="built_in">console</span>.log(<span class="string">`start: <span class="subst">$&#123;start&#125;</span> end: <span class="subst">$&#123;end&#125;</span> consume: <span class="subst">$&#123;end - start&#125;</span>`</span>)</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// start: XXX end: XXX consume: XXX</span></span><br><span class="line"><span class="built_in">console</span>.log(<span class="keyword">new</span> Model1().getData())     <span class="comment">// [ &#123; id: 1, name: &#x27;Niko&#x27;&#125;, &#123; id: 2, name: &#x27;Bellic&#x27; &#125; ]</span></span><br><span class="line"><span class="comment">// start: XXX end: XXX consume: XXX</span></span><br><span class="line"><span class="built_in">console</span>.log(Model1.prototype.getData()) <span class="comment">// [ &#123; id: 1, name: &#x27;Niko&#x27;&#125;, &#123; id: 2, name: &#x27;Bellic&#x27; &#125; ]</span></span><br><span class="line"></span><br></pre></td></tr></table></figure>

<p>åœ¨ä¸Šé¢ä»£ç ä¸­ï¼Œ<code>getData</code>æ–¹æ³•ä¸­åŒ…å«äº†ä¸€äº›éä¸šåŠ¡çš„é€»è¾‘ä»£ç ã€‚è€Œè¿™äº›ä»£ç è¿˜æ˜¯ä¸å¯å¤ç”¨çš„ã€‚</p>
<h3 id="ä½¿ç”¨è£…é¥°å™¨çš„æ–¹å¼"><a href="#ä½¿ç”¨è£…é¥°å™¨çš„æ–¹å¼" class="headerlink" title="ä½¿ç”¨è£…é¥°å™¨çš„æ–¹å¼"></a>ä½¿ç”¨è£…é¥°å™¨çš„æ–¹å¼</h3><figure class="highlight typescript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">log</span>(<span class="params">target, descriptor, descriptor</span>) </span>&#123;</span><br><span class="line">    <span class="built_in">Object</span>.defineProperty(target, key, &#123;</span><br><span class="line">    ...descriptor,</span><br><span class="line">    <span class="attr">value</span>: <span class="function"><span class="keyword">function</span> (<span class="params">...arg</span>) </span>&#123;</span><br><span class="line">      <span class="keyword">let</span> start = <span class="keyword">new</span> <span class="built_in">Date</span>().valueOf()</span><br><span class="line">      <span class="keyword">try</span> &#123;</span><br><span class="line">        <span class="keyword">return</span> descriptor.value.apply(<span class="built_in">this</span>, arg) <span class="comment">// è°ƒç”¨ä¹‹å‰çš„å‡½æ•°</span></span><br><span class="line">      &#125; <span class="keyword">finally</span> &#123;</span><br><span class="line">        <span class="keyword">let</span> end = <span class="keyword">new</span> <span class="built_in">Date</span>().valueOf()</span><br><span class="line">        <span class="built_in">console</span>.log(<span class="string">`start: <span class="subst">$&#123;start&#125;</span> end: <span class="subst">$&#123;end&#125;</span> consume: <span class="subst">$&#123;end - start&#125;</span>`</span>)</span><br><span class="line">      &#125;</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;)</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Model1</span> </span>&#123;</span><br><span class="line">  <span class="meta">@log</span></span><br><span class="line">  <span class="function"><span class="title">getData</span>(<span class="params"></span>)</span> &#123;</span><br><span class="line">      <span class="keyword">return</span> [&#123;</span><br><span class="line">        <span class="attr">id</span>: <span class="number">1</span>,</span><br><span class="line">        <span class="attr">name</span>: <span class="string">&#x27;Niko&#x27;</span></span><br><span class="line">      &#125;, &#123;</span><br><span class="line">        <span class="attr">id</span>: <span class="number">2</span>,</span><br><span class="line">        <span class="attr">name</span>: <span class="string">&#x27;Bellic&#x27;</span></span><br><span class="line">      &#125;]</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>ä¸Šé¢çš„ä»£ç ä¸­ï¼Œæˆ‘ä»¬å°†å¢åŠ äº†ä¸€ä¸ª<code>log</code>ç”¨æ¥è®°å½•æ–¹æ³•æ‰§è¡Œçš„æ—¶é—´ã€‚é€šè¿‡è£…é¥°å™¨æˆ‘ä»¬å°†ä¸šåŠ¡é€»è¾‘å’Œéä¸šåŠ¡é€»è¾‘ä»£ç åˆ†å‰²å¼€æ¥ã€‚</p>
<span id="more"></span>

<h2 id="è£…é¥°å™¨å‡½æ•°æ‰§è¡Œæ—¶æœº"><a href="#è£…é¥°å™¨å‡½æ•°æ‰§è¡Œæ—¶æœº" class="headerlink" title="è£…é¥°å™¨å‡½æ•°æ‰§è¡Œæ—¶æœº"></a>è£…é¥°å™¨å‡½æ•°æ‰§è¡Œæ—¶æœº</h2><p>è£…é¥°å™¨å¯¹ç±»çš„è¡Œä¸ºçš„æ”¹å˜ï¼Œæ˜¯ä»£ç ç¼–è¯‘æ—¶å‘ç”Ÿçš„ï¼Œè€Œä¸æ˜¯åœ¨è¿è¡Œæ—¶ã€‚è¿™æ„å‘³ç€ï¼Œä¿®é¥°å™¨èƒ½åœ¨ç¼–è¯‘é˜¶æ®µè¿è¡Œä»£ç ã€‚ä¹Ÿå°±æ˜¯è¯´ï¼Œä¿®é¥°å™¨æœ¬è´¨å°±æ˜¯ç¼–è¯‘æ—¶æ‰§è¡Œçš„å‡½æ•°ã€‚</p>
<ul>
<li>åˆ›å»ºç±»å’Œåˆ›å»ºå‡½æ•°æ—¶ç«‹å³æ‰§è¡Œè£…é¥°å™¨</li>
<li>å¦‚æœè£…é¥°å™¨å‡½æ•°è¿”å›ä¸€ä¸ªfunctionï¼Œè¿™ä¸ªfunctionä¼šåœ¨æ‰€æœ‰çš„è£…é¥°å™¨å‡½æ•°è¿è¡Œå®Œæ¯•åï¼Œç»§ç»­è¿è¡Œ</li>
</ul>
<h2 id="å¦‚ä½•å¯ç”¨"><a href="#å¦‚ä½•å¯ç”¨" class="headerlink" title="å¦‚ä½•å¯ç”¨"></a>å¦‚ä½•å¯ç”¨</h2><p>ç›®å‰ <a target="_blank" rel="noopener" href="https://tc39.es/proposal-decorators/#sec-intro">è£…é¥°å™¨(Decorators)</a>å¤„äºECMAscriptææ¡ˆç¬¬äºŒé˜¶æ®µï¼ˆStage2 Draftï¼‰ã€‚ç›®å‰Typescriptå·²ç»æ”¯æŒï¼Œåªéœ€è¦åœ¨<code>tsconfig.json</code>åšä¸€ä¸‹ç®€å•é…ç½®</p>
<figure class="highlight json"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">&#123;</span><br><span class="line">    <span class="attr">&quot;compilerOptions&quot;</span>: &#123;</span><br><span class="line">        <span class="attr">&quot;target&quot;</span>: <span class="string">&quot;ES5&quot;</span>,</span><br><span class="line">        <span class="attr">&quot;experimentalDecorators&quot;</span>: <span class="literal">true</span></span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h2 id="è£…é¥°å™¨ç§ç±»"><a href="#è£…é¥°å™¨ç§ç±»" class="headerlink" title="è£…é¥°å™¨ç§ç±»"></a>è£…é¥°å™¨ç§ç±»</h2><p>Typescriptä¸­è£…é¥°å™¨æœ‰äº”ç§ç±»å‹ï¼š</p>
<table>
<thead>
<tr>
<th><strong>è£…é¥°å™¨/å±æ€§</strong></th>
<th><strong>ç±» è£…é¥°å™¨</strong></th>
<th><strong>æ–¹æ³• è£…é¥°å™¨</strong></th>
<th><strong>è®¿é—®å™¨ è£…é¥°å™¨</strong></th>
<th><strong>å±æ€§ è£…é¥°å™¨</strong></th>
<th><strong>å‚æ•° è£…é¥°å™¨</strong></th>
</tr>
</thead>
<tbody><tr>
<td>ä½ç½®</td>
<td><strong>@foo class Bar {}</strong></td>
<td><strong>@foo public bar() {}</strong></td>
<td><strong>@foo get bar()</strong></td>
<td><strong>@foo() bar: number</strong></td>
<td><strong>bar(@foo para: string) {}</strong></td>
</tr>
<tr>
<td>ä¼ å…¥å‚æ•°</td>
<td>constructor</td>
<td>target, <br />propertyKey, <br />descriptor</td>
<td>target, <br />propertyKey,<br /> descriptor</td>
<td>target, propertyKey</td>
<td>target, <br />propertyKey, <br />parameterIndex</td>
</tr>
<tr>
<td>è¿”å›å€¼</td>
<td>ç”¨è¿”å›å€¼æä¾›çš„æ„é€ å‡½æ•°æ¥æ›¿æ¢ç±»çš„å£°æ˜</td>
<td>è¿”å›å€¼è¢«ç”¨ä½œæ–¹æ³•çš„å±æ€§æè¿°ç¬¦</td>
<td>è¿”å›å€¼è¢«ç”¨ä½œæ–¹æ³•çš„å±æ€§æè¿°ç¬¦</td>
<td>è¢«å¿½ç•¥</td>
<td>è¢«å¿½ç•¥</td>
</tr>
</tbody></table>
<p>å‚æ•°é‡Šä¹‰ï¼š</p>
<ul>
<li><code>constructor</code>: ç±»æ„é€ å‡½æ•°</li>
<li><code>target</code>: å¯¹äºé™æ€æˆå‘˜æ¥è¯´æ˜¯ç±»çš„æ„é€ å‡½æ•°ï¼Œå¯¹äºå®ä¾‹æˆå‘˜æ˜¯ç±»çš„åŸå‹å¯¹è±¡ã€‚</li>
<li><code>propertyKey</code>: æˆå‘˜çš„åå­—</li>
<li><code>descriptor</code>: æˆå‘˜çš„å±æ€§æè¿°ç¬¦</li>
<li><code>parameterIndex</code>: å‚æ•°åœ¨å‡½æ•°å‚æ•°åˆ—è¡¨ä¸­çš„ç´¢å¼•</li>
</ul>
<h3 id="Typescript-ä¸­çš„-Decorator-ç­¾å"><a href="#Typescript-ä¸­çš„-Decorator-ç­¾å" class="headerlink" title="Typescript ä¸­çš„ Decorator ç­¾å"></a>Typescript ä¸­çš„ Decorator ç­¾å</h3><figure class="highlight typescript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">interface</span> TypedPropertyDescriptor&lt;T&gt; &#123;</span><br><span class="line">    enumerable?: <span class="built_in">boolean</span>;</span><br><span class="line">    configurable?: <span class="built_in">boolean</span>;</span><br><span class="line">    writable?: <span class="built_in">boolean</span>;</span><br><span class="line">    value?: T;</span><br><span class="line"> get?: <span class="function">() =&gt;</span> T;</span><br><span class="line"> set?: <span class="function">(<span class="params">value: T</span>) =&gt;</span> <span class="built_in">void</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">declare</span> <span class="keyword">type</span> ClassDecorator = &lt;TFunction extends Function&gt;(target: TFunction) =&gt; TFunction | void;</span><br><span class="line"></span><br><span class="line">declare type PropertyDecorator = (target: Object, propertyKey: string | symbol) =&gt; void;</span><br><span class="line"></span><br><span class="line">declare type MethodDecorator = &lt;T&gt;(target: Object, propertyKey: string | symbol, descriptor: TypedPropertyDescriptor&lt;T&gt;) =&gt; TypedPropertyDescriptor&lt;T&gt; | void;</span><br><span class="line"></span><br><span class="line">declare type ParameterDecorator = (target: Object, propertyKey: string | symbol, parameterIndex: number) =&gt; void;</span><br></pre></td></tr></table></figure>

<h3 id="Class-è£…é¥°å™¨"><a href="#Class-è£…é¥°å™¨" class="headerlink" title="Class è£…é¥°å™¨"></a>Class è£…é¥°å™¨</h3><p>ç±»è£…é¥°å™¨çš„ç±»å‹å®šä¹‰å¦‚ä¸‹ï¼š</p>
<figure class="highlight typescript"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">type</span> ClassDecorator = <span class="xml"><span class="tag">&lt;<span class="name">TFunction</span> <span class="attr">extends</span> <span class="attr">Function</span>&gt;</span>(target: TFunction) =&gt; TFunction | void;</span></span><br></pre></td></tr></table></figure>

<p><code>class</code> è£…é¥°å™¨åº”ç”¨äºç±»çš„æ„é€ å™¨ï¼Œå¯ç”¨äºè§‚æµ‹ã€ä¿®æ”¹ã€æ›¿æ¢ç±»å®šä¹‰ã€‚</p>
<p>ç±»è£…é¥°å™¨åªæœ‰ä¸€ä¸ªå‚æ•°: <code>constructor</code>ï¼Œ<code>constructor</code>ä¸ºç±»çš„æ„é€ å‡½æ•°ã€‚<strong>ç±»è£…é¥°å™¨çš„è¿”å›å€¼å¯ä»¥ä¸ºç©ºï¼Œä¹Ÿå¯ä»¥æ˜¯ä¸€ä¸ªæ–°çš„æ„é€ å‡½æ•°</strong>ã€‚</p>
<h4 id="æ‰©å±•æ„é€ å‡½æ•°"><a href="#æ‰©å±•æ„é€ å‡½æ•°" class="headerlink" title="æ‰©å±•æ„é€ å‡½æ•°"></a>æ‰©å±•æ„é€ å‡½æ•°</h4><figure class="highlight typescript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@name</span></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Person</span> </span>&#123;</span><br><span class="line">  <span class="function"><span class="title">sayHi</span>(<span class="params"></span>)</span> &#123;</span><br><span class="line">    <span class="built_in">console</span>.log(<span class="string">`My name is: <span class="subst">$&#123;<span class="built_in">this</span>.name&#125;</span>`</span>)</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// åˆ›å»ºä¸€ä¸ªç»§æ‰¿è‡ªPersonçš„åŒ¿åç±»</span></span><br><span class="line"><span class="comment">// ç›´æ¥è¿”å›å¹¶æ›¿æ¢åŸæœ‰çš„æ„é€ å‡½æ•°</span></span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">name</span>(<span class="params">constructor</span>) </span>&#123;</span><br><span class="line">  <span class="keyword">return</span> <span class="class"><span class="keyword">class</span> <span class="keyword">extends</span> <span class="title">constructor</span> </span>&#123;</span><br><span class="line">    name = <span class="string">&#x27;Niko&#x27;</span></span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">new</span> Person().sayHi()</span><br></pre></td></tr></table></figure>

<h4 id="ä¿®æ”¹åŸæœ‰å±æ€§çš„æè¿°ç¬¦"><a href="#ä¿®æ”¹åŸæœ‰å±æ€§çš„æè¿°ç¬¦" class="headerlink" title="ä¿®æ”¹åŸæœ‰å±æ€§çš„æè¿°ç¬¦"></a>ä¿®æ”¹åŸæœ‰å±æ€§çš„æè¿°ç¬¦</h4><figure class="highlight typescript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@seal</span></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Person</span> </span>&#123;</span><br><span class="line">  <span class="function"><span class="title">sayHi</span>(<span class="params"></span>)</span> &#123;&#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">seal</span>(<span class="params">constructor</span>) </span>&#123;</span><br><span class="line">  <span class="keyword">let</span> descriptor = <span class="built_in">Object</span>.getOwnPropertyDescriptor(<span class="title">constructor</span>.<span class="title">prototype</span>, &#x27;<span class="title">sayHi</span>&#x27;)</span><br><span class="line">  <span class="title">Object</span>.<span class="title">defineProperty</span>(<span class="params">constructor.prototype, <span class="string">&#x27;sayHi&#x27;</span>, &#123;</span></span><br><span class="line"><span class="params">    ...descriptor,</span></span><br><span class="line"><span class="params">    writable: <span class="literal">false</span></span></span><br><span class="line"><span class="params">  &#125;</span>)</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="title">Person</span>.<span class="title">prototype</span>.<span class="title">sayHi</span> = 1 // æ— æ•ˆ</span><br><span class="line"></span><br></pre></td></tr></table></figure>

<h4 id="ä½¿ç”¨é—­åŒ…æ¥å¢å¼ºè£…é¥°å™¨çš„åŠŸèƒ½"><a href="#ä½¿ç”¨é—­åŒ…æ¥å¢å¼ºè£…é¥°å™¨çš„åŠŸèƒ½" class="headerlink" title="ä½¿ç”¨é—­åŒ…æ¥å¢å¼ºè£…é¥°å™¨çš„åŠŸèƒ½"></a>ä½¿ç”¨é—­åŒ…æ¥å¢å¼ºè£…é¥°å™¨çš„åŠŸèƒ½</h4><p>å› ä¸º<code>@</code>ç¬¦å·åè¾¹è·Ÿçš„æ˜¯ä¸€ä¸ªå‡½æ•°çš„å¼•ç”¨ï¼Œæ‰€ä»¥å¯¹äºmixinçš„å®ç°ï¼Œæˆ‘ä»¬å¯ä»¥å¾ˆè½»æ˜“çš„ä½¿ç”¨é—­åŒ…æ¥å®ç°ï¼š</p>
<figure class="highlight typescript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">A</span> </span>&#123; <span class="function"><span class="title">say</span>(<span class="params"></span>)</span> &#123; <span class="keyword">return</span> <span class="number">1</span> &#125; &#125;</span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">B</span> </span>&#123; <span class="function"><span class="title">hi</span>(<span class="params"></span>)</span> &#123; <span class="keyword">return</span> <span class="number">2</span> &#125; &#125;</span><br><span class="line"></span><br><span class="line"><span class="meta">@mixin</span>(A, B)</span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">C</span> </span>&#123; &#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">mixin</span>(<span class="params">...args</span>) </span>&#123;</span><br><span class="line">  <span class="comment">// è°ƒç”¨å‡½æ•°è¿”å›è£…é¥°å™¨å®é™…åº”ç”¨çš„å‡½æ•°</span></span><br><span class="line">  <span class="keyword">return</span> <span class="function"><span class="keyword">function</span>(<span class="params">constructor</span>) </span>&#123;</span><br><span class="line">    <span class="keyword">for</span> (<span class="keyword">let</span> arg <span class="keyword">of</span> args) &#123;</span><br><span class="line">      <span class="keyword">for</span> (<span class="keyword">let</span> key <span class="keyword">of</span> <span class="built_in">Object</span>.getOwnPropertyNames(arg.prototype)) &#123;</span><br><span class="line">        <span class="keyword">if</span> (key === <span class="string">&#x27;constructor&#x27;</span>) <span class="keyword">continue</span> <span class="comment">// è·³è¿‡æ„é€ å‡½æ•°</span></span><br><span class="line">        <span class="built_in">Object</span>.defineProperty(<span class="title">constructor</span>.<span class="title">prototype</span>, <span class="title">key</span>, <span class="title">Object</span>.<span class="title">getOwnPropertyDescriptor</span>(<span class="params">arg.prototype, key</span>))</span><br><span class="line">      &#125;</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="title">let</span> <span class="title">c</span> = <span class="title">new</span> <span class="title">C</span>(<span class="params"></span>)</span><br><span class="line"><span class="title">console</span>.<span class="title">log</span>(<span class="params">c.say(), c.hi()</span>) // 1, 2</span><br></pre></td></tr></table></figure>

<h4 id="è¦†ç›–æ—§çš„æ„é€ å‡½æ•°"><a href="#è¦†ç›–æ—§çš„æ„é€ å‡½æ•°" class="headerlink" title="è¦†ç›–æ—§çš„æ„é€ å‡½æ•°"></a>è¦†ç›–æ—§çš„æ„é€ å‡½æ•°</h4><figure class="highlight typescript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">classDecorator</span>&lt;<span class="title">T</span> <span class="title">extends</span> </span>&#123; <span class="keyword">new</span> (...args: <span class="built_in">any</span>[]): &#123;&#125; &#125;&gt;( <span class="title">constructor</span>: <span class="title">T</span>) &#123;</span><br><span class="line"> 	<span class="keyword">return</span> <span class="class"><span class="keyword">class</span> <span class="keyword">extends</span> <span class="title">constructor</span> </span>&#123;</span><br><span class="line">    newProperty = <span class="string">&quot;new property&quot;</span>;</span><br><span class="line">    hello = <span class="string">&quot;override&quot;</span>;</span><br><span class="line">  &#125;;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="meta">@classDecorator</span></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Greeter</span></span>&#123;</span><br><span class="line">	property = <span class="string">&quot;property&quot;</span>;</span><br><span class="line"></span><br><span class="line">	hello: <span class="built_in">string</span>;</span><br><span class="line"></span><br><span class="line">	<span class="function"><span class="title">constructor</span>(<span class="params">m: <span class="built_in">string</span></span>)</span> &#123;</span><br><span class="line">		<span class="built_in">this</span>.hello = m;</span><br><span class="line">	&#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">const</span> greeter: Greeter = <span class="keyword">new</span> Greeter(<span class="string">&quot;world&quot;</span>);</span><br><span class="line"></span><br><span class="line"><span class="built_in">console</span>.log(&#123; greeter &#125;, greeter.hello);</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> &#123;</span></span><br><span class="line"><span class="comment">  &quot;greeter&quot;: &#123;</span></span><br><span class="line"><span class="comment">    &quot;property&quot;: &quot;property&quot;,</span></span><br><span class="line"><span class="comment">    &quot;hello&quot;: &quot;override&quot;,</span></span><br><span class="line"><span class="comment">    &quot;newProperty&quot;: &quot;new property&quot;</span></span><br><span class="line"><span class="comment">  &#125;</span></span><br><span class="line"><span class="comment">&#125;,  &quot;override&quot; </span></span><br><span class="line"><span class="comment">*/</span></span><br></pre></td></tr></table></figure>



<h4 id="å¤šä¸ªè£…é¥°å™¨çš„åº”ç”¨"><a href="#å¤šä¸ªè£…é¥°å™¨çš„åº”ç”¨" class="headerlink" title="å¤šä¸ªè£…é¥°å™¨çš„åº”ç”¨"></a>å¤šä¸ªè£…é¥°å™¨çš„åº”ç”¨</h4><p>å¯ä»¥å¤šä¸ªè£…é¥°å™¨ä¸€èµ·ä½¿ç”¨ï¼š</p>
<figure class="highlight typescript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@decorator1</span></span><br><span class="line"><span class="meta">@decorator2</span></span><br><span class="line"><span class="class"><span class="keyword">class</span> </span>&#123; &#125;</span><br></pre></td></tr></table></figure>

<p>æ‰§è¡Œçš„é¡ºåºä¸º<code>decorator2</code> -&gt; <code>decorator1</code>ï¼Œç¦»<code>class</code>å®šä¹‰æœ€è¿‘çš„å…ˆæ‰§è¡Œã€‚</p>
<h3 id="Method-è£…é¥°å™¨"><a href="#Method-è£…é¥°å™¨" class="headerlink" title="Method è£…é¥°å™¨"></a>Method è£…é¥°å™¨</h3><p>æ–¹æ³•è£…é¥°å™¨çš„ç±»å‹å®šä¹‰å¦‚ä¸‹ï¼š</p>
<figure class="highlight typescript"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">type</span> MethodDecorator = &lt;T&gt;<span class="function">(<span class="params">target: <span class="built_in">Object</span>, propertyKey: <span class="built_in">string</span> | symbol, descriptor: TypedPropertyDescriptor&lt;T&gt;</span>) =&gt;</span> TypedPropertyDescriptor&lt;T&gt; | <span class="built_in">void</span>;</span><br></pre></td></tr></table></figure>

<p>æ–¹æ³•è£…é¥°å™¨æœ‰ 3 ä¸ªå‚æ•° target ã€ propertyKey å’Œ descriptorã€‚</p>
<ul>
<li><strong>target</strong>ï¼š <strong>é™æ€æ–¹æ³•æ˜¯ç±»çš„æ„é€ å‡½æ•°ï¼Œå®ä¾‹æ–¹æ³•æ˜¯ç±»çš„åŸå‹å¯¹è±¡</strong></li>
<li><strong>propertyKey</strong>ï¼š æ–¹æ³•å</li>
<li><strong>descriptor</strong>ï¼š å±æ€§æè¿°ç¬¦ æ–¹æ³•è£…é¥°å™¨çš„è¿”å›å€¼å¯ä»¥ä¸ºç©ºï¼Œä¹Ÿå¯ä»¥æ˜¯ä¸€ä¸ªæ–°çš„å±æ€§æè¿°ç¬¦ã€‚</li>
</ul>
<p>å‡½æ•°è£…é¥°æ˜¯å¦‚æœæœ‰è¿”å›å€¼ä¼šé»˜è®¤ä½œä¸ºå±æ€§çš„<code>value</code>æè¿°ç¬¦å­˜åœ¨ï¼Œå¦‚æœè¿”å›å€¼ä¸º<code>undefined</code>åˆ™ä¼šå¿½ç•¥ï¼Œä½¿ç”¨ä¹‹å‰çš„<code>descriptor</code>å¼•ç”¨ä½œä¸ºå‡½æ•°çš„æè¿°ç¬¦ã€‚</p>
<h4 id="æ–¹æ¡ˆä¸€-ä¿®æ”¹ç°æœ‰æè¿°ç¬¦"><a href="#æ–¹æ¡ˆä¸€-ä¿®æ”¹ç°æœ‰æè¿°ç¬¦" class="headerlink" title="æ–¹æ¡ˆä¸€ ä¿®æ”¹ç°æœ‰æè¿°ç¬¦"></a>æ–¹æ¡ˆä¸€ ä¿®æ”¹ç°æœ‰æè¿°ç¬¦</h4><figure class="highlight typescript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> Log: MethodDecorator = <span class="function">(<span class="params">target: <span class="built_in">any</span>, key: <span class="built_in">string</span>, descriptor: PropertyDescriptor</span>) =&gt;</span> &#123;</span><br><span class="line">    <span class="keyword">const</span> className = target.constructor.name;</span><br><span class="line">    <span class="keyword">const</span> oldValue = descriptor.value;</span><br><span class="line">    descriptor.value = <span class="function"><span class="keyword">function</span>(<span class="params">...params</span>) </span>&#123;</span><br><span class="line">        <span class="built_in">console</span>.log(<span class="string">`è°ƒç”¨<span class="subst">$&#123;className&#125;</span>.<span class="subst">$&#123;key&#125;</span>()æ–¹æ³•`</span>);</span><br><span class="line">        <span class="keyword">return</span> oldValue.apply(<span class="built_in">this</span>, params);</span><br><span class="line">    &#125;;</span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">MyClass</span> </span>&#123;</span><br><span class="line">    <span class="keyword">private</span> name: <span class="built_in">string</span>;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="title">constructor</span>(<span class="params">name: <span class="built_in">string</span></span>)</span> &#123;</span><br><span class="line">        <span class="built_in">this</span>.name = name;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Log</span></span><br><span class="line">    getName (): <span class="built_in">string</span> &#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="string">&#x27;Tom&#x27;</span>;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> entity = <span class="keyword">new</span> MyClass(<span class="string">&#x27;Tom&#x27;</span>);</span><br><span class="line"><span class="keyword">const</span> name = entity.getName();</span><br><span class="line"><span class="comment">// è¾“å‡º: è°ƒç”¨MyClass.getName()æ–¹æ³•</span></span><br></pre></td></tr></table></figure>

<p><strong>@Log æ˜¯ä¸€ä¸ªæ–¹æ³•è£…é¥°å™¨</strong> ï¼Œä½¿ç”¨æ—¶æ·»åŠ åˆ°æ–¹æ³•å£°æ˜å‰ï¼Œç”¨äºè‡ªåŠ¨è¾“å‡ºæ–¹æ³•çš„è°ƒç”¨æ—¥å¿—ã€‚æ–¹æ³•è£…é¥°å™¨çš„ç¬¬ 3 ä¸ªå‚æ•°æ˜¯å±æ€§æè¿°ç¬¦ï¼Œå±æ€§æè¿°ç¬¦çš„ value è¡¨ç¤ºæ–¹æ³•çš„æ‰§è¡Œå‡½æ•°ï¼Œç”¨ä¸€ä¸ªæ–°çš„å‡½æ•°æ›¿æ¢äº†åŸæ¥å€¼ï¼Œæ–°çš„æ–¹æ³•è¿˜ä¼šè°ƒç”¨åŸæ–¹æ³•ï¼Œåªæ˜¯åœ¨è°ƒç”¨åŸæ–¹æ³•å‰è¾“å‡ºäº†ä¸€ä¸ªæ—¥å¿—ã€‚</p>
<h4 id="æ–¹æ¡ˆäºŒ-è¿”å›æ–°çš„valueæè¿°ç¬¦"><a href="#æ–¹æ¡ˆäºŒ-è¿”å›æ–°çš„valueæè¿°ç¬¦" class="headerlink" title="æ–¹æ¡ˆäºŒ è¿”å›æ–°çš„valueæè¿°ç¬¦"></a>æ–¹æ¡ˆäºŒ è¿”å›æ–°çš„valueæè¿°ç¬¦</h4><figure class="highlight typescript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> Log: MethodDecorator = <span class="function">(<span class="params">target: <span class="built_in">any</span>, key: <span class="built_in">string</span>, descriptor: PropertyDescriptor</span>) =&gt;</span> &#123;</span><br><span class="line">    <span class="keyword">const</span> className = target.constructor.name;</span><br><span class="line">    <span class="keyword">const</span> oldValue = descriptor.value;</span><br><span class="line">  <span class="keyword">return</span> &#123;</span><br><span class="line">    ...descriptor,</span><br><span class="line">    <span class="function"><span class="title">value</span>(<span class="params">...args</span>)</span> &#123;</span><br><span class="line">        <span class="built_in">console</span>.log(<span class="string">`è°ƒç”¨<span class="subst">$&#123;className&#125;</span>.<span class="subst">$&#123;key&#125;</span>()æ–¹æ³•`</span>);</span><br><span class="line">        <span class="keyword">return</span> oldValue.apply(<span class="built_in">this</span>, args);</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">MyClass</span> </span>&#123;</span><br><span class="line">    <span class="keyword">private</span> name: <span class="built_in">string</span>;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="title">constructor</span>(<span class="params">name: <span class="built_in">string</span></span>)</span> &#123;</span><br><span class="line">        <span class="built_in">this</span>.name = name;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Log</span></span><br><span class="line">    getName (): <span class="built_in">string</span> &#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="string">&#x27;Tom&#x27;</span>;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> entity = <span class="keyword">new</span> MyClass(<span class="string">&#x27;Tom&#x27;</span>);</span><br><span class="line"><span class="keyword">const</span> name = entity.getName();</span><br></pre></td></tr></table></figure>



<h3 id="Property-è£…é¥°å™¨"><a href="#Property-è£…é¥°å™¨" class="headerlink" title="Property è£…é¥°å™¨"></a>Property è£…é¥°å™¨</h3><p>å±æ€§è£…é¥°å™¨çš„ç±»å‹å®šä¹‰å¦‚ä¸‹ï¼š</p>
<figure class="highlight typescript"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">type</span> PropertyDecorator = <span class="function">(<span class="params">target: <span class="built_in">Object</span>, propertyKey: <span class="built_in">string</span> | symbol</span>) =&gt;</span> <span class="built_in">void</span>;</span><br></pre></td></tr></table></figure>

<p>å±æ€§è£…é¥°å™¨æœ‰ä¸¤ä¸ªå‚æ•° target å’Œ propertyKeyã€‚</p>
<ul>
<li><strong>target</strong>ï¼š<strong>é™æ€å±æ€§æ˜¯ç±»çš„æ„é€ å‡½æ•°ï¼Œå®ä¾‹å±æ€§æ˜¯ç±»çš„åŸå‹å¯¹è±¡</strong></li>
<li><strong>propertyKey</strong>ï¼šå±æ€§å</li>
</ul>
<figure class="highlight typescript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">interface</span> CheckRule &#123;</span><br><span class="line">    <span class="attr">required</span>: <span class="built_in">boolean</span>;</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">interface</span> MetaData &#123;</span><br><span class="line">    [key: <span class="built_in">string</span>]: CheckRule;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> Required: PropertyDecorator = <span class="function">(<span class="params">target: <span class="built_in">any</span>, key: <span class="built_in">string</span></span>) =&gt;</span> &#123;</span><br><span class="line">    target.__metadata = target.__metadata ? target.__metadata : &#123;&#125;;</span><br><span class="line">    target.__metadata[key] = &#123; <span class="attr">required</span>: <span class="literal">true</span> &#125;;</span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">MyClass</span> </span>&#123;</span><br><span class="line">    <span class="meta">@Required</span></span><br><span class="line">    <span class="attr">name</span>: <span class="built_in">string</span>;</span><br><span class="line">    </span><br><span class="line">    <span class="meta">@Required</span></span><br><span class="line">    <span class="attr">type</span>: <span class="built_in">string</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p><strong>@Required æ˜¯ä¸€ä¸ªå±æ€§è£…é¥°å™¨ï¼Œä½¿ç”¨æ—¶æ·»åŠ åˆ°å±æ€§å£°æ˜å‰ï¼Œä½œç”¨æ˜¯åœ¨ target çš„è‡ªå®šä¹‰å±æ€§ metadata ä¸­æ·»åŠ å¯¹åº”å±æ€§çš„å¿…å¡«è§„åˆ™</strong>ã€‚</p>
<p>ä¸Šä¾‹æ·»åŠ è£…é¥°å™¨å <code>target.metadata</code> çš„å€¼ä¸ºï¼š<code>&#123; name: &#123; required: true &#125;, type: &#123; required: true &#125; &#125;</code>ã€‚é€šè¿‡è¯»å– <code>__metadata </code>å¯ä»¥è·å¾—è®¾ç½®çš„å¿…å¡«çš„å±æ€§ï¼Œä»è€Œå¯¹å®ä¾‹å¯¹è±¡è¿›è¡Œæ ¡éªŒï¼Œæ ¡éªŒç›¸å…³çš„ä»£ç å¦‚ä¸‹ï¼š</p>
<figure class="highlight typescript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">validate</span>(<span class="params">entity</span>): <span class="title">boolean</span> </span>&#123;</span><br><span class="line">    <span class="comment">// @ts-ignore</span></span><br><span class="line">    <span class="keyword">const</span> metadata: MetaData = entity.__metadata;</span><br><span class="line">    <span class="keyword">if</span>(metadata) &#123;</span><br><span class="line">        <span class="keyword">let</span> i: <span class="built_in">number</span>,</span><br><span class="line">            <span class="attr">key</span>: <span class="built_in">string</span>,</span><br><span class="line">            <span class="attr">rule</span>: CheckRule;</span><br><span class="line">        <span class="keyword">const</span> keys = <span class="built_in">Object</span>.keys(metadata);</span><br><span class="line">        <span class="keyword">for</span> (i = <span class="number">0</span>; i &lt; keys.length; i++) &#123;</span><br><span class="line">            key = keys[i];</span><br><span class="line">            rule = metadata[key];</span><br><span class="line">            <span class="keyword">if</span> (rule.required &amp;&amp; (entity[key] === <span class="literal">undefined</span> || entity[key] === <span class="literal">null</span> || entity[key] === <span class="string">&#x27;&#x27;</span>)) &#123;</span><br><span class="line">                <span class="keyword">return</span> <span class="literal">false</span>;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span> <span class="literal">true</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> entity: MyClass = <span class="keyword">new</span> MyClass();</span><br><span class="line">entity.name = <span class="string">&#x27;name&#x27;</span>;</span><br><span class="line"><span class="keyword">const</span> result: <span class="built_in">boolean</span> = validate(entity);</span><br><span class="line"><span class="built_in">console</span>.log(result); <span class="comment">// è¾“å‡ºç»“æœï¼šfalse</span></span><br></pre></td></tr></table></figure>



<h3 id="Parameter-è£…é¥°å™¨"><a href="#Parameter-è£…é¥°å™¨" class="headerlink" title="Parameter è£…é¥°å™¨"></a>Parameter è£…é¥°å™¨</h3><p>å‚æ•°è£…é¥°å™¨çš„ç±»å‹å®šä¹‰å¦‚ä¸‹ï¼š</p>
<figure class="highlight typescript"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">type</span> ParameterDecorator = <span class="function">(<span class="params">target: <span class="built_in">Object</span>, propertyKey: <span class="built_in">string</span> | symbol, parameterIndex: <span class="built_in">number</span></span>) =&gt;</span> <span class="built_in">void</span>;</span><br></pre></td></tr></table></figure>

<p>å‚æ•°è£…é¥°å™¨æœ‰ 3 ä¸ªå‚æ•° target ã€ propertyKey å’Œ descriptorã€‚</p>
<ul>
<li><strong>target</strong>ï¼š<strong>é™æ€æ–¹æ³•çš„å‚æ•°æ˜¯ç±»çš„æ„é€ å‡½æ•°ï¼Œå®ä¾‹æ–¹æ³•çš„å‚æ•°æ˜¯ç±»çš„åŸå‹å¯¹è±¡</strong></li>
<li><strong>propertyKey</strong>ï¼šå‚æ•°æ‰€åœ¨æ–¹æ³•çš„æ–¹æ³•å</li>
<li><strong>parameterIndex</strong>ï¼šåœ¨æ–¹æ³•å‚æ•°åˆ—è¡¨ä¸­çš„ç´¢å¼•å€¼</li>
</ul>
<figure class="highlight typescript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> parseConf = &#123;&#125;</span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Modal</span> </span>&#123;</span><br><span class="line">  <span class="meta">@parseFunc</span></span><br><span class="line">  <span class="function"><span class="title">addOne</span>(<span class="params"><span class="meta">@parse</span>(<span class="string">&#x27;number&#x27;</span>) num</span>)</span> &#123;</span><br><span class="line">    <span class="keyword">return</span> num + <span class="number">1</span></span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// åœ¨å‡½æ•°è°ƒç”¨å‰æ‰§è¡Œæ ¼å¼åŒ–æ“ä½œ</span></span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">parseFunc</span> (<span class="params">target, name, descriptor</span>) </span>&#123;</span><br><span class="line">  <span class="keyword">return</span> &#123;</span><br><span class="line">    ...descriptor,</span><br><span class="line">    value (...arg) &#123;</span><br><span class="line">      <span class="comment">// è·å–æ ¼å¼åŒ–é…ç½®</span></span><br><span class="line">      <span class="keyword">for</span> (<span class="keyword">let</span> [index, <span class="keyword">type</span>] <span class="keyword">of</span> parseConf) &#123;</span><br><span class="line">        <span class="keyword">switch</span> (<span class="keyword">type</span>) &#123;</span><br><span class="line">          <span class="keyword">case</span> <span class="string">&#x27;number&#x27;</span>:  arg[index] = <span class="built_in">Number</span>(arg[index])             <span class="keyword">break</span></span><br><span class="line">          <span class="keyword">case</span> <span class="string">&#x27;string&#x27;</span>:  arg[index] = <span class="built_in">String</span>(arg[index])             <span class="keyword">break</span></span><br><span class="line">          <span class="keyword">case</span> <span class="string">&#x27;boolean&#x27;</span>: arg[index] = <span class="built_in">String</span>(arg[index]) === <span class="string">&#x27;true&#x27;</span>  <span class="keyword">break</span></span><br><span class="line">        &#125;</span><br><span class="line">      &#125;</span><br><span class="line"></span><br><span class="line">      <span class="keyword">return</span> descriptor.value.apply(<span class="built_in">this</span>, arg)</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// å‘å…¨å±€å¯¹è±¡ä¸­æ·»åŠ å¯¹åº”çš„æ ¼å¼åŒ–ä¿¡æ¯</span></span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">parse</span>(<span class="params"><span class="keyword">type</span></span>) </span>&#123;</span><br><span class="line">  <span class="keyword">return</span> <span class="function"><span class="keyword">function</span> (<span class="params">target, name, index</span>) </span>&#123;</span><br><span class="line">    parseConf[index] = <span class="keyword">type</span></span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="built_in">console</span>.log(<span class="keyword">new</span> Modal().addOne(<span class="string">&#x27;10&#x27;</span>)) <span class="comment">// 11</span></span><br><span class="line"></span><br></pre></td></tr></table></figure>

<p>ç»“åˆç€å‡½æ•°è£…é¥°å™¨æ¥å®Œæˆå¯¹å‡½æ•°å‚æ•°çš„ç±»å‹è½¬æ¢</p>
<h3 id="è®¿é—®ç¬¦è£…é¥°å™¨"><a href="#è®¿é—®ç¬¦è£…é¥°å™¨" class="headerlink" title="è®¿é—®ç¬¦è£…é¥°å™¨"></a>è®¿é—®ç¬¦è£…é¥°å™¨</h3><p>è®¿é—®ç¬¦è£…é¥°å™¨ç±»å‹å®šä¹‰å’Œ æ–¹æ³•è£…é¥°å™¨ç±»å‹å®šä¹‰ä¸€æ ·ï¼š</p>
<figure class="highlight typescript"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">type</span> MethodDecorator = &lt;T&gt;<span class="function">(<span class="params">target: <span class="built_in">Object</span>, propertyKey: <span class="built_in">string</span> | symbol, descriptor: TypedPropertyDescriptor&lt;T&gt;</span>) =&gt;</span> TypedPropertyDescriptor&lt;T&gt; | <span class="built_in">void</span>;</span><br></pre></td></tr></table></figure>

<p>è®¿é—®ç¬¦è£…é¥°å™¨çš„ä½¿ç”¨ä¸æ–¹æ³•è£…é¥°å™¨ä¸€è‡´ï¼Œå‚æ•°å’Œè¿”å›å€¼ç›¸åŒï¼Œåªæ˜¯è®¿é—®ç¬¦è£…é¥°å™¨ç”¨åœ¨è®¿é—®ç¬¦å£°æ˜ä¹‹å‰ã€‚ <strong>éœ€è¦æ³¨æ„çš„æ˜¯ï¼ŒTypeScript ä¸å…è®¸åŒæ—¶è£…é¥°ä¸€ä¸ªæˆå‘˜çš„ get å’Œ set è®¿é—®ç¬¦ã€‚</strong> </p>
<figure class="highlight typescript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> Enumerable: MethodDecorator = <span class="function">(<span class="params">target: <span class="built_in">any</span>, key: <span class="built_in">string</span>, descriptor: PropertyDescriptor</span>) =&gt;</span> &#123;</span><br><span class="line">    descriptor.enumerable = <span class="literal">true</span>;</span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">MyClass</span> </span>&#123;</span><br><span class="line">    <span class="attr">createDate</span>: <span class="built_in">Date</span>;</span><br><span class="line">    <span class="function"><span class="title">constructor</span>(<span class="params"></span>)</span> &#123;</span><br><span class="line">        <span class="built_in">this</span>.createDate = <span class="keyword">new</span> <span class="built_in">Date</span>();</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Enumerable</span></span><br><span class="line">    get createTime () &#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="built_in">this</span>.createDate.getTime();</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> entity = <span class="keyword">new</span> MyClass();</span><br><span class="line"><span class="keyword">for</span>(<span class="keyword">let</span> key <span class="keyword">in</span> entity) &#123;</span><br><span class="line">    <span class="built_in">console</span>.log(<span class="string">`entity.<span class="subst">$&#123;key&#125;</span> =`</span>, entity[key]);</span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">/* è¾“å‡ºï¼š</span></span><br><span class="line"><span class="comment">entity.createDate = 2020-04-08T10:40:51.133Z</span></span><br><span class="line"><span class="comment">entity.createTime = 1586342451133</span></span><br><span class="line"><span class="comment"> */</span></span><br></pre></td></tr></table></figure>

<p><strong>MyClass ç±»ä¸­æœ‰ä¸€ä¸ªå±æ€§ createDate ä¸º Date ç±»å‹</strong>ï¼Œ å¦å¤–å¢åŠ ä¸€ä¸ªæœ‰ get å£°æ˜çš„ createTime æ–¹æ³•ï¼Œå°±å¯ä»¥ä»¥ entity.createTime æ–¹å¼è·å¾— createDate çš„æ¯«ç§’å€¼ã€‚ <strong>ä½†æ˜¯ createTime é»˜è®¤æ˜¯ä¸å¯æšä¸¾çš„ï¼Œé€šè¿‡åœ¨å£°æ˜å‰å¢åŠ  @Enumerable è£…é¥°å™¨å¯ä»¥ä½¿ createTime æˆä¸ºå¯æšä¸¾çš„å±æ€§ã€‚</strong></p>
<p>ç»™å±æ€§è®¾ç½®å‰ç¼€</p>
<figure class="highlight typescript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Modal</span> </span>&#123;</span><br><span class="line">  _name = <span class="string">&#x27;Niko&#x27;</span></span><br><span class="line"></span><br><span class="line">  <span class="meta">@prefix</span></span><br><span class="line">  <span class="keyword">get</span> <span class="title">name</span>() &#123; <span class="keyword">return</span> <span class="built_in">this</span>._name &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">prefix</span>(<span class="params">target, name, descriptor</span>) </span>&#123;</span><br><span class="line">  <span class="keyword">return</span> &#123;</span><br><span class="line">    ...descriptor,</span><br><span class="line">    get () &#123;</span><br><span class="line">      <span class="keyword">return</span> <span class="string">`wrap_<span class="subst">$&#123;<span class="built_in">this</span>._name&#125;</span>`</span></span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="built_in">console</span>.log(<span class="keyword">new</span> Modal().name) <span class="comment">// wrap_Niko</span></span><br><span class="line"></span><br></pre></td></tr></table></figure>





<h3 id="é™æ€ç±»å‹å’Œå®ä¾‹ç±»å‹"><a href="#é™æ€ç±»å‹å’Œå®ä¾‹ç±»å‹" class="headerlink" title="é™æ€ç±»å‹å’Œå®ä¾‹ç±»å‹"></a>é™æ€ç±»å‹å’Œå®ä¾‹ç±»å‹</h3><p>é»˜è®¤Typescriptå±æ€§æ˜¯æ— æ³•è·å–åˆ°çš„ <code>descriptor</code>,ä½† é™æ€å±æ€§æ˜¯å¯ä»¥æ‰‹åŠ¨æ‹¿åˆ°çš„ï¼Œä½†å®ä¾‹å±æ€§ä¸è¡Œã€‚</p>
<h5 id="ä»€ä¹ˆæ˜¯é™æ€å±æ€§å’Œå®ä¾‹å±æ€§"><a href="#ä»€ä¹ˆæ˜¯é™æ€å±æ€§å’Œå®ä¾‹å±æ€§" class="headerlink" title="ä»€ä¹ˆæ˜¯é™æ€å±æ€§å’Œå®ä¾‹å±æ€§"></a>ä»€ä¹ˆæ˜¯é™æ€å±æ€§å’Œå®ä¾‹å±æ€§</h5><figure class="highlight typescript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Model</span> </span>&#123;</span><br><span class="line">  <span class="comment">// å®ä¾‹æˆå‘˜</span></span><br><span class="line">  method1 () &#123;&#125; <span class="comment">// å®ä¾‹æ–¹æ³•</span></span><br><span class="line">  method2 = <span class="function">() =&gt;</span> &#123;&#125; <span class="comment">//å®ä¾‹å±æ€§</span></span><br><span class="line"></span><br><span class="line">  <span class="comment">// é™æ€æˆå‘˜</span></span><br><span class="line">  <span class="keyword">static</span> method3 () &#123;&#125; <span class="comment">// é™æ€æ–¹æ³•</span></span><br><span class="line">  <span class="keyword">static</span> method4 = <span class="function">() =&gt;</span> &#123;&#125; <span class="comment">// é™æ€å±æ€§</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p><code>method1</code>å’Œ<code>method2</code>æ˜¯å®ä¾‹æˆå‘˜ï¼Œ<code>method1</code>å­˜åœ¨äº<code>prototype</code>ä¹‹ä¸Šï¼Œè€Œ<code>method2</code>åªåœ¨å®ä¾‹åŒ–å¯¹è±¡ä»¥åæ‰æœ‰ã€‚<br> ä½œä¸ºé™æ€æˆå‘˜çš„<code>method3</code>å’Œ<code>method4</code>ï¼Œä¸¤è€…çš„åŒºåˆ«åœ¨äºæ˜¯å¦å¯æšä¸¾æè¿°ç¬¦çš„è®¾ç½®ï¼Œæ‰€ä»¥å¯ä»¥ç®€å•åœ°è®¤ä¸ºï¼Œä¸Šè¿°ä»£ç è½¬æ¢ä¸ºES5ç‰ˆæœ¬åæ˜¯è¿™æ ·å­çš„ï¼š</p>
<figure class="highlight typescript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">Model</span> (<span class="params"></span>) </span>&#123;</span><br><span class="line">  <span class="comment">// æˆå‘˜ä»…åœ¨å®ä¾‹åŒ–æ—¶èµ‹å€¼</span></span><br><span class="line">  <span class="built_in">this</span>.method2 = <span class="function"><span class="keyword">function</span> (<span class="params"></span>) </span>&#123;&#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// æˆå‘˜è¢«å®šä¹‰åœ¨åŸå‹é“¾ä¸Š</span></span><br><span class="line"><span class="built_in">Object</span>.defineProperty(Model.prototype, <span class="string">&#x27;method1&#x27;</span>, &#123;</span><br><span class="line">  <span class="attr">value</span>: <span class="function"><span class="keyword">function</span> (<span class="params"></span>) </span>&#123;&#125;, </span><br><span class="line">  <span class="attr">writable</span>: <span class="literal">true</span>, </span><br><span class="line">  <span class="attr">enumerable</span>: <span class="literal">false</span>,  <span class="comment">// è®¾ç½®ä¸å¯è¢«æšä¸¾</span></span><br><span class="line">  <span class="attr">configurable</span>: <span class="literal">true</span></span><br><span class="line">&#125;)</span><br><span class="line"></span><br><span class="line"><span class="comment">// æˆå‘˜è¢«å®šä¹‰åœ¨æ„é€ å‡½æ•°ä¸Šï¼Œä¸”æ˜¯é»˜è®¤çš„å¯è¢«æšä¸¾</span></span><br><span class="line">Model.method4 = <span class="function"><span class="keyword">function</span> (<span class="params"></span>) </span>&#123;&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// æˆå‘˜è¢«å®šä¹‰åœ¨æ„é€ å‡½æ•°ä¸Š</span></span><br><span class="line"><span class="built_in">Object</span>.defineProperty(Model, <span class="string">&#x27;method3&#x27;</span>, &#123;</span><br><span class="line">  <span class="attr">value</span>: <span class="function"><span class="keyword">function</span> (<span class="params"></span>) </span>&#123;&#125;, </span><br><span class="line">  <span class="attr">writable</span>: <span class="literal">true</span>, </span><br><span class="line">  <span class="attr">enumerable</span>: <span class="literal">false</span>,  <span class="comment">// è®¾ç½®ä¸å¯è¢«æšä¸¾</span></span><br><span class="line">  <span class="attr">configurable</span>: <span class="literal">true</span></span><br><span class="line">&#125;)</span><br><span class="line"></span><br></pre></td></tr></table></figure>

<p>å¯ä»¥çœ‹å‡ºï¼Œåªæœ‰<code>method2</code>æ˜¯åœ¨å®ä¾‹åŒ–æ—¶æ‰èµ‹å€¼çš„ï¼Œä¸€ä¸ªä¸å­˜åœ¨çš„å±æ€§æ˜¯ä¸ä¼šæœ‰<code>descriptor</code>çš„ï¼Œæ‰€ä»¥è¿™å°±æ˜¯ä¸ºä»€ä¹ˆTSåœ¨é’ˆå¯¹<code>Property Decorator</code>ä¸ä¼ é€’ç¬¬ä¸‰ä¸ªå‚æ•°çš„åŸå› ï¼Œè‡³äºä¸ºä»€ä¹ˆé™æ€æˆå‘˜ä¹Ÿæ²¡æœ‰ä¼ é€’<code>descriptor</code>.</p>
<p>å°±åƒä¸Šè¿°çš„ç¤ºä¾‹ï¼Œæˆ‘ä»¬é’ˆå¯¹å››ä¸ªæˆå‘˜éƒ½æ·»åŠ äº†è£…é¥°å™¨ä»¥åï¼Œ<code>method1</code>å’Œ<code>method2</code>ç¬¬ä¸€ä¸ªå‚æ•°å°±æ˜¯<code>Model.prototype</code>ï¼Œè€Œ<code>method3</code>å’Œ<code>method4</code>çš„ç¬¬ä¸€ä¸ªå‚æ•°å°±æ˜¯<code>Model</code>ã€‚</p>
<figure class="highlight typescript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Model</span> </span>&#123;</span><br><span class="line">  <span class="comment">// å®ä¾‹æˆå‘˜</span></span><br><span class="line">  <span class="meta">@instance</span></span><br><span class="line">  method1 () &#123;&#125;</span><br><span class="line">  <span class="meta">@instance</span></span><br><span class="line">  method2 = <span class="function">() =&gt;</span> &#123;&#125;</span><br><span class="line"></span><br><span class="line">  <span class="comment">// é™æ€æˆå‘˜</span></span><br><span class="line">  <span class="meta">@static</span></span><br><span class="line">  <span class="keyword">static</span> method3 () &#123;&#125;</span><br><span class="line">  <span class="meta">@static</span></span><br><span class="line">  <span class="keyword">static</span> method4 = <span class="function">() =&gt;</span> &#123;&#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">instance</span>(<span class="params">target</span>) </span>&#123;</span><br><span class="line">  <span class="built_in">console</span>.log(target.constructor === Model)</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">static</span>(<span class="params">target</span>) </span>&#123;</span><br><span class="line">  <span class="built_in">console</span>.log(target === Model)</span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure>



<h4 id="é™æ€å±æ€§æ‰‹åŠ¨è·å–-descriptor"><a href="#é™æ€å±æ€§æ‰‹åŠ¨è·å–-descriptor" class="headerlink" title="é™æ€å±æ€§æ‰‹åŠ¨è·å– descriptor"></a>é™æ€å±æ€§æ‰‹åŠ¨è·å– descriptor</h4><figure class="highlight typescript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Modal</span> </span>&#123;</span><br><span class="line">  <span class="meta">@prefix</span></span><br><span class="line">  <span class="keyword">static</span> name1 = <span class="string">&#x27;Niko&#x27;</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">prefix</span>(<span class="params">target, name</span>) </span>&#123;</span><br><span class="line">  <span class="keyword">let</span> descriptor = <span class="built_in">Object</span>.getOwnPropertyDescriptor(target, name)</span><br><span class="line"></span><br><span class="line">  <span class="built_in">Object</span>.defineProperty(target, name, &#123;</span><br><span class="line">    ...descriptor,</span><br><span class="line">    <span class="attr">value</span>: <span class="string">`wrap_<span class="subst">$&#123;descriptor.value&#125;</span>`</span></span><br><span class="line">  &#125;)</span><br><span class="line">  </span><br><span class="line">  <span class="keyword">return</span> target</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="built_in">console</span>.log(Modal.name1) <span class="comment">// wrap_Niko</span></span><br></pre></td></tr></table></figure>



<h2 id="è£…é¥°å™¨æ‰§è¡Œé¡ºåº"><a href="#è£…é¥°å™¨æ‰§è¡Œé¡ºåº" class="headerlink" title="è£…é¥°å™¨æ‰§è¡Œé¡ºåº"></a>è£…é¥°å™¨æ‰§è¡Œé¡ºåº</h2><p>ä¸åŒå£°æ˜ä¸Šçš„è£…é¥°å™¨å°†æŒ‰ä»¥ä¸‹é¡ºåºæ‰§è¡Œï¼š</p>
<ol>
<li><strong>å®ä¾‹æˆå‘˜çš„è£…é¥°å™¨</strong>ï¼šå‚æ•°è£…é¥°å™¨ &gt; æ–¹æ³•è£…é¥°å™¨ &gt; è®¿é—®ç¬¦è£…é¥°å™¨/å±æ€§è£…é¥°å™¨</li>
<li><strong>é™æ€æˆå‘˜çš„è£…é¥°å™¨</strong>ï¼šå‚æ•°è£…é¥°å™¨ &gt; æ–¹æ³•è£…é¥°å™¨ &gt; è®¿é—®ç¬¦è£…é¥°å™¨/å±æ€§è£…é¥°å™¨</li>
<li><strong>æ„é€ å‡½æ•°çš„å‚æ•°è£…é¥°å™¨</strong></li>
<li><strong>ç±»è£…é¥°å™¨</strong></li>
</ol>
<p>å¦‚æœåŒä¸€ä¸ªå£°æ˜æœ‰å¤šä¸ªè£…é¥°å™¨ï¼Œç¦»å£°æ˜è¶Šè¿‘çš„è£…é¥°å™¨è¶Šæ—©æ‰§è¡Œï¼š</p>
<figure class="highlight typescript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">logClass1</span>(<span class="params">params:<span class="built_in">string</span></span>)</span>&#123;</span><br><span class="line">    <span class="keyword">return</span> <span class="function"><span class="keyword">function</span>(<span class="params">target:<span class="built_in">any</span></span>)</span>&#123;</span><br><span class="line">      <span class="built_in">console</span>.log(<span class="string">&#x27;ç±»è£…é¥°å™¨1&#x27;</span>)</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">logClass2</span>(<span class="params">params:<span class="built_in">string</span></span>)</span>&#123;</span><br><span class="line">    <span class="keyword">return</span> <span class="function"><span class="keyword">function</span>(<span class="params">target:<span class="built_in">any</span></span>)</span>&#123;</span><br><span class="line">      <span class="built_in">console</span>.log(<span class="string">&#x27;ç±»è£…é¥°å™¨2&#x27;</span>)</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">logAttribute1</span>(<span class="params">params?:<span class="built_in">string</span></span>)</span>&#123;</span><br><span class="line">    <span class="keyword">return</span> <span class="function"><span class="keyword">function</span>(<span class="params">target:<span class="built_in">any</span>,attrName:<span class="built_in">any</span></span>)</span>&#123;</span><br><span class="line">      <span class="built_in">console</span>.log(<span class="string">&#x27;å±æ€§è£…é¥°å™¨1&#x27;</span>)</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">logAttribute2</span>(<span class="params">params?:<span class="built_in">string</span></span>)</span>&#123;</span><br><span class="line">    <span class="keyword">return</span> <span class="function"><span class="keyword">function</span>(<span class="params">target:<span class="built_in">any</span>,attrName:<span class="built_in">any</span></span>)</span>&#123;</span><br><span class="line">      <span class="built_in">console</span>.log(<span class="string">&#x27;å±æ€§è£…é¥°å™¨2&#x27;</span>)</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">logMethod1</span>(<span class="params">params?:<span class="built_in">string</span></span>)</span>&#123;</span><br><span class="line">    <span class="keyword">return</span> <span class="function"><span class="keyword">function</span>(<span class="params">target:<span class="built_in">any</span>,attrName:<span class="built_in">any</span>,desc:<span class="built_in">any</span></span>)</span>&#123;</span><br><span class="line">      <span class="built_in">console</span>.log(<span class="string">&#x27;æ–¹æ³•è£…é¥°å™¨1&#x27;</span>)</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">logMethod2</span>(<span class="params">params?:<span class="built_in">string</span></span>)</span>&#123;</span><br><span class="line">    <span class="keyword">return</span> <span class="function"><span class="keyword">function</span>(<span class="params">target:<span class="built_in">any</span>,attrName:<span class="built_in">any</span>,desc:<span class="built_in">any</span></span>)</span>&#123;</span><br><span class="line">      <span class="built_in">console</span>.log(<span class="string">&#x27;æ–¹æ³•è£…é¥°å™¨2&#x27;</span>)</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">logParams1</span>(<span class="params">params?:<span class="built_in">string</span></span>)</span>&#123;</span><br><span class="line">    <span class="keyword">return</span> <span class="function"><span class="keyword">function</span>(<span class="params">target:<span class="built_in">any</span>,attrName:<span class="built_in">any</span>,desc:<span class="built_in">any</span></span>)</span>&#123;</span><br><span class="line">      <span class="built_in">console</span>.log(<span class="string">&#x27;æ–¹æ³•å‚æ•°è£…é¥°å™¨1&#x27;</span>)</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">logParams2</span>(<span class="params">params?:<span class="built_in">string</span></span>)</span>&#123;</span><br><span class="line">    <span class="keyword">return</span> <span class="function"><span class="keyword">function</span>(<span class="params">target:<span class="built_in">any</span>,attrName:<span class="built_in">any</span>,desc:<span class="built_in">any</span></span>)</span>&#123;</span><br><span class="line">      <span class="built_in">console</span>.log(<span class="string">&#x27;æ–¹æ³•å‚æ•°è£…é¥°å™¨2&#x27;</span>)</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="meta">@logClass1</span>(<span class="string">&#x27;http://www.loaderman.com/api&#x27;</span>)</span><br><span class="line"><span class="meta">@logClass2</span>(<span class="string">&#x27;xxxx&#x27;</span>)</span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">HttpClient</span></span>&#123;</span><br><span class="line">    <span class="meta">@logAttribute1</span>()</span><br><span class="line">    <span class="meta">@logAttribute2</span>()</span><br><span class="line">    <span class="keyword">public</span> apiUrl:<span class="built_in">string</span> | <span class="literal">undefined</span>;</span><br><span class="line">    <span class="function"><span class="title">constructor</span>(<span class="params"></span>)</span>&#123;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@logMethod1</span>()</span><br><span class="line">    <span class="meta">@logMethod2</span>()</span><br><span class="line">    <span class="function"><span class="title">getData</span>(<span class="params"></span>)</span>&#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="literal">true</span>;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="title">setData</span>(<span class="params"><span class="meta">@logParams1</span>() attr1:<span class="built_in">any</span>,<span class="meta">@logParams2</span>() attr2:<span class="built_in">any</span>,</span>)</span>&#123;</span><br><span class="line"></span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">var</span> http:<span class="built_in">any</span>=<span class="keyword">new</span> HttpClient();</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment">[LOG]: &quot;å±æ€§è£…é¥°å™¨2&quot; </span></span><br><span class="line"><span class="comment">[LOG]: &quot;å±æ€§è£…é¥°å™¨1&quot; </span></span><br><span class="line"><span class="comment">[LOG]: &quot;æ–¹æ³•è£…é¥°å™¨2&quot; </span></span><br><span class="line"><span class="comment">[LOG]: &quot;æ–¹æ³•è£…é¥°å™¨1&quot; </span></span><br><span class="line"><span class="comment">[LOG]: &quot;æ–¹æ³•å‚æ•°è£…é¥°å™¨2&quot; </span></span><br><span class="line"><span class="comment">[LOG]: &quot;æ–¹æ³•å‚æ•°è£…é¥°å™¨1&quot; </span></span><br><span class="line"><span class="comment">[LOG]: &quot;ç±»è£…é¥°å™¨2&quot; </span></span><br><span class="line"><span class="comment">[LOG]: &quot;ç±»è£…é¥°å™¨1&quot; </span></span><br><span class="line"><span class="comment">*/</span></span><br></pre></td></tr></table></figure>

<figure class="highlight typescript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">f</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line">    <span class="built_in">console</span>.log(<span class="string">&quot;f(): evaluated&quot;</span>);</span><br><span class="line">    <span class="keyword">return</span> <span class="function"><span class="keyword">function</span> (<span class="params">target, propertyKey: <span class="built_in">string</span>, descriptor: PropertyDescriptor</span>) </span>&#123;</span><br><span class="line">        <span class="built_in">console</span>.log(<span class="string">&quot;f(): called&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">g</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line">    <span class="built_in">console</span>.log(<span class="string">&quot;g(): evaluated&quot;</span>);</span><br><span class="line">    <span class="keyword">return</span> <span class="function"><span class="keyword">function</span> (<span class="params">target, propertyKey: <span class="built_in">string</span>, descriptor: PropertyDescriptor</span>) </span>&#123;</span><br><span class="line">        <span class="built_in">console</span>.log(<span class="string">&quot;g(): called&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">C</span> </span>&#123;</span><br><span class="line">    <span class="meta">@f</span>()</span><br><span class="line">    <span class="meta">@g</span>()</span><br><span class="line">    <span class="function"><span class="title">method</span>(<span class="params"></span>)</span> &#123;&#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>ç»“æœï¼š</p>
<figure class="highlight typescript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">f(): evaluated</span><br><span class="line">g(): evaluated</span><br><span class="line">g(): called</span><br><span class="line">f(): called</span><br></pre></td></tr></table></figure>



<h2 id="è£…é¥°å·¥å‚ğŸ­"><a href="#è£…é¥°å·¥å‚ğŸ­" class="headerlink" title="è£…é¥°å·¥å‚ğŸ­"></a>è£…é¥°å·¥å‚ğŸ­</h2><p>ç”±äºæ¯ç§è£…é¥°å™¨éƒ½æœ‰å®ƒè‡ªèº«çš„è°ƒç”¨ç­¾åï¼Œæˆ‘ä»¬å¯ä»¥ä½¿ç”¨è£…é¥°å™¨å·¥å‚æ¥æ³›åŒ–è£…é¥°å™¨è°ƒç”¨ã€‚</p>
<figure class="highlight typescript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> &#123; logClass &#125; <span class="keyword">from</span> <span class="string">&#x27;./class-decorator&#x27;</span>;</span><br><span class="line"><span class="keyword">import</span> &#123; logMethod &#125; <span class="keyword">from</span> <span class="string">&#x27;./method-decorator&#x27;</span>;</span><br><span class="line"><span class="keyword">import</span> &#123; logProperty &#125; <span class="keyword">from</span> <span class="string">&#x27;./property-decorator&#x27;</span>;</span><br><span class="line"><span class="keyword">import</span> &#123; logParameter &#125; <span class="keyword">from</span> <span class="string">&#x27;./parameter-decorator&#x27;</span>;</span><br><span class="line"></span><br><span class="line"><span class="comment">// è£…é¥°å™¨å·¥å‚ï¼Œæ ¹æ®ä¼ å…¥çš„å‚æ•°è°ƒç”¨ç›¸åº”çš„è£…é¥°å™¨</span></span><br><span class="line"><span class="keyword">export</span> <span class="function"><span class="keyword">function</span> <span class="title">log</span>(<span class="params">...args</span>) </span>&#123;</span><br><span class="line">    <span class="keyword">switch</span> (args.length) &#123;</span><br><span class="line">        <span class="keyword">case</span> <span class="number">3</span>: <span class="comment">// å¯èƒ½æ˜¯æ–¹æ³•è£…é¥°å™¨æˆ–å‚æ•°è£…é¥°å™¨</span></span><br><span class="line">            <span class="comment">// å¦‚æœç¬¬ä¸‰ä¸ªå‚æ•°æ˜¯æ•°å­—ï¼Œé‚£ä¹ˆå®ƒæ˜¯ç´¢å¼•ï¼Œæ‰€ä»¥è¿™æ˜¯å‚æ•°è£…é¥°å™¨</span></span><br><span class="line">            <span class="keyword">if</span> <span class="keyword">typeof</span> args[<span class="number">2</span>] === <span class="string">&quot;number&quot;</span>) &#123;</span><br><span class="line">                <span class="keyword">return</span> logParameter.apply(<span class="built_in">this</span>, args);</span><br><span class="line">            &#125;</span><br><span class="line">            <span class="keyword">return</span> logMethod.apply(<span class="built_in">this</span>, args);</span><br><span class="line">        <span class="keyword">case</span> <span class="number">2</span>: <span class="comment">// å±æ€§è£…é¥°å™¨ </span></span><br><span class="line">            <span class="keyword">return</span> logProperty.apply(<span class="built_in">this</span>, args);</span><br><span class="line">        <span class="keyword">case</span> <span class="number">1</span>: <span class="comment">// ç±»è£…é¥°å™¨</span></span><br><span class="line">            <span class="keyword">return</span> logClass.apply(<span class="built_in">this</span>, args);</span><br><span class="line">        <span class="keyword">default</span>: <span class="comment">// å‚æ•°æ•°ç›®ä¸åˆæ³•</span></span><br><span class="line">            <span class="keyword">throw</span> <span class="keyword">new</span> <span class="built_in">Error</span>(<span class="string">&#x27;Not a valid decorator&#x27;</span>);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="meta">@log</span></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Employee</span> </span>&#123;</span><br><span class="line">    <span class="meta">@log</span></span><br><span class="line">    <span class="keyword">private</span> name: <span class="built_in">string</span>;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="title">constructor</span>(<span class="params">name: <span class="built_in">string</span></span>)</span> &#123;</span><br><span class="line">        <span class="built_in">this</span>.name = name;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@log</span></span><br><span class="line">    greet(<span class="meta">@log</span> message: <span class="built_in">string</span>): <span class="built_in">string</span> &#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="string">`<span class="subst">$&#123;<span class="built_in">this</span>.name&#125;</span> says: <span class="subst">$&#123;message&#125;</span>`</span>;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure>


<h2 id="è£…é¥°å™¨çš„åº”ç”¨"><a href="#è£…é¥°å™¨çš„åº”ç”¨" class="headerlink" title="è£…é¥°å™¨çš„åº”ç”¨"></a>è£…é¥°å™¨çš„åº”ç”¨</h2><p>ä½¿ç”¨è£…é¥°å™¨å¯ä»¥å®ç°è‡ªåŠ¨æ³¨å†Œè·¯ç”±ï¼Œé€šè¿‡ç»™ Controller å±‚çš„ç±»å’Œæ–¹æ³•æ·»åŠ è£…é¥°å™¨æ¥å®šä¹‰è·¯ç”±ä¿¡æ¯ï¼Œå½“åˆ›å»ºè·¯ç”±æ—¶æ‰«ææŒ‡å®šç›®å½•ä¸‹æ‰€æœ‰ Controllerï¼Œè·å–è£…é¥°å™¨å®šä¹‰çš„è·¯ç”±ä¿¡æ¯ï¼Œä»è€Œå®ç°è‡ªåŠ¨æ·»åŠ è·¯ç”±ã€‚</p>
<h3 id="è£…é¥°å™¨ä»£ç "><a href="#è£…é¥°å™¨ä»£ç " class="headerlink" title="è£…é¥°å™¨ä»£ç "></a>è£…é¥°å™¨ä»£ç </h3><figure class="highlight typescript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/* src/common/decorator/controller.ts */</span></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">interface</span> Route &#123;</span><br><span class="line">    <span class="attr">propertyKey</span>: <span class="built_in">string</span>,</span><br><span class="line">    <span class="attr">method</span>: <span class="built_in">string</span>;</span><br><span class="line">    path: <span class="built_in">string</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">export</span> <span class="function"><span class="keyword">function</span> <span class="title">Controller</span>(<span class="params">path: <span class="built_in">string</span> = <span class="string">&#x27;&#x27;</span></span>): <span class="title">ClassDecorator</span> </span>&#123;</span><br><span class="line">    <span class="keyword">return</span> <span class="function">(<span class="params">target: <span class="built_in">any</span></span>) =&gt;</span> &#123;</span><br><span class="line">        <span class="built_in">Reflect</span>.defineMetadata(<span class="string">&#x27;basePath&#x27;</span>, path, target);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">type</span> RouterDecoratorFactory = <span class="function">(<span class="params">path?: <span class="built_in">string</span></span>) =&gt;</span> MethodDecorator;</span><br><span class="line"></span><br><span class="line"><span class="keyword">export</span> <span class="function"><span class="keyword">function</span> <span class="title">createRouterDecorator</span>(<span class="params">method: <span class="built_in">string</span></span>): <span class="title">RouterDecoratorFactory</span> </span>&#123;</span><br><span class="line">    <span class="keyword">return</span> <span class="function">(<span class="params">path?: <span class="built_in">string</span></span>) =&gt;</span> <span class="function">(<span class="params">target: <span class="built_in">any</span>, propertyKey: <span class="built_in">string</span>, descriptor: PropertyDescriptor</span>) =&gt;</span> &#123;</span><br><span class="line">        <span class="keyword">const</span> route: Route = &#123;</span><br><span class="line">            propertyKey,</span><br><span class="line">            method,</span><br><span class="line">            <span class="attr">path</span>: path || <span class="string">&#x27;&#x27;</span></span><br><span class="line">        &#125;;</span><br><span class="line">        <span class="keyword">if</span> (!<span class="built_in">Reflect</span>.hasMetadata(<span class="string">&#x27;routes&#x27;</span>, target)) &#123;</span><br><span class="line">            <span class="built_in">Reflect</span>.defineMetadata(<span class="string">&#x27;routes&#x27;</span>, [], target);</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">const</span> routes = <span class="built_in">Reflect</span>.getMetadata(<span class="string">&#x27;routes&#x27;</span>, target);</span><br><span class="line">        routes.push(route);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">const</span> Get: RouterDecoratorFactory = createRouterDecorator(<span class="string">&#x27;get&#x27;</span>);</span><br><span class="line"><span class="keyword">export</span> <span class="keyword">const</span> Post: RouterDecoratorFactory = createRouterDecorator(<span class="string">&#x27;post&#x27;</span>);</span><br><span class="line"><span class="keyword">export</span> <span class="keyword">const</span> Put: RouterDecoratorFactory = createRouterDecorator(<span class="string">&#x27;put&#x27;</span>);</span><br><span class="line"><span class="keyword">export</span> <span class="keyword">const</span> Delete: RouterDecoratorFactory = createRouterDecorator(<span class="string">&#x27;delete&#x27;</span>);</span><br><span class="line"><span class="keyword">export</span> <span class="keyword">const</span> Patch: RouterDecoratorFactory = createRouterDecorator(<span class="string">&#x27;patch&#x27;</span>);</span><br></pre></td></tr></table></figure>

<h3 id="æ§åˆ¶å™¨ä»£ç "><a href="#æ§åˆ¶å™¨ä»£ç " class="headerlink" title="æ§åˆ¶å™¨ä»£ç "></a>æ§åˆ¶å™¨ä»£ç </h3><figure class="highlight typescript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/* src/controller/roleController.ts */</span></span><br><span class="line"><span class="keyword">import</span> Koa <span class="keyword">from</span> <span class="string">&#x27;koa&#x27;</span>;</span><br><span class="line"><span class="keyword">import</span> &#123; Controller, Get &#125; <span class="keyword">from</span> <span class="string">&#x27;../common/decorator/controller&#x27;</span>;</span><br><span class="line"><span class="keyword">import</span> RoleService <span class="keyword">from</span> <span class="string">&#x27;../service/roleService&#x27;</span>;</span><br><span class="line"></span><br><span class="line"><span class="meta">@Controller</span>()</span><br><span class="line"><span class="keyword">export</span> <span class="keyword">default</span> <span class="class"><span class="keyword">class</span> <span class="title">RoleController</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Get</span>(<span class="string">&#x27;/roles&#x27;</span>)</span><br><span class="line">    <span class="keyword">static</span> <span class="keyword">async</span> getRoles (ctx: Koa.Context) &#123;</span><br><span class="line">        <span class="keyword">const</span> roles = <span class="keyword">await</span> RoleService.findRoles();</span><br><span class="line">        ctx.body = roles;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Get</span>(<span class="string">&#x27;/roles/:id&#x27;</span>)</span><br><span class="line">    <span class="keyword">static</span> <span class="keyword">async</span> getRoleById (ctx: Koa.Context) &#123;</span><br><span class="line">        <span class="keyword">const</span> id = ctx.params.id;</span><br><span class="line">        <span class="keyword">const</span> role = <span class="keyword">await</span> RoleService.findRoleById(id);</span><br><span class="line">        ctx.body = role;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h3 id="è·¯ç”±å™¨ä»£ç "><a href="#è·¯ç”±å™¨ä»£ç " class="headerlink" title="è·¯ç”±å™¨ä»£ç "></a>è·¯ç”±å™¨ä»£ç </h3><figure class="highlight typescript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/* src/common /scanRouter.ts */</span></span><br><span class="line"><span class="keyword">import</span> fs <span class="keyword">from</span> <span class="string">&#x27;fs&#x27;</span>;</span><br><span class="line"><span class="keyword">import</span> path <span class="keyword">from</span> <span class="string">&#x27;path&#x27;</span>;</span><br><span class="line"><span class="keyword">import</span> KoaRouter <span class="keyword">from</span> <span class="string">&#x27;koa-router&#x27;</span>;</span><br><span class="line"><span class="keyword">import</span> &#123; Route &#125; <span class="keyword">from</span> <span class="string">&#x27;./decorator/controller&#x27;</span>;</span><br><span class="line"></span><br><span class="line"><span class="comment">// æ‰«ææŒ‡å®šç›®å½•çš„Controllerå¹¶æ·»åŠ è·¯ç”±</span></span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">scanController</span>(<span class="params">dirPath: <span class="built_in">string</span>, router: KoaRouter</span>): <span class="title">void</span> </span>&#123;</span><br><span class="line">    <span class="keyword">if</span> (!fs.existsSync(dirPath)) &#123;</span><br><span class="line">        <span class="built_in">console</span>.warn(<span class="string">`ç›®å½•ä¸å­˜åœ¨ï¼<span class="subst">$&#123;dirPath&#125;</span>`</span>);</span><br><span class="line">        <span class="keyword">return</span>;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">const</span> fileNames: <span class="built_in">string</span>[] = fs.readdirSync(dirPath);</span><br><span class="line"></span><br><span class="line">    <span class="keyword">for</span> (<span class="keyword">const</span> name <span class="keyword">of</span> fileNames) &#123;</span><br><span class="line">        <span class="keyword">const</span> curPath: <span class="built_in">string</span> = path.join(dirPath, name);</span><br><span class="line">        <span class="keyword">if</span> (fs.statSync(curPath).isDirectory()) &#123;</span><br><span class="line">            scanController(curPath, router);</span><br><span class="line">            <span class="keyword">continue</span>;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">if</span> (!(<span class="regexp">/(.js|.jsx|.ts|.tsx)$/</span>.test(name))) &#123;</span><br><span class="line">            <span class="keyword">continue</span>;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">try</span> &#123;</span><br><span class="line">            <span class="keyword">const</span> scannedModule = <span class="built_in">require</span>(curPath);</span><br><span class="line">            <span class="keyword">const</span> controller = scannedModule.default || scannedModule;</span><br><span class="line">            <span class="keyword">const</span> isController: <span class="built_in">boolean</span> = <span class="built_in">Reflect</span>.hasMetadata(<span class="string">&#x27;basePath&#x27;</span>, controller);</span><br><span class="line">            <span class="keyword">const</span> hasRoutes: <span class="built_in">boolean</span> = <span class="built_in">Reflect</span>.hasMetadata(<span class="string">&#x27;routes&#x27;</span>, controller);</span><br><span class="line">            <span class="keyword">if</span> (isController &amp;&amp; hasRoutes) &#123;</span><br><span class="line">                <span class="keyword">const</span> basePath: <span class="built_in">string</span> = <span class="built_in">Reflect</span>.getMetadata(<span class="string">&#x27;basePath&#x27;</span>, controller);</span><br><span class="line">                <span class="keyword">const</span> routes: Route[] = <span class="built_in">Reflect</span>.getMetadata(<span class="string">&#x27;routes&#x27;</span>, controller);</span><br><span class="line">                <span class="keyword">let</span> curPath: <span class="built_in">string</span>, curRouteHandler;</span><br><span class="line">                routes.forEach( <span class="function">(<span class="params">route: Route</span>) =&gt;</span> &#123;</span><br><span class="line">                    curPath = path.posix.join(<span class="string">&#x27;/&#x27;</span>, basePath, route.path);</span><br><span class="line">                    curRouteHandler = controller[route.propertyKey];</span><br><span class="line">                    router[route.method](curPath, curRouteHandler);</span><br><span class="line">                    <span class="built_in">console</span>.info(<span class="string">`router: <span class="subst">$&#123;controller.name&#125;</span>.<span class="subst">$&#123;route.propertyKey&#125;</span> [<span class="subst">$&#123;route.method&#125;</span>] <span class="subst">$&#123;curPath&#125;</span>`</span>)</span><br><span class="line">                &#125;)</span><br><span class="line">            &#125;</span><br><span class="line">        &#125; <span class="keyword">catch</span> (error) &#123;</span><br><span class="line">            <span class="built_in">console</span>.warn(<span class="string">&#x27;æ–‡ä»¶è¯»å–å¤±è´¥ï¼&#x27;</span>, curPath, error);</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">default</span> <span class="class"><span class="keyword">class</span> <span class="title">ScanRouter</span> <span class="keyword">extends</span> <span class="title">KoaRouter</span> </span>&#123;</span><br><span class="line">    <span class="function"><span class="title">constructor</span>(<span class="params">opt?: KoaRouter.IRouterOptions</span>)</span> &#123;</span><br><span class="line">        <span class="built_in">super</span>(opt);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    scan (scanDir: <span class="built_in">string</span> | <span class="built_in">string</span>[]) &#123;</span><br><span class="line">        <span class="keyword">if</span> (<span class="keyword">typeof</span> scanDir === <span class="string">&#x27;string&#x27;</span>) &#123;</span><br><span class="line">            scanController(scanDir, <span class="built_in">this</span>);</span><br><span class="line">        &#125; <span class="keyword">else</span> <span class="keyword">if</span> (scanDir <span class="keyword">instanceof</span> <span class="built_in">Array</span>) &#123;</span><br><span class="line">            scanDir.forEach(<span class="keyword">async</span> (dir: <span class="built_in">string</span>) =&gt; &#123;</span><br><span class="line">                scanController(dir, <span class="built_in">this</span>);</span><br><span class="line">            &#125;);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h3 id="åˆ›å»ºè·¯ç”±ä»£ç "><a href="#åˆ›å»ºè·¯ç”±ä»£ç " class="headerlink" title="åˆ›å»ºè·¯ç”±ä»£ç "></a>åˆ›å»ºè·¯ç”±ä»£ç </h3><figure class="highlight typescript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/* src/router.ts */</span></span><br><span class="line"><span class="keyword">import</span> path <span class="keyword">from</span> <span class="string">&#x27;path&#x27;</span>;</span><br><span class="line"><span class="keyword">import</span> ScanRouter <span class="keyword">from</span> <span class="string">&#x27;./common/scanRouter&#x27;</span>;</span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> router = <span class="keyword">new</span> ScanRouter();</span><br><span class="line"></span><br><span class="line">router.scan([path.resolve(__dirname, <span class="string">&#x27;./controller&#x27;</span>)]);</span><br><span class="line"></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">default</span> router;</span><br></pre></td></tr></table></figure>





<h2 id="Refer-To"><a href="#Refer-To" class="headerlink" title="Refer To"></a>Refer To</h2><p><a target="_blank" rel="noopener" href="https://juejin.cn/post/6844903635168526343#heading-15">https://juejin.cn/post/6844903635168526343#heading-15</a></p>
<p><a target="_blank" rel="noopener" href="https://www.infoq.cn/article/ikvkdvq9haopv5yfppmj">https://www.infoq.cn/article/ikvkdvq9haopv5yfppmj</a></p>
<p><a target="_blank" rel="noopener" href="https://www.typescriptlang.org/docs/handbook/decorators.html">https://www.typescriptlang.org/docs/handbook/decorators.html</a></p>
<p><a target="_blank" rel="noopener" href="https://yrq110.me/post/front-end/typescript-decorator-practice/">https://yrq110.me/post/front-end/typescript-decorator-practice/</a></p>

      
    </div>

    
      
      

  <div class="post-copyright">
    <p class="copyright-item">
      <span>åŸæ–‡ä½œè€…: </span>
      <a href="https://fynn90.github.io">Fynn</a>
    </p>
    <p class="copyright-item">
      <span>åŸæ–‡é“¾æ¥: </span>
      <a href="https://fynn90.github.io/2021/01/15/TS%E8%A3%85%E9%A5%B0%E5%99%A8/">https://fynn90.github.io/2021/01/15/TS%E8%A3%85%E9%A5%B0%E5%99%A8/</a>
    </p>
    <p class="copyright-item">
      <span>è®¸å¯åè®®: </span>
      
      <a rel="license" href="http://creativecommons.org/licenses/by-nc/4.0/" target="_blank">çŸ¥è¯†å…±äº«ç½²å-éå•†ä¸šæ€§ä½¿ç”¨ 4.0 å›½é™…è®¸å¯åè®®</a>
    </p>
  </div>



      
      
  <div class="post-reward">
    <input type="checkbox" name="reward" id="reward" hidden />
    <label class="reward-button" for="reward">èµèµæ”¯æŒ</label>
    <div class="qr-code">
      
      
        <label class="qr-code-image" for="reward">
          <img class="image" src="/image/reward/wechat.png" title="wechat">
        </label>
      
      
        <label class="qr-code-image" for="reward">
          <img class="image" src="/image/reward/alipay.png" title="alipay">
        </label>
      
    </div>
  </div>

    

    
      <footer class="post-footer">
        
          <div class="post-tags">
            
              <a href="/tags/decorator/">decorator</a>
            
          </div>
        
        
        
  <nav class="post-nav">
    
      <a class="prev" href="/2021/01/16/ReflectMetadata/">
        <i class="iconfont icon-left"></i>
        <span class="prev-text nav-default">ReflectMetadata</span>
        <span class="prev-text nav-mobile">ä¸Šä¸€ç¯‡</span>
      </a>
    
    
      <a class="next" href="/2021/01/05/Java%20%E9%9B%86%E5%90%88%E6%A1%86%E6%9E%B6(Collections)/">
        <span class="next-text nav-default">Java collections framework</span>
        <span class="prev-text nav-mobile">ä¸‹ä¸€ç¯‡</span>
        <i class="iconfont icon-right"></i>
      </a>
    
  </nav>

      </footer>
    

  </article>


          </div>
          
  <div class="comments" id="comments">
    
  </div>


        </div>
      </main>

      <footer id="footer" class="footer">

  <div class="social-links">
    
      
        
          <a href="mailto:fynn.90@outlook.com" class="iconfont icon-email" title="email"></a>
        
      
    
      
    
      
    
      
        
          <a target="_blank" rel="noopener" href="https://www.linkedin.com/in/%E5%B8%86-%E9%82%93-17163589/" class="iconfont icon-linkedin" title="linkedin"></a>
        
      
    
      
        
          <a target="_blank" rel="noopener" href="https://github.com/fynn90" class="iconfont icon-github" title="github"></a>
        
      
    
      
        
          <a target="_blank" rel="noopener" href="http://www.weibo.com/306019091" class="iconfont icon-weibo" title="weibo"></a>
        
      
    
      
        
          <a target="_blank" rel="noopener" href="https://www.zhihu.com/people/FynnDeng/activities" class="iconfont icon-zhihu" title="zhihu"></a>
        
      
    
      
    
      
    
      
    
    
    
  </div>


<div class="copyright">
  <span class="copyright-year">
    
    &copy; 
     
      2017 - 
    
    2021

    <span class="heart">
      <i class="iconfont icon-heart"></i>
    </span>
    <span class="author">Fynn</span>
  </span>
  
</div>

      </footer>

      <div class="back-to-top" id="back-to-top">
        <i class="iconfont icon-up"></i>
      </div>
    </div>

    
  
  

  



    
  





  
    <script type="text/javascript" src="/lib/jquery/jquery-3.1.1.min.js"></script>
  

  
    <script type="text/javascript" src="/lib/slideout/slideout.js"></script>
  

  
    <script type="text/javascript" src="/lib/fancybox/jquery.fancybox.pack.js"></script>
  


    <script type="text/javascript" src="/js/src/even.js?v=2.6.0"></script>
<script type="text/javascript" src="/js/src/bootstrap.js?v=2.6.0"></script>

  </body>
</html>
