<!DOCTYPE html>
<html lang="zh-cn">
  <head>
    
<meta charset="UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=edge" />
<meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1"/>


<meta http-equiv="Cache-Control" content="no-transform" />
<meta http-equiv="Cache-Control" content="no-siteapp" />



  <meta name="description" content="InversifyJS"/>




  <meta name="keywords" content="InversifyJS,IoC," />




  <link rel="alternate" href="/atom.xml" title="Fynn's Blog" type="application/atom+xml">




  <link rel="shortcut icon" type="image/x-icon" href="/favicon.ico?v=1.1.2" />



<link rel="canonical" href="https://fynn90.github.io/2021/02/18/InversifyJS/"/>


<meta name="description" content="InversifyJS 是一个轻量的 (4KB) 控制反转容器 (IoC)，可用于编写 TypeScript 和 JavaScript 应用。 它使用类构造函数去定义和注入它的依赖。 因为 ES6 之后 JavaScript 支持用 Class 方式用于OOP编程，但要做好 OOP 设计是很困难的，InversifyJS 它能帮助 JavaScript 开发者，写出出色的面向对象设计的代码。 I">
<meta property="og:type" content="article">
<meta property="og:title" content="InversifyJS">
<meta property="og:url" content="https://fynn90.github.io/2021/02/18/InversifyJS/index.html">
<meta property="og:site_name" content="Fynn&#39;s Blog">
<meta property="og:description" content="InversifyJS 是一个轻量的 (4KB) 控制反转容器 (IoC)，可用于编写 TypeScript 和 JavaScript 应用。 它使用类构造函数去定义和注入它的依赖。 因为 ES6 之后 JavaScript 支持用 Class 方式用于OOP编程，但要做好 OOP 设计是很困难的，InversifyJS 它能帮助 JavaScript 开发者，写出出色的面向对象设计的代码。 I">
<meta property="og:locale" content="zh_CN">
<meta property="og:image" content="https://img.imgdb.cn/item/60210c323ffa7d37b39eaaa8.jpg">
<meta property="article:published_time" content="2021-02-18T09:47:00.000Z">
<meta property="article:modified_time" content="2021-02-18T08:37:48.421Z">
<meta property="article:author" content="Fynn">
<meta property="article:tag" content="InversifyJS">
<meta property="article:tag" content="IoC">
<meta name="twitter:card" content="summary">
<meta name="twitter:image" content="https://img.imgdb.cn/item/60210c323ffa7d37b39eaaa8.jpg">


<link rel="stylesheet" type="text/css" href="/css/style.css?v=1.1.2" />



  <link rel="stylesheet" type="text/css" href="/lib/fancybox/jquery.fancybox.css" />





<script>
  var CONFIG = {
    search: false,
    searchPath: "/search.xml",
    fancybox: true,
    toc: true,
  }
</script>




  
  <script type="text/javascript">
    var _hmt = _hmt || [];
    (function() {
      var hm = document.createElement("script");
      hm.src = "https://hm.baidu.com/hm.js?607980a031d3edcefed502ce80e77ffb";
      var s = document.getElementsByTagName("script")[0];
      s.parentNode.insertBefore(hm, s);
    })();
  </script>


  <script type="text/javascript">
    (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
        (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
        m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
        })(window,document,'script','//www.google-analytics.com/analytics.js','ga');

        ga('create', 'UA-115728733-1', 'auto');
        ga('send', 'pageview');
  </script>



    <title> InversifyJS · Fynn's Blog </title>
  <meta name="generator" content="Hexo 5.4.0"></head>

  <body><div id="mobile-navbar" class="mobile-navbar">
  <div class="mobile-header-logo">
    <a href="/." class="logo">Fynn's Blog</a>
  </div>
  <div class="mobile-navbar-icon">
    <span></span>
    <span></span>
    <span></span>
  </div>
</div>

<nav id="mobile-menu" class="mobile-menu slideout-menu">
  <ul class="mobile-menu-list">
    
      <a href="/">
        <li class="mobile-menu-item">
          
          
            Home
          
        </li>
      </a>
    
      <a href="/archives/">
        <li class="mobile-menu-item">
          
          
            Archives
          
        </li>
      </a>
    
      <a href="/categories">
        <li class="mobile-menu-item">
          
          
            Categories
          
        </li>
      </a>
    
  </ul>
</nav>

    <div class="container" id="mobile-panel">
      <header id="header" class="header"><div class="logo-wrapper">
  <a href="/." class="logo">Fynn's Blog</a>
</div>

<nav class="site-navbar">
  
    <ul id="menu" class="menu">
      
        <li class="menu-item">
          <a class="menu-item-link" href="/">
            
            
              首页
            
          </a>
        </li>
      
        <li class="menu-item">
          <a class="menu-item-link" href="/archives/">
            
            
              归档
            
          </a>
        </li>
      
        <li class="menu-item">
          <a class="menu-item-link" href="/categories">
            
            
              分类
            
          </a>
        </li>
      
      
    </ul>
  
</nav>

      </header>

      <main id="main" class="main">
        <div class="content-wrapper">
          <div id="content" class="content">
            
  
  <article class="post">
    <header class="post-header">
      <h1 class="post-title">
        
          InversifyJS
        
      </h1>

      <div class="post-meta">
        <span class="post-time">
          2021年2月18日
        </span>
      </div>
    </header>

    
    
  <div class="post-toc" id="post-toc">
    <h2 class="post-toc-title">文章目录</h2>
    <div class="post-toc-content">
      <ol class="toc"><li class="toc-item toc-level-2"><a class="toc-link" href="#%E5%AE%89%E8%A3%85"><span class="toc-text">安装</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E4%B8%80%E4%B8%AA%E7%AE%80%E5%8D%95%E4%BE%8B%E5%AD%90-%F0%9F%8C%B0"><span class="toc-text">一个简单例子 🌰</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E6%A0%B8%E5%BF%83%E8%83%BD%E5%8A%9B"><span class="toc-text">核心能力</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%AE%B9%E5%99%A8%E6%A8%A1%E5%9D%97"><span class="toc-text">容器模块</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E6%B3%A8%E5%85%A5%E5%B7%A5%E5%8E%82"><span class="toc-text">注入工厂</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E6%BF%80%E6%B4%BB%E5%8F%A5%E6%9F%84"><span class="toc-text">激活句柄</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E6%9E%84%E9%80%A0%E5%99%A8%E5%90%8E%E7%BD%AE%E8%A3%85%E9%A5%B0%E5%99%A8"><span class="toc-text">构造器后置装饰器</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%90%8D%E7%A7%B0%E7%BB%91%E5%AE%9A"><span class="toc-text">名称绑定</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E4%B8%AD%E9%97%B4%E4%BB%B6"><span class="toc-text">中间件</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%B1%82%E6%AC%A1%E5%8C%96%E7%9A%84%E4%BE%9D%E8%B5%96%E5%80%92%E7%BD%AE%E7%B3%BB%E7%BB%9F"><span class="toc-text">层次化的依赖倒置系统</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E9%97%AE%E9%A2%98"><span class="toc-text">问题</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%BE%AA%E7%8E%AF%E4%BE%9D%E8%B5%96"><span class="toc-text">循环依赖</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E7%BB%A7%E6%89%BF"><span class="toc-text">继承</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#%E4%BD%BF%E7%94%A8-unmanaged-%E8%A3%85%E9%A5%B0%E5%99%A8"><span class="toc-text">使用 @unmanaged 装饰器</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E5%B1%9E%E6%80%A7%E8%AE%BE%E7%BD%AE%E5%99%A8"><span class="toc-text">属性设置器</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E5%B1%9E%E6%80%A7%E6%B3%A8%E5%85%A5"><span class="toc-text">属性注入</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E6%B3%A8%E5%85%A5%E5%88%B0%E5%AD%90%E7%B1%BB"><span class="toc-text">注入到子类</span></a></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E7%AC%AC%E4%B8%89%E6%96%B9%E5%9F%BA%E7%B1%BB%E4%BD%BF%E7%94%A8"><span class="toc-text">第三方基类使用</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E6%9C%80%E4%BD%B3%E5%AE%9E%E8%B7%B5"><span class="toc-text">最佳实践</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#%E7%BB%84%E5%90%88%E9%87%8D%E7%94%A8%E5%8E%9F%E5%88%99"><span class="toc-text">组合重用原则</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E4%BE%9D%E8%B5%96%E5%80%92%E7%BD%AE%E5%8E%9F%E5%88%99"><span class="toc-text">依赖倒置原则</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E9%81%BF%E5%85%8D%E6%B3%A8%E5%85%A5%E6%95%B0%E6%8D%AE%EF%BC%8C%E8%80%8C%E4%B8%8D%E6%98%AF%E8%A1%8C%E4%B8%BA"><span class="toc-text">避免注入数据，而不是行为</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E9%81%BF%E5%85%8D%E5%B0%86%E6%89%80%E6%9C%89%E7%9A%84%E7%94%9F%E5%91%BD%E5%91%A8%E6%9C%9F%E5%A3%B0%E6%98%8E%E4%B8%BA%E5%8D%95%E4%BE%8B"><span class="toc-text">避免将所有的生命周期声明为单例</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E9%81%BF%E5%85%8D%E6%9E%84%E9%80%A0%E5%99%A8%E7%9A%84%E8%BF%87%E5%BA%A6%E6%B3%A8%E5%85%A5"><span class="toc-text">避免构造器的过度注入</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#Refer-To"><span class="toc-text">Refer To</span></a></li></ol>
    </div>
  </div>


    <div class="post-content">
      
        <p><img src="https://img.imgdb.cn/item/60210c323ffa7d37b39eaaa8.jpg"></p>
<p><a target="_blank" rel="noopener" href="https://inversify.io/">InversifyJS</a> 是一个轻量的 (4KB) 控制反转容器 (<a target="_blank" rel="noopener" href="https://zh.wikipedia.org/wiki/%E6%8E%A7%E5%88%B6%E5%8F%8D%E8%BD%AC">IoC</a>)，可用于编写 TypeScript 和 JavaScript 应用。 它使用类构造函数去定义和注入它的依赖。</p>
<p>因为 ES6 之后 JavaScript 支持用 Class 方式用于<a target="_blank" rel="noopener" href="https://zh.wikipedia.org/wiki/%E9%9D%A2%E5%90%91%E5%AF%B9%E8%B1%A1%E7%A8%8B%E5%BA%8F%E8%AE%BE%E8%AE%A1">OOP</a>编程，但要做好 OOP 设计是很困难的，InversifyJS 它能帮助 JavaScript 开发者，写出出色的面向对象设计的代码。</p>
<p>InversifyJS 的设计哲学：</p>
<ul>
<li>允许 JavaScript 开发人员编写遵循 <a target="_blank" rel="noopener" href="https://zh.wikipedia.org/zh-sg/SOLID_(%E9%9D%A2%E5%90%91%E5%AF%B9%E8%B1%A1%E8%AE%BE%E8%AE%A1)">SOLID</a> 原则的代码</li>
<li>促进并鼓励遵守最佳的 OOP 编程和 IoC 实践</li>
<li>尽可能少的运行时开销</li>
<li>提供<a target="_blank" rel="noopener" href="https://github.com/inversify/InversifyJS/blob/master/wiki/ecosystem.md">艺术编程体验和生态</a></li>
</ul>
<span id="more"></span>

<h2 id="安装"><a href="#安装" class="headerlink" title="安装"></a>安装</h2><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">$ npm install inversify reflect-metadata --save</span><br></pre></td></tr></table></figure>

<p>InversifyJS 依赖于 TypeScript 2.0。需要对<code>tsconfig.json</code>的<code>compilerOptions</code>进行<code>experimentalDecorators</code>,<code>emitDecoratorMetadata</code>,<code>type</code>和<code>lib</code>配置：</p>
<figure class="highlight json"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">&#123;</span><br><span class="line">  <span class="attr">&quot;compilerOptions&quot;</span>: &#123;</span><br><span class="line">    <span class="attr">&quot;target&quot;</span>: <span class="string">&quot;es5&quot;</span>,</span><br><span class="line">    <span class="attr">&quot;lib&quot;</span>: [<span class="string">&quot;es6&quot;</span>, <span class="string">&quot;dom&quot;</span>],</span><br><span class="line">    <span class="attr">&quot;types&quot;</span>: [<span class="string">&quot;reflect-metadata&quot;</span>],</span><br><span class="line">    <span class="attr">&quot;module&quot;</span>: <span class="string">&quot;commonjs&quot;</span>,</span><br><span class="line">    <span class="attr">&quot;moduleResolution&quot;</span>: <span class="string">&quot;node&quot;</span>,</span><br><span class="line">    <span class="attr">&quot;experimentalDecorators&quot;</span>: <span class="literal">true</span>,</span><br><span class="line">    <span class="attr">&quot;emitDecoratorMetadata&quot;</span>: <span class="literal">true</span></span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>inversifyjs 需要现代 JavaScript 引擎，支持以下特性</p>
<ul>
<li><a target="_blank" rel="noopener" href="https://rbuckton.github.io/reflect-metadata/">Reflect metadata</a></li>
<li><a target="_blank" rel="noopener" href="https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Global_Objects/Map">Map</a></li>
<li><a target="_blank" rel="noopener" href="https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Global_Objects/Promise">Promise</a> (Only required if using <a target="_blank" rel="noopener" href="https://github.com/inversify/InversifyJS/blob/master/wiki/provider_injection.md">provider injection</a>)</li>
<li><a target="_blank" rel="noopener" href="https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Global_Objects/Proxy">Proxy</a> (Only required if using <a target="_blank" rel="noopener" href="https://github.com/inversify/InversifyJS/blob/master/wiki/activation_handler.md">activation handlers</a>)</li>
</ul>
<p>如果您的  运行环境不支持  这些  特性，您可能需要导入 <code>shim</code> 或 <code>polyfill</code></p>
<blockquote>
<p>：警示： <strong><code>reflect-metadata</code> <code>polyfill</code> 应该在您整个应用中只导入一次</strong> 因为 <code>Reflect</code> 对象  需要成为一个全局的单例。 更多细节可以在<a target="_blank" rel="noopener" href="https://github.com/inversify/InversifyJS/issues/262#issuecomment-227593844">这里</a>找到。</p>
</blockquote>
<p>查看维基中的<a target="_blank" rel="noopener" href="https://github.com/inversify/InversifyJS/blob/master/wiki/environment.md">开发环境 <code>polyfills</code></a> , 还可以从<a target="_blank" rel="noopener" href="https://github.com/inversify/inversify-basic-example">基本示例</a>中去学习.</p>
<h2 id="一个简单例子-🌰"><a href="#一个简单例子-🌰" class="headerlink" title="一个简单例子 🌰"></a><a target="_blank" rel="noopener" href="https://github.com/fynn90/InversifyJS-demo/tree/main/demo1">一个简单例子 🌰</a></h2><figure class="highlight typescript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// entites.ts</span></span><br><span class="line"><span class="keyword">import</span> &#123; injectable, inject &#125; <span class="keyword">from</span> <span class="string">&quot;inversify&quot;</span>;</span><br><span class="line"><span class="keyword">import</span> <span class="string">&quot;reflect-metadata&quot;</span>;</span><br><span class="line"><span class="keyword">import</span> &#123; Weapon, ThrowableWeapon, Warrior &#125; <span class="keyword">from</span> <span class="string">&quot;./interfaces&quot;</span>;</span><br><span class="line"><span class="keyword">import</span> &#123; TYPES &#125; <span class="keyword">from</span> <span class="string">&quot;./types&quot;</span>;</span><br><span class="line"></span><br><span class="line"><span class="meta">@injectable</span>()</span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Katana</span> <span class="title">implements</span> <span class="title">Weapon</span> </span>&#123;</span><br><span class="line">  <span class="keyword">public</span> <span class="function"><span class="title">hit</span>(<span class="params"></span>)</span> &#123;</span><br><span class="line">    <span class="keyword">return</span> <span class="string">&quot;cut!&quot;</span>;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="meta">@injectable</span>()</span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Shuriken</span> <span class="title">implements</span> <span class="title">ThrowableWeapon</span> </span>&#123;</span><br><span class="line">  <span class="keyword">public</span> <span class="keyword">throw</span>() &#123;</span><br><span class="line">    <span class="keyword">return</span> <span class="string">&quot;hit!&quot;</span>;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="meta">@injectable</span>()</span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Ninja</span> <span class="title">implements</span> <span class="title">Warrior</span> </span>&#123;</span><br><span class="line">  <span class="keyword">private</span> _katana: Weapon;</span><br><span class="line">  <span class="keyword">private</span> _shuriken: ThrowableWeapon;</span><br><span class="line"></span><br><span class="line">  <span class="keyword">public</span> <span class="function"><span class="title">constructor</span>(<span class="params"></span></span></span><br><span class="line"><span class="params"><span class="function">    <span class="meta">@inject</span>(TYPES.Weapon) katana: Weapon,</span></span></span><br><span class="line"><span class="params"><span class="function">    <span class="meta">@inject</span>(TYPES.ThrowableWeapon) shuriken: ThrowableWeapon</span></span></span><br><span class="line"><span class="params"><span class="function">  </span>)</span> &#123;</span><br><span class="line">    <span class="built_in">this</span>._katana = katana;</span><br><span class="line">    <span class="built_in">this</span>._shuriken = shuriken;</span><br><span class="line">  &#125;</span><br><span class="line">  fight(): <span class="built_in">string</span> &#123;</span><br><span class="line">    <span class="keyword">return</span> <span class="built_in">this</span>._katana.hit();</span><br><span class="line">  &#125;</span><br><span class="line">  sneak(): <span class="built_in">string</span> &#123;</span><br><span class="line">    <span class="keyword">return</span> <span class="built_in">this</span>._shuriken.throw();</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">export</span> &#123; Ninja, Katana, Shuriken &#125;;</span><br><span class="line"></span><br><span class="line"><span class="comment">// interface.ts</span></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">interface</span> Warrior &#123;</span><br><span class="line">  fight(): <span class="built_in">string</span>;</span><br><span class="line">  sneak(): <span class="built_in">string</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">interface</span> Weapon &#123;</span><br><span class="line">  hit(): <span class="built_in">string</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">interface</span> ThrowableWeapon &#123;</span><br><span class="line">  <span class="keyword">throw</span>(): <span class="built_in">string</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// types.ts</span></span><br><span class="line"><span class="keyword">const</span> TYPES = &#123;</span><br><span class="line">  <span class="attr">Warrior</span>: <span class="built_in">Symbol</span>.for(<span class="string">&quot;Warrior&quot;</span>),</span><br><span class="line">  <span class="attr">Weapon</span>: <span class="built_in">Symbol</span>.for(<span class="string">&quot;Weapon&quot;</span>),</span><br><span class="line">  <span class="attr">ThrowableWeapon</span>: <span class="built_in">Symbol</span>.for(<span class="string">&quot;ThrowableWeapon&quot;</span>),</span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line"><span class="keyword">export</span> &#123; TYPES &#125;;</span><br><span class="line"></span><br><span class="line"><span class="comment">// inversify.config.ts</span></span><br><span class="line"><span class="keyword">import</span> &#123; Container &#125; <span class="keyword">from</span> <span class="string">&quot;inversify&quot;</span>;</span><br><span class="line"><span class="keyword">import</span> &#123; TYPES &#125; <span class="keyword">from</span> <span class="string">&quot;./types&quot;</span>;</span><br><span class="line"><span class="keyword">import</span> &#123; Warrior, Weapon, ThrowableWeapon &#125; <span class="keyword">from</span> <span class="string">&quot;./interfaces&quot;</span>;</span><br><span class="line"><span class="keyword">import</span> &#123; Ninja, Katana, Shuriken &#125; <span class="keyword">from</span> <span class="string">&quot;./entities&quot;</span>;</span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> myContainer = <span class="keyword">new</span> Container();</span><br><span class="line">myContainer.bind&lt;Warrior&gt;(TYPES.Warrior).to(Ninja);</span><br><span class="line">myContainer.bind&lt;Weapon&gt;(TYPES.Weapon).to(Katana);</span><br><span class="line">myContainer.bind&lt;ThrowableWeapon&gt;(TYPES.ThrowableWeapon).to(Shuriken);</span><br><span class="line"></span><br><span class="line"><span class="keyword">export</span> &#123; myContainer &#125;;</span><br><span class="line"></span><br><span class="line"><span class="comment">// index.ts</span></span><br><span class="line"><span class="keyword">import</span> <span class="string">&quot;reflect-metadata&quot;</span>;</span><br><span class="line"><span class="keyword">import</span> &#123; Warrior &#125; <span class="keyword">from</span> <span class="string">&quot;./interfaces&quot;</span>;</span><br><span class="line"><span class="keyword">import</span> &#123; myContainer &#125; <span class="keyword">from</span> <span class="string">&quot;./inversify.config&quot;</span>;</span><br><span class="line"><span class="keyword">import</span> &#123; TYPES &#125; <span class="keyword">from</span> <span class="string">&quot;./types&quot;</span>;</span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> ninja = myContainer.get&lt;Warrior&gt;(TYPES.Warrior);</span><br><span class="line"></span><br><span class="line"><span class="built_in">console</span>.log(ninja.fight());</span><br></pre></td></tr></table></figure>

<ul>
<li><code>injectable</code> - 声明 class 可以用来注入</li>
<li><code>inject</code> - 用来声明来需要注入的 对象</li>
</ul>
<p><strong>inversify.config.ts</strong> 说明 声明和对象之间的关系。这个文件是 inversifyJS 用来管理声明和对象之间关系的。</p>
<p><code>myContainer.get&lt;Warrior&gt;(TYPES.Warrior)</code> 获取需要使用的对象</p>
<h2 id="核心能力"><a href="#核心能力" class="headerlink" title="核心能力"></a>核心能力</h2><h3 id="容器模块"><a href="#容器模块" class="headerlink" title="容器模块"></a><a target="_blank" rel="noopener" href="https://github.com/fynn90/InversifyJS-demo/tree/main/demo3">容器模块</a></h3><p>当应用项目很复杂的时候，借助容器模块可以帮助我们管理应用中复杂的绑定关系</p>
<figure class="highlight typescript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// entities.ts</span></span><br><span class="line"><span class="keyword">import</span> &#123; injectable, inject &#125; <span class="keyword">from</span> <span class="string">&quot;inversify&quot;</span>;</span><br><span class="line"><span class="keyword">import</span> <span class="string">&quot;reflect-metadata&quot;</span>;</span><br><span class="line"><span class="keyword">import</span> &#123; Weapon, ThrowableWeapon, Warrior &#125; <span class="keyword">from</span> <span class="string">&quot;./interfaces&quot;</span>;</span><br><span class="line"><span class="keyword">import</span> &#123; TYPES &#125; <span class="keyword">from</span> <span class="string">&quot;./types&quot;</span>;</span><br><span class="line"></span><br><span class="line"><span class="meta">@injectable</span>()</span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Katana</span> <span class="title">implements</span> <span class="title">Weapon</span> </span>&#123;</span><br><span class="line">  <span class="keyword">public</span> <span class="function"><span class="title">hit</span>(<span class="params"></span>)</span> &#123;</span><br><span class="line">    <span class="keyword">return</span> <span class="string">&quot;cut!&quot;</span>;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="meta">@injectable</span>()</span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Shuriken</span> <span class="title">implements</span> <span class="title">ThrowableWeapon</span> </span>&#123;</span><br><span class="line">  <span class="keyword">public</span> <span class="keyword">throw</span>() &#123;</span><br><span class="line">    <span class="keyword">return</span> <span class="string">&quot;hit!&quot;</span>;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="meta">@injectable</span>()</span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Ninja</span> <span class="title">implements</span> <span class="title">Warrior</span> </span>&#123;</span><br><span class="line">  <span class="keyword">private</span> _katana: Weapon;</span><br><span class="line">  <span class="keyword">private</span> _shuriken: ThrowableWeapon;</span><br><span class="line"></span><br><span class="line">  <span class="keyword">public</span> <span class="function"><span class="title">constructor</span>(<span class="params"></span></span></span><br><span class="line"><span class="params"><span class="function">    <span class="meta">@inject</span>(TYPES.Weapon) katana: Weapon,</span></span></span><br><span class="line"><span class="params"><span class="function">    <span class="meta">@inject</span>(TYPES.ThrowableWeapon) shuriken: ThrowableWeapon</span></span></span><br><span class="line"><span class="params"><span class="function">  </span>)</span> &#123;</span><br><span class="line">    <span class="built_in">this</span>._katana = katana;</span><br><span class="line">    <span class="built_in">this</span>._shuriken = shuriken;</span><br><span class="line">  &#125;</span><br><span class="line">  fight(): <span class="built_in">string</span> &#123;</span><br><span class="line">    <span class="keyword">return</span> <span class="built_in">this</span>._katana.hit();</span><br><span class="line">  &#125;</span><br><span class="line">  sneak(): <span class="built_in">string</span> &#123;</span><br><span class="line">    <span class="keyword">return</span> <span class="built_in">this</span>._shuriken.throw();</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">export</span> &#123; Ninja, Katana, Shuriken &#125;;</span><br><span class="line"></span><br><span class="line"><span class="comment">// interfaces.ts</span></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">interface</span> Warrior &#123;</span><br><span class="line">  fight(): <span class="built_in">string</span>;</span><br><span class="line">  sneak(): <span class="built_in">string</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">interface</span> Weapon &#123;</span><br><span class="line">  hit(): <span class="built_in">string</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">interface</span> ThrowableWeapon &#123;</span><br><span class="line">  <span class="keyword">throw</span>(): <span class="built_in">string</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// inversify.config.ts</span></span><br><span class="line"><span class="keyword">import</span> &#123; Container, ContainerModule, interfaces &#125; <span class="keyword">from</span> <span class="string">&quot;inversify&quot;</span>;</span><br><span class="line"><span class="keyword">import</span> &#123; TYPES &#125; <span class="keyword">from</span> <span class="string">&quot;./types&quot;</span>;</span><br><span class="line"><span class="keyword">import</span> &#123; Warrior, Weapon, ThrowableWeapon &#125; <span class="keyword">from</span> <span class="string">&quot;./interfaces&quot;</span>;</span><br><span class="line"><span class="keyword">import</span> &#123; Ninja, Katana, Shuriken &#125; <span class="keyword">from</span> <span class="string">&quot;./entities&quot;</span>;</span><br><span class="line"></span><br><span class="line"><span class="comment">// 容器可以用来绑定 class直接的关系</span></span><br><span class="line"><span class="keyword">let</span> warriorModule = <span class="keyword">new</span> ContainerModule(</span><br><span class="line">  <span class="function">(<span class="params">bind: interfaces.Bind, unbind: interfaces.Unbind</span>) =&gt;</span> &#123;</span><br><span class="line">    bind&lt;Warrior&gt;(TYPES.Warrior).to(Ninja);</span><br><span class="line">  &#125;</span><br><span class="line">);</span><br><span class="line"></span><br><span class="line"><span class="keyword">let</span> weaponModule = <span class="keyword">new</span> ContainerModule(</span><br><span class="line">  <span class="function">(<span class="params">bind: interfaces.Bind, unbind: interfaces.Unbind</span>) =&gt;</span> &#123;</span><br><span class="line">    bind&lt;Weapon&gt;(TYPES.Weapon).to(Katana);</span><br><span class="line">  &#125;</span><br><span class="line">);</span><br><span class="line"></span><br><span class="line"><span class="keyword">let</span> throwableWeaponModule = <span class="keyword">new</span> ContainerModule(</span><br><span class="line">  <span class="function">(<span class="params">bind: interfaces.Bind, unbind: interfaces.Unbind</span>) =&gt;</span> &#123;</span><br><span class="line">    bind&lt;ThrowableWeapon&gt;(TYPES.ThrowableWeapon).to(Shuriken);</span><br><span class="line">  &#125;</span><br><span class="line">);</span><br><span class="line"></span><br><span class="line"><span class="keyword">let</span> container = <span class="keyword">new</span> Container();</span><br><span class="line"></span><br><span class="line">container.load(warriorModule, weaponModule, throwableWeaponModule);</span><br><span class="line"></span><br><span class="line"><span class="keyword">export</span> &#123; warriorModule, weaponModule, throwableWeaponModule &#125;;</span><br><span class="line"></span><br><span class="line"><span class="comment">// types.ts</span></span><br><span class="line"><span class="keyword">const</span> TYPES = &#123;</span><br><span class="line">  <span class="attr">Warrior</span>: <span class="built_in">Symbol</span>.for(<span class="string">&quot;Warrior&quot;</span>),</span><br><span class="line">  <span class="attr">Weapon</span>: <span class="built_in">Symbol</span>.for(<span class="string">&quot;Weapon&quot;</span>),</span><br><span class="line">  <span class="attr">ThrowableWeapon</span>: <span class="built_in">Symbol</span>.for(<span class="string">&quot;ThrowableWeapon&quot;</span>),</span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line"><span class="keyword">export</span> &#123; TYPES &#125;;</span><br><span class="line"></span><br><span class="line"><span class="comment">// index.ts</span></span><br><span class="line"><span class="keyword">import</span> &#123; Container &#125; <span class="keyword">from</span> <span class="string">&quot;inversify&quot;</span>;</span><br><span class="line"><span class="keyword">import</span> <span class="string">&quot;reflect-metadata&quot;</span>;</span><br><span class="line"><span class="keyword">import</span> &#123; Warrior &#125; <span class="keyword">from</span> <span class="string">&quot;./interfaces&quot;</span>;</span><br><span class="line"><span class="keyword">import</span> &#123;</span><br><span class="line">  warriorModule,</span><br><span class="line">  weaponModule,</span><br><span class="line">  throwableWeaponModule,</span><br><span class="line">&#125; <span class="keyword">from</span> <span class="string">&quot;./inversify.config&quot;</span>;</span><br><span class="line"><span class="keyword">import</span> &#123; TYPES &#125; <span class="keyword">from</span> <span class="string">&quot;./types&quot;</span>;</span><br><span class="line"></span><br><span class="line"><span class="keyword">let</span> container = <span class="keyword">new</span> Container();</span><br><span class="line"></span><br><span class="line">container.load(warriorModule, weaponModule, throwableWeaponModule);</span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> ninja = container.get&lt;Warrior&gt;(TYPES.Warrior);</span><br><span class="line"></span><br><span class="line"><span class="built_in">console</span>.log(ninja.fight());</span><br></pre></td></tr></table></figure>

<h3 id="注入工厂"><a href="#注入工厂" class="headerlink" title="注入工厂"></a><a target="_blank" rel="noopener" href="https://github.com/inversify/InversifyJS/blob/master/wiki/factory_injection.md">注入工厂</a></h3><figure class="highlight typescript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// entities.ts</span></span><br><span class="line"><span class="keyword">import</span> &#123; injectable, inject &#125; <span class="keyword">from</span> <span class="string">&quot;inversify&quot;</span>;</span><br><span class="line"><span class="keyword">import</span> <span class="string">&quot;reflect-metadata&quot;</span>;</span><br><span class="line"><span class="keyword">import</span> &#123; Weapon, ThrowableWeapon, Warrior &#125; <span class="keyword">from</span> <span class="string">&quot;./interfaces&quot;</span>;</span><br><span class="line"><span class="keyword">import</span> &#123; TYPES &#125; <span class="keyword">from</span> <span class="string">&quot;./types&quot;</span>;</span><br><span class="line"></span><br><span class="line"><span class="meta">@injectable</span>()</span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Katana</span> <span class="title">implements</span> <span class="title">Weapon</span> </span>&#123;</span><br><span class="line">  <span class="keyword">public</span> <span class="function"><span class="title">hit</span>(<span class="params"></span>)</span> &#123;</span><br><span class="line">    <span class="keyword">return</span> <span class="string">&quot;cut!&quot;</span>;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="meta">@injectable</span>()</span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Shuriken</span> <span class="title">implements</span> <span class="title">ThrowableWeapon</span> </span>&#123;</span><br><span class="line">  <span class="keyword">public</span> <span class="keyword">throw</span>() &#123;</span><br><span class="line">    <span class="keyword">return</span> <span class="string">&quot;hit!&quot;</span>;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="meta">@injectable</span>()</span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Ninja</span> <span class="title">implements</span> <span class="title">Warrior</span> </span>&#123;</span><br><span class="line">  <span class="keyword">private</span> _katana: Weapon;</span><br><span class="line">  <span class="keyword">private</span> _shuriken: ThrowableWeapon;</span><br><span class="line"></span><br><span class="line">  <span class="keyword">public</span> <span class="function"><span class="title">constructor</span>(<span class="params"></span></span></span><br><span class="line"><span class="params"><span class="function">    <span class="comment">// 绑定一个工厂函数</span></span></span></span><br><span class="line"><span class="params"><span class="function">    <span class="meta">@inject</span>(TYPES.Weapon) katana: (n: <span class="built_in">any</span>) =&gt; Weapon,</span></span></span><br><span class="line"><span class="params"><span class="function">    <span class="meta">@inject</span>(TYPES.ThrowableWeapon) shuriken: ThrowableWeapon</span></span></span><br><span class="line"><span class="params"><span class="function">  </span>)</span> &#123;</span><br><span class="line">    <span class="built_in">this</span>._katana = katana(<span class="number">1</span>); <span class="comment">// 可以向工厂函数传递参数</span></span><br><span class="line">    <span class="built_in">this</span>._shuriken = shuriken;</span><br><span class="line">  &#125;</span><br><span class="line">  fight(): <span class="built_in">string</span> &#123;</span><br><span class="line">    <span class="keyword">return</span> <span class="built_in">this</span>._katana.hit();</span><br><span class="line">  &#125;</span><br><span class="line">  sneak(): <span class="built_in">string</span> &#123;</span><br><span class="line">    <span class="keyword">return</span> <span class="built_in">this</span>._shuriken.throw();</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">export</span> &#123; Ninja, Katana, Shuriken &#125;;</span><br><span class="line"></span><br><span class="line"><span class="comment">// interfaces.ts</span></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">interface</span> Warrior &#123;</span><br><span class="line">  fight(): <span class="built_in">string</span>;</span><br><span class="line">  sneak(): <span class="built_in">string</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">interface</span> Weapon &#123;</span><br><span class="line">  hit(): <span class="built_in">string</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">interface</span> ThrowableWeapon &#123;</span><br><span class="line">  <span class="keyword">throw</span>(): <span class="built_in">string</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// types.ts</span></span><br><span class="line"><span class="keyword">const</span> TYPES = &#123;</span><br><span class="line">  <span class="attr">Warrior</span>: <span class="built_in">Symbol</span>.for(<span class="string">&quot;Warrior&quot;</span>),</span><br><span class="line">  <span class="attr">Weapon</span>: <span class="built_in">Symbol</span>.for(<span class="string">&quot;Weapon&quot;</span>),</span><br><span class="line">  <span class="attr">ThrowableWeapon</span>: <span class="built_in">Symbol</span>.for(<span class="string">&quot;ThrowableWeapon&quot;</span>),</span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line"><span class="keyword">export</span> &#123; TYPES &#125;;</span><br><span class="line"></span><br><span class="line"><span class="comment">// inversify.config.ts</span></span><br><span class="line"><span class="keyword">import</span> &#123; Container, interfaces &#125; <span class="keyword">from</span> <span class="string">&quot;inversify&quot;</span>;</span><br><span class="line"><span class="keyword">import</span> &#123; TYPES &#125; <span class="keyword">from</span> <span class="string">&quot;./types&quot;</span>;</span><br><span class="line"><span class="keyword">import</span> &#123; Warrior, Weapon, ThrowableWeapon &#125; <span class="keyword">from</span> <span class="string">&quot;./interfaces&quot;</span>;</span><br><span class="line"><span class="keyword">import</span> &#123; Ninja, Katana, Shuriken &#125; <span class="keyword">from</span> <span class="string">&quot;./entities&quot;</span>;</span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> myContainer = <span class="keyword">new</span> Container();</span><br><span class="line">myContainer.bind&lt;Warrior&gt;(TYPES.Warrior).to(Ninja);</span><br><span class="line">myContainer.bind&lt;Weapon&gt;(<span class="string">&quot;TYPES.Weapon&quot;</span>).to(Katana);</span><br><span class="line"><span class="comment">// 绑定工厂函数</span></span><br><span class="line">myContainer</span><br><span class="line">  .bind&lt;interfaces.Factory&lt;Weapon&gt;&gt;(TYPES.Weapon)</span><br><span class="line">  .toFactory&lt;Weapon&gt;(<span class="function">(<span class="params">context: interfaces.Context</span>) =&gt;</span> &#123;</span><br><span class="line">    <span class="keyword">return</span> <span class="function">(<span class="params">s</span>) =&gt;</span> &#123;</span><br><span class="line">      <span class="comment">// 接收参数</span></span><br><span class="line">      <span class="built_in">console</span>.log(s);</span><br><span class="line">      <span class="keyword">return</span> context.container.get&lt;Weapon&gt;(<span class="string">&quot;TYPES.Weapon&quot;</span>);</span><br><span class="line">    &#125;;</span><br><span class="line">  &#125;);</span><br><span class="line">myContainer.bind&lt;ThrowableWeapon&gt;(TYPES.ThrowableWeapon).to(Shuriken);</span><br><span class="line"></span><br><span class="line"><span class="keyword">export</span> &#123; myContainer &#125;;</span><br><span class="line"></span><br><span class="line"><span class="comment">// index.ts</span></span><br><span class="line"><span class="keyword">import</span> <span class="string">&quot;reflect-metadata&quot;</span>;</span><br><span class="line"><span class="keyword">import</span> &#123; Warrior &#125; <span class="keyword">from</span> <span class="string">&quot;./interfaces&quot;</span>;</span><br><span class="line"><span class="keyword">import</span> &#123; myContainer &#125; <span class="keyword">from</span> <span class="string">&quot;./inversify.config&quot;</span>;</span><br><span class="line"><span class="keyword">import</span> &#123; TYPES &#125; <span class="keyword">from</span> <span class="string">&quot;./types&quot;</span>;</span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> ninja = myContainer.get&lt;Warrior&gt;(TYPES.Warrior);</span><br><span class="line"></span><br><span class="line"><span class="built_in">console</span>.log(ninja.fight());</span><br><span class="line"><span class="comment">// 1</span></span><br><span class="line"><span class="comment">// cut!</span></span><br></pre></td></tr></table></figure>

<h3 id="激活句柄"><a href="#激活句柄" class="headerlink" title="激活句柄"></a><a target="_blank" rel="noopener" href="https://github.com/inversify/InversifyJS/blob/master/wiki/activation_handler.md">激活句柄</a></h3><p>给一个类型添加一个激活句柄是可能的。激活句柄在依赖被找到后、但是还没有被添加到缓存（如果是单例的话）并注入之前被调用。 这非常有用，因为这样可以让我们的依赖不必关注横切面（比如缓存、日志等）的具体实现。</p>
<figure class="highlight typescript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// entities.ts</span></span><br><span class="line"><span class="keyword">import</span> &#123; injectable, inject &#125; <span class="keyword">from</span> <span class="string">&quot;inversify&quot;</span>;</span><br><span class="line"><span class="keyword">import</span> <span class="string">&quot;reflect-metadata&quot;</span>;</span><br><span class="line"><span class="keyword">import</span> &#123; Weapon, ThrowableWeapon, Warrior &#125; <span class="keyword">from</span> <span class="string">&quot;./interfaces&quot;</span>;</span><br><span class="line"><span class="keyword">import</span> &#123; TYPES &#125; <span class="keyword">from</span> <span class="string">&quot;./types&quot;</span>;</span><br><span class="line"></span><br><span class="line"><span class="meta">@injectable</span>()</span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Katana</span> <span class="title">implements</span> <span class="title">Weapon</span> </span>&#123;</span><br><span class="line">  <span class="keyword">public</span> <span class="function"><span class="title">hit</span>(<span class="params"></span>)</span> &#123;</span><br><span class="line">    <span class="keyword">return</span> <span class="string">&quot;cut!&quot;</span>;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="meta">@injectable</span>()</span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Shuriken</span> <span class="title">implements</span> <span class="title">ThrowableWeapon</span> </span>&#123;</span><br><span class="line">  <span class="keyword">public</span> <span class="keyword">throw</span>() &#123;</span><br><span class="line">    <span class="keyword">return</span> <span class="string">&quot;hit!&quot;</span>;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="meta">@injectable</span>()</span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Ninja</span> <span class="title">implements</span> <span class="title">Warrior</span> </span>&#123;</span><br><span class="line">  <span class="keyword">private</span> _katana: Weapon;</span><br><span class="line">  <span class="keyword">private</span> _shuriken: ThrowableWeapon;</span><br><span class="line"></span><br><span class="line">  <span class="keyword">public</span> <span class="function"><span class="title">constructor</span>(<span class="params"></span></span></span><br><span class="line"><span class="params"><span class="function">    <span class="meta">@inject</span>(TYPES.Weapon) katana: Weapon,</span></span></span><br><span class="line"><span class="params"><span class="function">    <span class="meta">@inject</span>(TYPES.ThrowableWeapon) shuriken: ThrowableWeapon</span></span></span><br><span class="line"><span class="params"><span class="function">  </span>)</span> &#123;</span><br><span class="line">    <span class="built_in">this</span>._katana = katana;</span><br><span class="line">    <span class="built_in">this</span>._shuriken = shuriken;</span><br><span class="line">  &#125;</span><br><span class="line">  fight(): <span class="built_in">string</span> &#123;</span><br><span class="line">    <span class="keyword">return</span> <span class="built_in">this</span>._katana.hit();</span><br><span class="line">  &#125;</span><br><span class="line">  sneak(): <span class="built_in">string</span> &#123;</span><br><span class="line">    <span class="keyword">return</span> <span class="built_in">this</span>._shuriken.throw();</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">export</span> &#123; Ninja, Katana, Shuriken &#125;;</span><br><span class="line"></span><br><span class="line"><span class="comment">// interfaces.ts</span></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">interface</span> Warrior &#123;</span><br><span class="line">  fight(): <span class="built_in">string</span>;</span><br><span class="line">  sneak(): <span class="built_in">string</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">interface</span> Weapon &#123;</span><br><span class="line">  hit(): <span class="built_in">string</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">interface</span> ThrowableWeapon &#123;</span><br><span class="line">  <span class="keyword">throw</span>(): <span class="built_in">string</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// inversify.config.ts</span></span><br><span class="line"><span class="keyword">import</span> &#123; Container, interfaces &#125; <span class="keyword">from</span> <span class="string">&quot;inversify&quot;</span>;</span><br><span class="line"><span class="keyword">import</span> &#123; TYPES &#125; <span class="keyword">from</span> <span class="string">&quot;./types&quot;</span>;</span><br><span class="line"><span class="keyword">import</span> &#123; Warrior, Weapon, ThrowableWeapon &#125; <span class="keyword">from</span> <span class="string">&quot;./interfaces&quot;</span>;</span><br><span class="line"><span class="keyword">import</span> &#123; Ninja, Katana, Shuriken &#125; <span class="keyword">from</span> <span class="string">&quot;./entities&quot;</span>;</span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> myContainer = <span class="keyword">new</span> Container();</span><br><span class="line">myContainer.bind&lt;Warrior&gt;(TYPES.Warrior).to(Ninja);</span><br><span class="line"><span class="comment">// 给一个类型添加一个激活句柄是可能的。激活句柄在依赖被找到后、但是还没有被添加到缓存（如果是单例的话）并注入之前被调用。</span></span><br><span class="line"><span class="comment">// 感觉不如直接 写个 AOP装饰器来的方便</span></span><br><span class="line">myContainer</span><br><span class="line">  .bind&lt;Weapon&gt;(TYPES.Weapon)</span><br><span class="line">  .to(Katana)</span><br><span class="line">  .onActivation(<span class="function">(<span class="params">context: interfaces.Context, _katana</span>) =&gt;</span> &#123;</span><br><span class="line">    <span class="keyword">let</span> handle = &#123;</span><br><span class="line">      <span class="function"><span class="title">apply</span>(<span class="params">target: <span class="built_in">any</span>, thisArgument: <span class="built_in">any</span>, argumentsList: <span class="built_in">any</span></span>)</span> &#123;</span><br><span class="line">        <span class="built_in">console</span>.log(<span class="string">`Starting: <span class="subst">$&#123;<span class="keyword">new</span> <span class="built_in">Date</span>().getTime()&#125;</span>`</span>);</span><br><span class="line">        <span class="keyword">let</span> result = target.apply(thisArgument, argumentsList);</span><br><span class="line">        <span class="built_in">console</span>.log(<span class="string">`Finished:<span class="subst">$&#123;<span class="keyword">new</span> <span class="built_in">Date</span>().getTime()&#125;</span>`</span>);</span><br><span class="line">        <span class="keyword">return</span> result;</span><br><span class="line">      &#125;,</span><br><span class="line">    &#125;;</span><br><span class="line">    _katana.hit = <span class="keyword">new</span> <span class="built_in">Proxy</span>(_katana.hit, handle);</span><br><span class="line">    <span class="keyword">return</span> _katana;</span><br><span class="line">  &#125;);</span><br><span class="line">myContainer.bind&lt;ThrowableWeapon&gt;(TYPES.ThrowableWeapon).to(Shuriken);</span><br><span class="line"></span><br><span class="line"><span class="keyword">export</span> &#123; myContainer &#125;;</span><br><span class="line"></span><br><span class="line"><span class="comment">// types.ts</span></span><br><span class="line"><span class="keyword">const</span> TYPES = &#123;</span><br><span class="line">  <span class="attr">Warrior</span>: <span class="built_in">Symbol</span>.for(<span class="string">&quot;Warrior&quot;</span>),</span><br><span class="line">  <span class="attr">Weapon</span>: <span class="built_in">Symbol</span>.for(<span class="string">&quot;Weapon&quot;</span>),</span><br><span class="line">  <span class="attr">ThrowableWeapon</span>: <span class="built_in">Symbol</span>.for(<span class="string">&quot;ThrowableWeapon&quot;</span>),</span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line"><span class="keyword">export</span> &#123; TYPES &#125;;</span><br><span class="line"></span><br><span class="line"><span class="comment">// index.ts</span></span><br><span class="line"><span class="keyword">import</span> <span class="string">&quot;reflect-metadata&quot;</span>;</span><br><span class="line"><span class="keyword">import</span> &#123; Warrior &#125; <span class="keyword">from</span> <span class="string">&quot;./interfaces&quot;</span>;</span><br><span class="line"><span class="keyword">import</span> &#123; myContainer &#125; <span class="keyword">from</span> <span class="string">&quot;./inversify.config&quot;</span>;</span><br><span class="line"><span class="keyword">import</span> &#123; TYPES &#125; <span class="keyword">from</span> <span class="string">&quot;./types&quot;</span>;</span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> ninja = myContainer.get&lt;Warrior&gt;(TYPES.Warrior);</span><br><span class="line"></span><br><span class="line"><span class="built_in">console</span>.log(ninja.fight());</span><br></pre></td></tr></table></figure>

<p>自己写个 TS 装饰器 感觉比用激活句柄更方便。</p>
<h3 id="构造器后置装饰器"><a href="#构造器后置装饰器" class="headerlink" title="构造器后置装饰器"></a><a target="_blank" rel="noopener" href="https://github.com/inversify/InversifyJS/blob/master/wiki/post_construct.md">构造器后置装饰器</a></h3><p>可以添加一个 <strong>@postContruct</strong> 装饰器到一个类或者方法。这个装饰器将在一个对象被示例化之后，以及在所有激活句柄之前运行。 当构造器已经被调用但是组件还没有初始化或者你想在构造器被调用后执行一个初始化逻辑时非常有用。</p>
<figure class="highlight typescript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// entities.ts</span></span><br><span class="line"><span class="keyword">import</span> &#123; injectable, postConstruct &#125; <span class="keyword">from</span> <span class="string">&quot;inversify&quot;</span>;</span><br><span class="line"><span class="keyword">import</span> &#123; IKatana &#125; <span class="keyword">from</span> <span class="string">&quot;./types&quot;</span>;</span><br><span class="line"></span><br><span class="line"><span class="meta">@injectable</span>()</span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Katana</span> <span class="title">implements</span> <span class="title">IKatana</span> </span>&#123;</span><br><span class="line">  <span class="function"><span class="title">constructor</span>(<span class="params"></span>)</span> &#123;</span><br><span class="line">    <span class="built_in">console</span>.log(<span class="string">&quot;Katana is born!&quot;</span>);</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="keyword">public</span> <span class="function"><span class="title">use</span>(<span class="params"></span>)</span> &#123;</span><br><span class="line">    <span class="keyword">return</span> <span class="string">&quot;Used Katana!&quot;</span>;</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="comment">/**</span></span><br><span class="line"><span class="comment">   * <span class="doctag">@postConstruct </span>装饰器到一个类或者方法。</span></span><br><span class="line"><span class="comment">   * 这个装饰器将在一个对象被示例化之后，</span></span><br><span class="line"><span class="comment">   * 以及在所有激活句柄之前运行。</span></span><br><span class="line"><span class="comment">   * 当构造器已经被调用但是组件还没有初始化或者你想在构造器被调用后执行一个初始化逻辑时非常有用。</span></span><br><span class="line"><span class="comment">   */</span></span><br><span class="line">  <span class="meta">@postConstruct</span>()</span><br><span class="line">  <span class="keyword">public</span> <span class="function"><span class="title">testMethod</span>(<span class="params"></span>)</span> &#123;</span><br><span class="line">    <span class="built_in">console</span>.log(<span class="string">&quot;testMethod&quot;</span>);</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">export</span> &#123; Katana &#125;;</span><br><span class="line"></span><br><span class="line"><span class="comment">// inversify.config.ts</span></span><br><span class="line"><span class="keyword">import</span> &#123; Container &#125; <span class="keyword">from</span> <span class="string">&quot;inversify&quot;</span>;</span><br><span class="line"><span class="keyword">import</span> &#123; Katana &#125; <span class="keyword">from</span> <span class="string">&quot;./entities&quot;</span>;</span><br><span class="line"><span class="keyword">import</span> &#123; IKatana &#125; <span class="keyword">from</span> <span class="string">&quot;./types&quot;</span>;</span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> MyContainer = <span class="keyword">new</span> Container();</span><br><span class="line">MyContainer.bind&lt;IKatana&gt;(<span class="string">&quot;Katana&quot;</span>).to(Katana);</span><br><span class="line"></span><br><span class="line"><span class="keyword">export</span> &#123; MyContainer &#125;;</span><br><span class="line"></span><br><span class="line"><span class="comment">// types.ts</span></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">interface</span> IKatana &#123;</span><br><span class="line">  <span class="attr">use</span>: <span class="function">() =&gt;</span> <span class="built_in">void</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// index.ts</span></span><br><span class="line"><span class="keyword">import</span> <span class="string">&quot;reflect-metadata&quot;</span>;</span><br><span class="line"><span class="keyword">import</span> &#123; Warrior &#125; <span class="keyword">from</span> <span class="string">&quot;./interfaces&quot;</span>;</span><br><span class="line"><span class="keyword">import</span> &#123; myContainer &#125; <span class="keyword">from</span> <span class="string">&quot;./inversify.config&quot;</span>;</span><br><span class="line"><span class="keyword">import</span> &#123; TYPES &#125; <span class="keyword">from</span> <span class="string">&quot;./types&quot;</span>;</span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> ninja = myContainer.get&lt;Warrior&gt;(TYPES.Warrior);</span><br><span class="line"></span><br><span class="line"><span class="built_in">console</span>.log(ninja.fight());</span><br></pre></td></tr></table></figure>

<h3 id="名称绑定"><a href="#名称绑定" class="headerlink" title="名称绑定"></a><a target="_blank" rel="noopener" href="https://github.com/inversify/InversifyJS/blob/master/wiki/named_bindings.md">名称绑定</a></h3><p>当有一个抽象被绑定到多个具体实现时，我们可以通过设置<code>@name</code>来区分同一个抽象的不同具体实现。</p>
<figure class="highlight typescript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">interface</span> Weapon &#123;&#125;</span><br><span class="line"></span><br><span class="line"><span class="meta">@injectable</span>()</span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Katana</span> <span class="title">implements</span> <span class="title">Weapon</span> </span>&#123;&#125;</span><br><span class="line"></span><br><span class="line"><span class="meta">@injectable</span>()</span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Shuriken</span> <span class="title">implements</span> <span class="title">Weapon</span> </span>&#123;&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">interface</span> Ninja &#123;</span><br><span class="line">  <span class="attr">katana</span>: Weapon;</span><br><span class="line">  shuriken: Weapon;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="meta">@injectable</span>()</span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Ninja</span> <span class="title">implements</span> <span class="title">Ninja</span> </span>&#123;</span><br><span class="line">  <span class="keyword">public</span> katana: Weapon;</span><br><span class="line">  <span class="keyword">public</span> shuriken: Weapon;</span><br><span class="line">  <span class="keyword">public</span> <span class="function"><span class="title">constructor</span>(<span class="params"></span></span></span><br><span class="line"><span class="params"><span class="function">    <span class="meta">@inject</span>(<span class="string">&quot;Weapon&quot;</span>) <span class="meta">@named</span>(<span class="string">&quot;strong&quot;</span>) katana: Weapon,</span></span></span><br><span class="line"><span class="params"><span class="function">    <span class="meta">@inject</span>(<span class="string">&quot;Weapon&quot;</span>) <span class="meta">@named</span>(<span class="string">&quot;weak&quot;</span>) shuriken: Weapon</span></span></span><br><span class="line"><span class="params"><span class="function">  </span>)</span> &#123;</span><br><span class="line">    <span class="built_in">this</span>.katana = katana;</span><br><span class="line">    <span class="built_in">this</span>.shuriken = shuriken;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">container.bind&lt;Ninja&gt;(<span class="string">&quot;Ninja&quot;</span>).to(Ninja);</span><br><span class="line">container.bind&lt;Weapon&gt;(<span class="string">&quot;Weapon&quot;</span>).to(Katana).whenTargetNamed(<span class="string">&quot;strong&quot;</span>);</span><br><span class="line">container.bind&lt;Weapon&gt;(<span class="string">&quot;Weapon&quot;</span>).to(Shuriken).whenTargetNamed(<span class="string">&quot;weak&quot;</span>);</span><br></pre></td></tr></table></figure>

<p>InversifyJS 还提供了<a target="_blank" rel="noopener" href="https://github.com/inversify/InversifyJS/blob/master/wiki/tagged_bindings.md">标签绑定</a>、<a target="_blank" rel="noopener" href="https://github.com/inversify/InversifyJS/blob/master/wiki/contextual_bindings.md">上下文绑定</a>、<a target="_blank" rel="noopener" href="https://github.com/inversify/InversifyJS/blob/master/wiki/default_targets.md">默认绑定</a>用来处理一个抽象会有多个具体实现的情况。</p>
<p>用于绑定的 InversifyJS 流利语法包括一些已经实现的通用上下文约束：</p>
<figure class="highlight typescript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">interface</span> BindingWhenSyntax&lt;T&gt; &#123;</span><br><span class="line">  when(</span><br><span class="line">    constraint: <span class="function">(<span class="params">request: interfaces.Request</span>) =&gt;</span> <span class="built_in">boolean</span></span><br><span class="line">  ): interfaces.BindingOnSyntax&lt;T&gt;;</span><br><span class="line">  whenTargetNamed(name: <span class="built_in">string</span>): interfaces.BindingOnSyntax&lt;T&gt;;</span><br><span class="line">  whenTargetTagged(tag: <span class="built_in">string</span>, <span class="attr">value</span>: <span class="built_in">any</span>): interfaces.BindingOnSyntax&lt;T&gt;;</span><br><span class="line">  whenInjectedInto(parent: <span class="built_in">Function</span> | <span class="built_in">string</span>): interfaces.BindingOnSyntax&lt;T&gt;;</span><br><span class="line">  whenParentNamed(name: <span class="built_in">string</span>): interfaces.BindingOnSyntax&lt;T&gt;;</span><br><span class="line">  whenParentTagged(tag: <span class="built_in">string</span>, <span class="attr">value</span>: <span class="built_in">any</span>): interfaces.BindingOnSyntax&lt;T&gt;;</span><br><span class="line">  whenAnyAncestorIs(ancestor: <span class="built_in">Function</span> | <span class="built_in">string</span>): interfaces.BindingOnSyntax&lt;T&gt;;</span><br><span class="line">  whenNoAncestorIs(ancestor: <span class="built_in">Function</span> | <span class="built_in">string</span>): interfaces.BindingOnSyntax&lt;T&gt;;</span><br><span class="line">  whenAnyAncestorNamed(name: <span class="built_in">string</span>): interfaces.BindingOnSyntax&lt;T&gt;;</span><br><span class="line">  whenAnyAncestorTagged(tag: <span class="built_in">string</span>, <span class="attr">value</span>: <span class="built_in">any</span>): interfaces.BindingOnSyntax&lt;T&gt;;</span><br><span class="line">  whenNoAncestorNamed(name: <span class="built_in">string</span>): interfaces.BindingOnSyntax&lt;T&gt;;</span><br><span class="line">  whenNoAncestorTagged(tag: <span class="built_in">string</span>, <span class="attr">value</span>: <span class="built_in">any</span>): interfaces.BindingOnSyntax&lt;T&gt;;</span><br><span class="line">  whenAnyAncestorMatches(</span><br><span class="line">    constraint: <span class="function">(<span class="params">request: interfaces.Request</span>) =&gt;</span> <span class="built_in">boolean</span></span><br><span class="line">  ): interfaces.BindingOnSyntax&lt;T&gt;;</span><br><span class="line">  whenNoAncestorMatches(</span><br><span class="line">    constraint: <span class="function">(<span class="params">request: interfaces.Request</span>) =&gt;</span> <span class="built_in">boolean</span></span><br><span class="line">  ): interfaces.BindingOnSyntax&lt;T&gt;;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h3 id="中间件"><a href="#中间件" class="headerlink" title="中间件"></a><a target="_blank" rel="noopener" href="https://github.com/inversify/InversifyJS/blob/master/wiki/middleware.md">中间件</a></h3><p>InversifyJS 在解决依赖前执行 3 个强制操作：</p>
<ul>
<li>标记</li>
<li>计划</li>
<li>解决</li>
</ul>
<p>某些情况下会有额外操作：</p>
<ul>
<li>激活</li>
<li>中间件</li>
</ul>
<p>如果我们配置了中间件，那么它会在计划阶段、解决阶段以及激活阶段之前或者之后的某个时间点执行。</p>
<p>中间件可被用来实现强大的开发工具。这些工具可以帮助开发者在开发过程中定位问题。</p>
<figure class="highlight typescript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// entities.ts</span></span><br><span class="line"><span class="keyword">import</span> &#123; injectable, inject &#125; <span class="keyword">from</span> <span class="string">&quot;inversify&quot;</span>;</span><br><span class="line"><span class="keyword">import</span> <span class="string">&quot;reflect-metadata&quot;</span>;</span><br><span class="line"><span class="keyword">import</span> &#123; Weapon, ThrowableWeapon, Warrior &#125; <span class="keyword">from</span> <span class="string">&quot;./interfaces&quot;</span>;</span><br><span class="line"><span class="keyword">import</span> &#123; TYPES &#125; <span class="keyword">from</span> <span class="string">&quot;./types&quot;</span>;</span><br><span class="line"></span><br><span class="line"><span class="meta">@injectable</span>()</span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Katana</span> <span class="title">implements</span> <span class="title">Weapon</span> </span>&#123;</span><br><span class="line">  <span class="keyword">public</span> <span class="function"><span class="title">hit</span>(<span class="params"></span>)</span> &#123;</span><br><span class="line">    <span class="keyword">return</span> <span class="string">&quot;cut!&quot;</span>;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="meta">@injectable</span>()</span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Shuriken</span> <span class="title">implements</span> <span class="title">ThrowableWeapon</span> </span>&#123;</span><br><span class="line">  <span class="keyword">public</span> <span class="keyword">throw</span>() &#123;</span><br><span class="line">    <span class="keyword">return</span> <span class="string">&quot;hit!&quot;</span>;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="meta">@injectable</span>()</span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Ninja</span> <span class="title">implements</span> <span class="title">Warrior</span> </span>&#123;</span><br><span class="line">  <span class="keyword">private</span> _katana: Weapon;</span><br><span class="line">  <span class="keyword">private</span> _shuriken: ThrowableWeapon;</span><br><span class="line"></span><br><span class="line">  <span class="keyword">public</span> <span class="function"><span class="title">constructor</span>(<span class="params"></span></span></span><br><span class="line"><span class="params"><span class="function">    <span class="meta">@inject</span>(TYPES.Weapon) katana: Weapon,</span></span></span><br><span class="line"><span class="params"><span class="function">    <span class="meta">@inject</span>(TYPES.ThrowableWeapon) shuriken: ThrowableWeapon</span></span></span><br><span class="line"><span class="params"><span class="function">  </span>)</span> &#123;</span><br><span class="line">    <span class="built_in">this</span>._katana = katana;</span><br><span class="line">    <span class="built_in">this</span>._shuriken = shuriken;</span><br><span class="line">  &#125;</span><br><span class="line">  fight(): <span class="built_in">string</span> &#123;</span><br><span class="line">    <span class="keyword">return</span> <span class="built_in">this</span>._katana.hit();</span><br><span class="line">  &#125;</span><br><span class="line">  sneak(): <span class="built_in">string</span> &#123;</span><br><span class="line">    <span class="keyword">return</span> <span class="built_in">this</span>._shuriken.throw();</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">export</span> &#123; Ninja, Katana, Shuriken &#125;;</span><br><span class="line"></span><br><span class="line"><span class="comment">// interface.ts</span></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">interface</span> Warrior &#123;</span><br><span class="line">  fight(): <span class="built_in">string</span>;</span><br><span class="line">  sneak(): <span class="built_in">string</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">interface</span> Weapon &#123;</span><br><span class="line">  hit(): <span class="built_in">string</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">interface</span> ThrowableWeapon &#123;</span><br><span class="line">  <span class="keyword">throw</span>(): <span class="built_in">string</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// inversify.config.ts</span></span><br><span class="line"><span class="keyword">import</span> &#123; Container, interfaces &#125; <span class="keyword">from</span> <span class="string">&quot;inversify&quot;</span>;</span><br><span class="line"><span class="keyword">import</span> &#123; TYPES &#125; <span class="keyword">from</span> <span class="string">&quot;./types&quot;</span>;</span><br><span class="line"><span class="keyword">import</span> &#123; Warrior, Weapon, ThrowableWeapon &#125; <span class="keyword">from</span> <span class="string">&quot;./interfaces&quot;</span>;</span><br><span class="line"><span class="keyword">import</span> &#123; Ninja, Katana, Shuriken &#125; <span class="keyword">from</span> <span class="string">&quot;./entities&quot;</span>;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">logger</span>(<span class="params">planAndResolve: interfaces.Next</span>): <span class="title">interfaces</span>.<span class="title">Next</span> </span>&#123;</span><br><span class="line">  <span class="keyword">return</span> <span class="function">(<span class="params">args: interfaces.NextArgs</span>) =&gt;</span> &#123;</span><br><span class="line">    <span class="keyword">let</span> start = <span class="keyword">new</span> <span class="built_in">Date</span>().getTime();</span><br><span class="line">    <span class="keyword">let</span> result = planAndResolve(args);</span><br><span class="line">    <span class="keyword">let</span> end = <span class="keyword">new</span> <span class="built_in">Date</span>().getTime();</span><br><span class="line">    <span class="built_in">console</span>.log(<span class="string">`Woooo <span class="subst">$&#123;end - start&#125;</span>`</span>);</span><br><span class="line">    <span class="keyword">return</span> result;</span><br><span class="line">  &#125;;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> myContainer = <span class="keyword">new</span> Container();</span><br><span class="line">myContainer.bind&lt;Warrior&gt;(TYPES.Warrior).to(Ninja);</span><br><span class="line">myContainer.bind&lt;Weapon&gt;(TYPES.Weapon).to(Katana);</span><br><span class="line">myContainer.bind&lt;ThrowableWeapon&gt;(TYPES.ThrowableWeapon).to(Shuriken);</span><br><span class="line">myContainer.applyMiddleware(logger);</span><br><span class="line"></span><br><span class="line"><span class="keyword">export</span> &#123; myContainer &#125;;</span><br><span class="line"></span><br><span class="line"><span class="comment">// types.ts</span></span><br><span class="line"><span class="keyword">const</span> TYPES = &#123;</span><br><span class="line">  <span class="attr">Warrior</span>: <span class="built_in">Symbol</span>.for(<span class="string">&quot;Warrior&quot;</span>),</span><br><span class="line">  <span class="attr">Weapon</span>: <span class="built_in">Symbol</span>.for(<span class="string">&quot;Weapon&quot;</span>),</span><br><span class="line">  <span class="attr">ThrowableWeapon</span>: <span class="built_in">Symbol</span>.for(<span class="string">&quot;ThrowableWeapon&quot;</span>),</span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line"><span class="keyword">export</span> &#123; TYPES &#125;;</span><br><span class="line"></span><br><span class="line"><span class="comment">// index.ts</span></span><br><span class="line"><span class="keyword">import</span> <span class="string">&quot;reflect-metadata&quot;</span>;</span><br><span class="line"><span class="keyword">import</span> &#123; Warrior &#125; <span class="keyword">from</span> <span class="string">&quot;./interfaces&quot;</span>;</span><br><span class="line"><span class="keyword">import</span> &#123; myContainer &#125; <span class="keyword">from</span> <span class="string">&quot;./inversify.config&quot;</span>;</span><br><span class="line"><span class="keyword">import</span> &#123; TYPES &#125; <span class="keyword">from</span> <span class="string">&quot;./types&quot;</span>;</span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> ninja = myContainer.get&lt;Warrior&gt;(TYPES.Warrior);</span><br><span class="line"></span><br><span class="line"><span class="built_in">console</span>.log(ninja.fight());</span><br></pre></td></tr></table></figure>

<h3 id="层次化的依赖倒置系统"><a href="#层次化的依赖倒置系统" class="headerlink" title="层次化的依赖倒置系统"></a><a target="_blank" rel="noopener" href="https://github.com/inversify/InversifyJS/blob/master/wiki/hierarchical_di.md">层次化的依赖倒置系统</a></h3><p>在层次化依赖倒置系统中，容器可以有父容器，并且一个应用中可以有多个容器。这些容器形成了层次化的结构。</p>
<p>当一个处于层次结构中最底层的容器请求一个依赖项时，容器尝试在其自身内部的绑定中查找。如果缺少相关绑定，<strong>它向上传递请求到父容器</strong>。若父容器查找不到相关绑定则再次向上传递请求。请求被向上冒泡传递直到有个容器能够处理这个请求为止或者贯穿整个祖先容器链。</p>
<figure class="highlight typescript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">let</span> weaponIdentifier = <span class="string">&quot;Weapon&quot;</span>;</span><br><span class="line"></span><br><span class="line"><span class="meta">@injectable</span>()</span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Katana</span> </span>&#123;&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">let</span> parentContainer = <span class="keyword">new</span> Container();</span><br><span class="line">parentContainer.bind(weaponIdentifier).to(Katana);</span><br><span class="line"></span><br><span class="line"><span class="keyword">let</span> childContainer = <span class="keyword">new</span> Container();</span><br><span class="line">childContainer.parent = parentContainer;</span><br><span class="line"></span><br><span class="line">expect(childContainer.get(weaponIdentifier)).to.be.instanceOf(Katana); <span class="comment">// true</span></span><br></pre></td></tr></table></figure>

<h2 id="问题"><a href="#问题" class="headerlink" title="问题"></a>问题</h2><h3 id="循环依赖"><a href="#循环依赖" class="headerlink" title="循环依赖"></a><a target="_blank" rel="noopener" href="https://github.com/inversify/InversifyJS/blob/master/wiki/circular_dependencies.md">循环依赖</a></h3><p>在类的互相依赖中，是很可能出现循环依赖的情况的。</p>
<p><code>错误: 找到了循环依赖：Ninja -&gt; A -&gt; B -&gt; C -&gt; D -&gt; A</code></p>
<p>InversifyJS 是可以检测到这样的情况的，如果不做处理会提示错误：</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">@inject 和 undefined 一起被调用了，这可能意味着类 <span class="variable">$&#123;name&#125;</span> 存在一个循环依赖问题。你可以用 LazyServiceIdentifer 来克服这个限制。</span><br></pre></td></tr></table></figure>

<p>你有两种方式解决这个问题：</p>
<ul>
<li>使用 <code>LazyServiceIdentifer</code>。 懒加载识别器并不延迟依赖注入，所有依赖项都在类实例创建时注入。但是，它延迟了对属性识别器的访问（解决了模块问题）。一个相关的例子可从官方提供的<a target="_blank" rel="noopener" href="https://github.com/krzkaczor/InversifyJS/blob/a53bf2cbee65803b197998c1df496c3be84731d9/test/inversify.test.ts#L236-L300">单元测试</a>中找到。</li>
<li>使用 <code>@lazyInject</code> 装饰器。该装饰器是 <a target="_blank" rel="noopener" href="https://github.com/inversify/inversify-inject-decorators"><code>inversify-inject-decorators</code></a> 模块的一部分。 <code>@lazyInject</code> 装饰器将对依赖项的注入延迟到了真正要使用它们的那一刻，这发生在类实例被创建之后。</li>
</ul>
<h3 id="继承"><a href="#继承" class="headerlink" title="继承"></a><a target="_blank" rel="noopener" href="https://github.com/inversify/InversifyJS/blob/master/wiki/inheritance.md">继承</a></h3><p>InvsersifyJS 中对继承的使用有两条限制条件：</p>
<ul>
<li>一个子类必须显式地声明其构造器。</li>
<li>子类的构造器参数数量必须大于或等于其基类的构造器参数数量。</li>
</ul>
<p>如果你不准守这两个规则条件则会 <em>收获</em> 异常警告：</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">Error: The number of constructor arguments <span class="keyword">in</span> the derived class SamuraiMaster must be &gt;= than the number of constructor arguments of its base class.</span><br></pre></td></tr></table></figure>

<p>有四种方法来解决可能出现的继承报错问题</p>
<h4 id="使用-unmanaged-装饰器"><a href="#使用-unmanaged-装饰器" class="headerlink" title="使用 @unmanaged 装饰器"></a>使用 @unmanaged 装饰器</h4><p><code>@unmanaged()</code> 装饰器运行用户标记一个参数将会被手动注入到基类。我们使用 “unmanaged” 一词因为 InversifyJS 对用户提供的值没有控制权，就不能管理它们的注入行为。</p>
<figure class="highlight typescript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> BaseId = <span class="string">&quot;Base&quot;</span>;</span><br><span class="line"></span><br><span class="line"><span class="meta">@injectable</span>()</span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Base</span> </span>&#123;</span><br><span class="line">  <span class="keyword">public</span> prop: <span class="built_in">string</span>;</span><br><span class="line">  <span class="keyword">public</span> <span class="function"><span class="title">constructor</span>(<span class="params"><span class="meta">@unmanaged</span>() arg: <span class="built_in">string</span></span>)</span> &#123;</span><br><span class="line">    <span class="built_in">this</span>.prop = arg;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="meta">@injectable</span>()</span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Derived</span> <span class="keyword">extends</span> <span class="title">Base</span> </span>&#123;</span><br><span class="line">  <span class="keyword">public</span> <span class="function"><span class="title">constructor</span>(<span class="params"></span>)</span> &#123;</span><br><span class="line">    <span class="built_in">super</span>(<span class="string">&quot;unmanaged-injected-value&quot;</span>);</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">container.bind&lt;Base&gt;(BaseId).to(Derived);</span><br><span class="line"><span class="keyword">let</span> derived = container.get&lt;Base&gt;(BaseId);</span><br><span class="line"></span><br><span class="line">derived <span class="keyword">instanceof</span> Derived2; <span class="comment">// true</span></span><br><span class="line">derived.prop; <span class="comment">// &quot;unmanaged-injected-value&quot;</span></span><br></pre></td></tr></table></figure>

<h4 id="属性设置器"><a href="#属性设置器" class="headerlink" title="属性设置器"></a>属性设置器</h4><p>你可以使用 <code>public</code>、 <code>protected</code> 或者 <code>private</code> 访问权限标记和一个属性设置器来避免注入到基类中：</p>
<figure class="highlight typescript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@injectable</span>()</span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Warrior</span> </span>&#123;</span><br><span class="line">  <span class="keyword">protected</span> rank: <span class="built_in">string</span>;</span><br><span class="line">  <span class="keyword">public</span> <span class="function"><span class="title">constructor</span>(<span class="params"></span>)</span> &#123;</span><br><span class="line">    <span class="comment">// args count = 0</span></span><br><span class="line">    <span class="built_in">this</span>.rank = <span class="literal">null</span>;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="meta">@injectable</span>()</span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">SamuraiMaster</span> <span class="keyword">extends</span> <span class="title">Warrior</span> </span>&#123;</span><br><span class="line">  <span class="keyword">public</span> <span class="function"><span class="title">constructor</span>(<span class="params"></span>)</span> &#123;</span><br><span class="line">    <span class="comment">// args count = 0</span></span><br><span class="line">    <span class="built_in">super</span>();</span><br><span class="line">    <span class="built_in">this</span>.rank = <span class="string">&quot;master&quot;</span>;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h4 id="属性注入"><a href="#属性注入" class="headerlink" title="属性注入"></a>属性注入</h4><p>我们也可以使用属性注入来避免注入到基类：</p>
<figure class="highlight typescript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@injectable</span>()</span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Warrior</span> </span>&#123;</span><br><span class="line">  <span class="keyword">protected</span> rank: <span class="built_in">string</span>;</span><br><span class="line">  <span class="keyword">public</span> <span class="function"><span class="title">constructor</span>(<span class="params"></span>)</span> &#123;&#125; <span class="comment">// args count = 0</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">let</span> TYPES = &#123; <span class="attr">Rank</span>: <span class="string">&quot;Rank&quot;</span> &#125;;</span><br><span class="line"></span><br><span class="line"><span class="meta">@injectable</span>()</span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">SamuraiMaster</span> <span class="keyword">extends</span> <span class="title">Warrior</span> </span>&#123;</span><br><span class="line">  <span class="meta">@injectNamed</span>(TYPES.Rank, <span class="string">&quot;master&quot;</span>)</span><br><span class="line">  <span class="meta">@named</span>(<span class="string">&quot;master&quot;</span>)</span><br><span class="line">  <span class="keyword">protected</span> rank: <span class="built_in">string</span>;</span><br><span class="line"></span><br><span class="line">  <span class="keyword">public</span> <span class="function"><span class="title">constructor</span>(<span class="params"></span>)</span> &#123;</span><br><span class="line">    <span class="comment">// args count = 0</span></span><br><span class="line">    <span class="built_in">super</span>();</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">container</span><br><span class="line">  .bind&lt;<span class="built_in">string</span>&gt;(TYPES.Rank)</span><br><span class="line">  .toConstantValue(<span class="string">&quot;master&quot;</span>)</span><br><span class="line">  .whenTargetNamed(<span class="string">&quot;master&quot;</span>);</span><br></pre></td></tr></table></figure>

<h4 id="注入到子类"><a href="#注入到子类" class="headerlink" title="注入到子类"></a>注入到子类</h4><p>如果我们不想避免注入到基类我们可以注入到子类然后使用基类的构造器（super）注入到基类。</p>
<figure class="highlight typescript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@injectable</span>()</span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Warrior</span> </span>&#123;</span><br><span class="line">  <span class="keyword">protected</span> rank: <span class="built_in">string</span>;</span><br><span class="line">  <span class="keyword">public</span> <span class="function"><span class="title">constructor</span>(<span class="params">rank: <span class="built_in">string</span></span>)</span> &#123;</span><br><span class="line">    <span class="comment">// args count = 1</span></span><br><span class="line">    <span class="built_in">this</span>.rank = rank;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">let</span> TYPES = &#123; <span class="attr">Rank</span>: <span class="string">&quot;Rank&quot;</span> &#125;;</span><br><span class="line"></span><br><span class="line"><span class="meta">@injectable</span>()</span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">SamuraiMaster</span> <span class="keyword">extends</span> <span class="title">Warrior</span> </span>&#123;</span><br><span class="line">  <span class="keyword">public</span> <span class="function"><span class="title">constructor</span>(<span class="params"></span></span></span><br><span class="line"><span class="params"><span class="function">    <span class="meta">@inject</span>(TYPES.Rank) <span class="meta">@named</span>(<span class="string">&quot;master&quot;</span>) rank: <span class="built_in">string</span> <span class="comment">// args count = 1</span></span></span></span><br><span class="line"><span class="params"><span class="function">  </span>)</span> &#123;</span><br><span class="line">    <span class="built_in">super</span>(rank);</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">container</span><br><span class="line">  .bind&lt;<span class="built_in">string</span>&gt;(TYPES.Rank)</span><br><span class="line">  .toConstantValue(<span class="string">&quot;master&quot;</span>)</span><br><span class="line">  .whenTargetNamed(<span class="string">&quot;master&quot;</span>);</span><br></pre></td></tr></table></figure>

<p>下面的代码也可行：</p>
<figure class="highlight typescript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@injectable</span>()</span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Warrior</span> </span>&#123;</span><br><span class="line">  <span class="keyword">protected</span> rank: <span class="built_in">string</span>;</span><br><span class="line">  <span class="keyword">public</span> <span class="function"><span class="title">constructor</span>(<span class="params">rank: <span class="built_in">string</span></span>)</span> &#123;</span><br><span class="line">    <span class="comment">// args count = 1</span></span><br><span class="line">    <span class="built_in">this</span>.rank = rank;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">interface</span> Weapon &#123;</span><br><span class="line">  <span class="attr">name</span>: <span class="built_in">string</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="meta">@injectable</span>()</span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Katana</span> <span class="title">implements</span> <span class="title">Weapon</span> </span>&#123;</span><br><span class="line">  <span class="keyword">public</span> name: <span class="built_in">string</span>;</span><br><span class="line">  <span class="keyword">public</span> <span class="function"><span class="title">constructor</span>(<span class="params"></span>)</span> &#123;</span><br><span class="line">    <span class="built_in">this</span>.name = <span class="string">&quot;Katana&quot;</span>;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">let</span> TYPES = &#123;</span><br><span class="line">  <span class="attr">Rank</span>: <span class="string">&quot;Rank&quot;</span>,</span><br><span class="line">  <span class="attr">Weapon</span>: <span class="string">&quot;Weapon&quot;</span>,</span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line"><span class="meta">@injectable</span>()</span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">SamuraiMaster</span> <span class="keyword">extends</span> <span class="title">Warrior</span> </span>&#123;</span><br><span class="line">  <span class="keyword">public</span> weapon: Weapon;</span><br><span class="line">  <span class="keyword">public</span> <span class="function"><span class="title">constructor</span>(<span class="params"></span></span></span><br><span class="line"><span class="params"><span class="function">    <span class="meta">@inject</span>(TYPES.Rank) <span class="meta">@named</span>(<span class="string">&quot;master&quot;</span>) rank: <span class="built_in">string</span>, <span class="comment">// args count = 2</span></span></span></span><br><span class="line"><span class="params"><span class="function">    <span class="meta">@inject</span>(TYPES.Weapon) weapon: Weapon</span></span></span><br><span class="line"><span class="params"><span class="function">  </span>)</span> &#123;</span><br><span class="line">    <span class="built_in">super</span>(rank);</span><br><span class="line">    <span class="built_in">this</span>.weapon = weapon;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">container.bind&lt;Weapon&gt;(TYPES.Weapon).to(Katana);</span><br><span class="line"></span><br><span class="line">container</span><br><span class="line">  .bind&lt;<span class="built_in">string</span>&gt;(TYPES.Rank)</span><br><span class="line">  .toConstantValue(<span class="string">&quot;master&quot;</span>)</span><br><span class="line">  .whenTargetNamed(<span class="string">&quot;master&quot;</span>);</span><br></pre></td></tr></table></figure>

<h3 id="第三方基类使用"><a href="#第三方基类使用" class="headerlink" title="第三方基类使用"></a>第三方基类使用</h3><p>某些情况下，你也许会碰到错误说一个第三方模块提供的类缺少标记，比如：</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">Error: Missing required @injectable annotation <span class="keyword">in</span>: SamuraiMaster</span><br></pre></td></tr></table></figure>

<p>你可以通过使用 <code>decorate</code> 函数来克服这个问题：</p>
<figure class="highlight typescript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> &#123; decorate, injectable &#125; <span class="keyword">from</span> <span class="string">&quot;inversify&quot;</span>;</span><br><span class="line"><span class="keyword">import</span> SomeClass <span class="keyword">from</span> <span class="string">&quot;some-module&quot;</span>;</span><br><span class="line"></span><br><span class="line">decorate(injectable(), SomeClass);</span><br><span class="line"><span class="keyword">return</span> SomeClass;</span><br></pre></td></tr></table></figure>

<h2 id="最佳实践"><a href="#最佳实践" class="headerlink" title="最佳实践"></a>最佳实践</h2><p>InversifyJS 是一个 IoC 容器，一个 IoC 容器是一个工具，用来帮助你写出随时间推移容易修改和扩展的面向对象的代码。</p>
<h3 id="组合重用原则"><a href="#组合重用原则" class="headerlink" title="组合重用原则"></a>组合重用原则</h3><blockquote>
<p>‘对象组合’优于‘类继承’。</p>
</blockquote>
<p>继承是一件坏事情，因为它带来了模块间的最强耦合性。</p>
<h3 id="依赖倒置原则"><a href="#依赖倒置原则" class="headerlink" title="依赖倒置原则"></a>依赖倒置原则</h3><blockquote>
<p>要依赖抽象，而不要依赖具体实现。</p>
</blockquote>
<p>依赖注入无非是通过构造器或者设置器将依赖传递给类</p>
<figure class="highlight typescript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@injectable</span>()</span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Ninja</span> </span>&#123;</span><br><span class="line">  <span class="keyword">private</span> _katana: Katana;</span><br><span class="line"></span><br><span class="line">  <span class="keyword">public</span> <span class="function"><span class="title">constructor</span>(<span class="params">katana: Katana</span>)</span> &#123;</span><br><span class="line">    <span class="built_in">this</span>._katana = katana;</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="keyword">public</span> <span class="function"><span class="title">fight</span>(<span class="params"></span>)</span> &#123;</span><br><span class="line">    <span class="keyword">return</span> <span class="built_in">this</span>._katana.hit();</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>这个例子中 Ninja 类依赖 Katana 类: <code>Ninja --&gt; Katana</code></p>
<p>注意箭头方向表示了依赖是从左到右的。</p>
<p>如果我们更新 Ninja 类来依赖 Katana 类的抽象（即 Katana 接口）：</p>
<figure class="highlight typescript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@injectable</span>()</span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Ninja</span> </span>&#123;</span><br><span class="line">  <span class="keyword">private</span> _katana: Katana;</span><br><span class="line"></span><br><span class="line">  <span class="keyword">public</span> <span class="function"><span class="title">constructor</span>(<span class="params"><span class="meta">@inject</span>(<span class="string">&quot;Katana&quot;</span>) katana: Katana</span>)</span> &#123;</span><br><span class="line">    <span class="built_in">this</span>._katana = katana;</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="keyword">public</span> <span class="function"><span class="title">fight</span>(<span class="params"></span>)</span> &#123;</span><br><span class="line">    <span class="keyword">return</span> <span class="built_in">this</span>._katana.hit();</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>在这种情况下，Ninja 类和 Katana 类都依赖于 Katana 接口：</p>
<p><code>Ninja --&gt; Katana </code></p>
<p><code>Ninja --&gt; Katana </code></p>
<p>也可以表示为：</p>
<p><code>Ninja --&gt; Katana &lt;-- Katana</code></p>
<h3 id="避免注入数据，而不是行为"><a href="#避免注入数据，而不是行为" class="headerlink" title="避免注入数据，而不是行为"></a>避免注入数据，而不是行为</h3><p>注入数据，而不是行为，是政治家反模式的一个子类型，只是在这里容器是那个没用的类。如果一个类需要知道当前日期和时间，那么没有必要注入一个日期和时间，即数据；相反的，你应该注入一个系统时钟的上层抽象。这不仅仅在 DI 时是正确的做法；这对可测性至关重要，因为你可以不必等待就能够测试不同的时间下的行为。</p>
<h3 id="避免将所有的生命周期声明为单例"><a href="#避免将所有的生命周期声明为单例" class="headerlink" title="避免将所有的生命周期声明为单例"></a>避免将所有的生命周期声明为单例</h3><p>将所有的生命周期声明为单例，对我来说，这就是货物崇拜编程的完美例子，简直是俗称的“对象污水池”。我看过多到我记不住的单例滥用案例，其中很少和 DI 相关。</p>
<h3 id="避免构造器的过度注入"><a href="#避免构造器的过度注入" class="headerlink" title="避免构造器的过度注入"></a>避免构造器的过度注入</h3><p>构造器的过度注入违反了单一职责原则。太多的构造器参数表明了太多的依赖；太多的依赖表明了这个类尝试做得太多了。通常这个错误伴随着其他的代码坏味道，比如通常有着很长而且模糊的类名称（xxxManager 之类）。</p>
<h2 id="Refer-To"><a href="#Refer-To" class="headerlink" title="Refer To"></a>Refer To</h2><p><a target="_blank" rel="noopener" href="https://github.com/inversify/InversifyJS/tree/master/wiki">https://github.com/inversify/InversifyJS/tree/master/wiki</a></p>
<p><a target="_blank" rel="noopener" href="https://doc.inversify.cloud/zh_cn/">https://doc.inversify.cloud/zh_cn/</a></p>
<p><a target="_blank" rel="noopener" href="https://zhuanlan.zhihu.com/p/137542149">https://zhuanlan.zhihu.com/p/137542149</a></p>

      
    </div>

    
      
      

  <div class="post-copyright">
    <p class="copyright-item">
      <span>作者: </span>
      <span>Fynn</span>
    </p>
    <p class="copyright-item">
      <span>来源: </span>
      <a href="https://fynn90.github.io">https://fynn90.github.io</a>
    </p>
    <p class="copyright-item">
      <span>链接: </span>
      <a href="https://fynn90.github.io/2021/02/18/InversifyJS/">https://fynn90.github.io/2021/02/18/InversifyJS/</a>
    </p>

    <p class="copyright-item lincese">
      
      本文采用<a rel="license" href="http://creativecommons.org/licenses/by-nc/4.0/" target="_blank">知识共享署名-非商业性使用 4.0 国际许可协议</a>进行许可
    </p>
  </div>



      
      
  <div class="post-reward">
    <input type="checkbox" name="reward" id="reward" hidden />
    <label class="reward-button" for="reward">赞赏支持</label>
    <div class="qr-code">
      
      
        <label class="qr-code-image" for="reward">
          <img class="image" src="/image/reward/wechat.png" title="wechat">
          <div>wechat</div>
        </label>
      
      
        <label class="qr-code-image" for="reward">
          <img class="image" src="/image/reward/alipay.png" title="alipay">
          <div>alipay</div>
        </label>
      
    </div>
  </div>

    

    
      <footer class="post-footer">
        
          <div class="post-tags">
            
              <a href="/tags/InversifyJS/">InversifyJS</a>
            
              <a href="/tags/IoC/">IoC</a>
            
          </div>
        
        
        
  <nav class="post-nav">
    
      <a class="prev" href="/2021/03/03/RxJS/">
        <i class="iconfont icon-left"></i>
        <span class="prev-text nav-default">RxJS</span>
        <span class="prev-text nav-mobile">上一篇</span>
      </a>
    
    
      <a class="next" href="/2021/02/04/%E6%B5%8F%E8%A7%88%E5%99%A8%E4%B8%AD%E8%B7%A8%E9%A1%B5%E9%9D%A2%E7%9A%84%E9%80%9A%E8%AE%AF/">
        <span class="next-text nav-default">浏览器跨页面通讯</span>
        <span class="prev-text nav-mobile">下一篇</span>
        <i class="iconfont icon-right"></i>
      </a>
    
  </nav>

      </footer>
    

  </article>


          </div>
          
  <div class="comments" id="comments">
    
  </div>


        </div>  
      </main>

      <footer id="footer" class="footer">

  <div class="social-links">
    
      
        
          <a href="mailto:fynn.90@outlook.com" class="iconfont icon-email" title="email"></a>
        
      
    
      
    
      
    
      
    
      
        
          <a target="_blank" rel="noopener" href="https://www.linkedin.com/in/%E5%B8%86-%E9%82%93-17163589/" class="iconfont icon-linkedin" title="linkedin"></a>
        
      
    
      
        
          <a target="_blank" rel="noopener" href="https://plus.google.com/u/0/117459332873536225443" class="iconfont icon-google" title="google"></a>
        
      
    
      
        
          <a target="_blank" rel="noopener" href="https://github.com/fatefan" class="iconfont icon-github" title="github"></a>
        
      
    
      
        
          <a target="_blank" rel="noopener" href="http://www.weibo.com/306019091" class="iconfont icon-weibo" title="weibo"></a>
        
      
    
      
        
          <a target="_blank" rel="noopener" href="https://www.zhihu.com/people/FynnDeng/activities" class="iconfont icon-zhihu" title="zhihu"></a>
        
      
    
      
    
    
    
  </div>


<div class="copyright">
  
  <span class="copyright-year">
    
    &copy; 
     
      2017 - 
    
    2021

    <span class="heart">
      <i class="iconfont icon-heart"></i>
    </span>
    <span class="author">Fynn</span>
  </span>
  
</div>
      </footer>

      <div class="back-to-top" id="back-to-top">
        <i class="iconfont icon-up"></i>
      </div>
    </div>

    
  

  
  




    
  





  
    <script type="text/javascript" src="/lib/jquery/jquery-3.1.1.min.js"></script>
  

  
    <script type="text/javascript" src="/lib/slideout/slideout.js"></script>
  

  
    <script type="text/javascript" src="/lib/fancybox/jquery.fancybox.pack.js"></script>
  


    <script type="text/javascript" src="/js/src/even.js?v=1.1.2"></script>
<script type="text/javascript" src="/js/src/bootstrap.js?v=1.1.2"></script>

    
  </body>
</html>
