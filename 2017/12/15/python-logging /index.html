<!DOCTYPE html>
<html lang="zh-cn">
  <head>
    
<meta charset="UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=edge" />
<meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1"/>


<meta http-equiv="Cache-Control" content="no-transform" />
<meta http-equiv="Cache-Control" content="no-siteapp" />



  <meta name="description" content="Python-Logging"/>




  <meta name="keywords" content="Python-Logging," />




  <link rel="alternate" href="/atom.xml" title="Fynn's Blog" type="application/atom+xml">




  <link rel="shortcut icon" type="image/x-icon" href="/favicon.ico?v=1.1.2" />



<link rel="canonical" href="https://fynn90.github.io/2017/12/15/python-logging /"/>


<meta name="description" content="Python提供了功能强大且灵活的日志系统模块logging。根据业务需求可以根据自定义的日志事件等级做对应的处理。">
<meta property="og:type" content="article">
<meta property="og:title" content="Python-Logging">
<meta property="og:url" content="https://fynn90.github.io/2017/12/15/python-logging%20/index.html">
<meta property="og:site_name" content="Fynn&#39;s Blog">
<meta property="og:description" content="Python提供了功能强大且灵活的日志系统模块logging。根据业务需求可以根据自定义的日志事件等级做对应的处理。">
<meta property="og:locale" content="zh_CN">
<meta property="og:image" content="https://docs.python.org/3/_images/logging_flow.png">
<meta property="article:published_time" content="2017-12-15T14:12:00.000Z">
<meta property="article:modified_time" content="2019-10-31T01:48:46.330Z">
<meta property="article:author" content="Fynn">
<meta property="article:tag" content="Python-Logging">
<meta name="twitter:card" content="summary">
<meta name="twitter:image" content="https://docs.python.org/3/_images/logging_flow.png">


<link rel="stylesheet" type="text/css" href="/css/style.css?v=1.1.2" />



  <link rel="stylesheet" type="text/css" href="/lib/fancybox/jquery.fancybox.css" />





<script>
  var CONFIG = {
    search: false,
    searchPath: "/search.xml",
    fancybox: true,
    toc: true,
  }
</script>




  
  <script type="text/javascript">
    var _hmt = _hmt || [];
    (function() {
      var hm = document.createElement("script");
      hm.src = "https://hm.baidu.com/hm.js?607980a031d3edcefed502ce80e77ffb";
      var s = document.getElementsByTagName("script")[0];
      s.parentNode.insertBefore(hm, s);
    })();
  </script>


  <script type="text/javascript">
    (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
        (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
        m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
        })(window,document,'script','//www.google-analytics.com/analytics.js','ga');

        ga('create', 'UA-115728733-1', 'auto');
        ga('send', 'pageview');
  </script>



    <title> Python-Logging · Fynn's Blog </title>
  <meta name="generator" content="Hexo 5.4.0"></head>

  <body><div id="mobile-navbar" class="mobile-navbar">
  <div class="mobile-header-logo">
    <a href="/." class="logo">Fynn's Blog</a>
  </div>
  <div class="mobile-navbar-icon">
    <span></span>
    <span></span>
    <span></span>
  </div>
</div>

<nav id="mobile-menu" class="mobile-menu slideout-menu">
  <ul class="mobile-menu-list">
    
      <a href="/">
        <li class="mobile-menu-item">
          
          
            Home
          
        </li>
      </a>
    
      <a href="/archives/">
        <li class="mobile-menu-item">
          
          
            Archives
          
        </li>
      </a>
    
      <a href="/tags">
        <li class="mobile-menu-item">
          
          
            Tags
          
        </li>
      </a>
    
  </ul>
</nav>

    <div class="container" id="mobile-panel">
      <header id="header" class="header"><div class="logo-wrapper">
  <a href="/." class="logo">Fynn's Blog</a>
</div>

<nav class="site-navbar">
  
    <ul id="menu" class="menu">
      
        <li class="menu-item">
          <a class="menu-item-link" href="/">
            
            
              首页
            
          </a>
        </li>
      
        <li class="menu-item">
          <a class="menu-item-link" href="/archives/">
            
            
              归档
            
          </a>
        </li>
      
        <li class="menu-item">
          <a class="menu-item-link" href="/tags">
            
            
              标签
            
          </a>
        </li>
      
      
    </ul>
  
</nav>

      </header>

      <main id="main" class="main">
        <div class="content-wrapper">
          <div id="content" class="content">
            
  
  <article class="post">
    <header class="post-header">
      <h1 class="post-title">
        
          Python-Logging
        
      </h1>

      <div class="post-meta">
        <span class="post-time">
          2017年12月15日
        </span>
      </div>
    </header>

    
    
  <div class="post-toc" id="post-toc">
    <h2 class="post-toc-title">文章目录</h2>
    <div class="post-toc-content">
      <ol class="toc"><li class="toc-item toc-level-2"><a class="toc-link" href="#%E5%9F%BA%E7%A1%80%E6%A8%A1%E5%BC%8F"><span class="toc-text">基础模式</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#logging-basicConfig"><span class="toc-text">logging.basicConfig</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E8%AE%B0%E5%BD%95%E5%8F%98%E9%87%8F%E6%95%B0%E6%8D%AE"><span class="toc-text">记录变量数据</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E9%AB%98%E7%BA%A7%E6%A8%A1%E5%BC%8F"><span class="toc-text">高级模式</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#Logging%E5%B7%A5%E4%BD%9C%E6%B5%81"><span class="toc-text">Logging工作流</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#Loggers"><span class="toc-text">Loggers</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#configuration"><span class="toc-text">configuration</span></a></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#Handlers"><span class="toc-text">Handlers</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#Formatters"><span class="toc-text">Formatters</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#Configuring-Logging"><span class="toc-text">Configuring Logging</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E9%87%8D%E5%A4%8D%E6%89%93%E5%8D%B0"><span class="toc-text">重复打印</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#basicConfig"><span class="toc-text">basicConfig()</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#handler"><span class="toc-text">handler</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#root"><span class="toc-text">root</span></a></li></ol></li></ol>
    </div>
  </div>


    <div class="post-content">
      
        <p><code>Python</code>提供了功能强大且灵活的日志系统模块<a target="_blank" rel="noopener" href="https://docs.python.org/3/library/logging.html"><code>logging</code></a>。根据业务需求可以根据自定义的日志事件等级做对应的处理。</p>
<span id="more"></span> 
<h2 id="基础模式"><a href="#基础模式" class="headerlink" title="基础模式"></a><a target="_blank" rel="noopener" href="https://docs.python.org/3/howto/logging.html#logging-basic-tutorial">基础模式</a></h2><p>只是向控制台打印信息，我们可以直接调用日志记录方法：</p>
<table>
<thead>
<tr>
<th>等级</th>
<th>使用场景</th>
</tr>
</thead>
<tbody><tr>
<td>DEBUG</td>
<td>详细信息，通常只有在诊断问题时才有意义</td>
</tr>
<tr>
<td>INFO</td>
<td>确认事情按预期工作</td>
</tr>
<tr>
<td>WARNING</td>
<td>表示发生了意想不到的事情，或者指示在不久的将来出现问题（例如，“磁盘空间不足”）。该软件仍在按预期工作</td>
</tr>
<tr>
<td>ERROR</td>
<td>由于更严重的问题，软件还没有能够执行一些功能</td>
</tr>
<tr>
<td>CRITICAL</td>
<td>一个严重的错误，表明程序本身可能无法继续运行</td>
</tr>
</tbody></table>
<p>这些方法名代表日志等级严重程度。最低严重等级是<code>debug</code>,最严重等级是<code>critical</code>。</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> logging</span><br><span class="line"></span><br><span class="line">logging.warning(<span class="string">&#x27;It is a warn message!&#x27;</span>)</span><br><span class="line">logging.info(<span class="string">&#x27;It is a info message!&#x27;</span>)</span><br></pre></td></tr></table></figure>
<p>你将看到：</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">WARNING:root:It is a warn message!</span><br></pre></td></tr></table></figure>
<p><code>logging.warning()</code>方法的信息被打印了，但<code>logging.info()</code>方法信息没有被打印出来。</p>
<p>这是因为在<code>logging</code>模块默认等级是<code>WARNING</code>。低于这个等级的日志记录方法信息不会被跟踪。</p>
<h3 id="logging-basicConfig"><a href="#logging-basicConfig" class="headerlink" title="logging.basicConfig"></a><a target="_blank" rel="noopener" href="https://docs.python.org/3/library/logging.html#logging.basicConfig">logging.basicConfig</a></h3><p>可以通过<code>logging.basicConfig(**kwargs)</code>对logging`进行配置。</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> logging</span><br><span class="line"></span><br><span class="line">logging.basicConfig(filename=<span class="string">&#x27;example.log&#x27;</span>,level=logging.DEBUG)</span><br><span class="line"></span><br><span class="line">logging.debug(<span class="string">&#x27;This message should go to the log file&#x27;</span>)</span><br><span class="line">logging.info(<span class="string">&#x27;So should this&#x27;</span>)</span><br><span class="line">logging.warning(<span class="string">&#x27;And this, too&#x27;</span>)</span><br></pre></td></tr></table></figure>
<p>上面的代码会将日志信息写入到<strong>example.log</strong> 文件中，里面内容如下：</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">DEBUG:root:This message should go to the log file</span><br><span class="line">INFO:root:So should this</span><br><span class="line">WARNING:root:And this, too</span><br></pre></td></tr></table></figure>
<p>我们通过<code>basicConfig()</code>方法指定了<code>logging</code>的等级为<code>DEBUG</code>，并且将信息写入<strong>example.log</strong> 文件中。</p>
<p>你多次调用上面的脚本，日志会向<strong>example.log</strong> 文件尾部添加。如果你希望每调用一次脚本，日志能覆盖原因文件内容，应该指定文件操作模式<code>filemode</code>。配置应该如下：</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">logging.basicConfig(filename=<span class="string">&#x27;example.log&#x27;</span>, filemode=<span class="string">&#x27;w&#x27;</span>, level=logging.DEBUG)</span><br></pre></td></tr></table></figure>

<p>默认日志输出格式是:<code>[levelname]:[name]:[message]</code>。通过<code>basicConfig</code>我们可以指定日志输出格式。</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> logging</span><br><span class="line">logging.basicConfig(<span class="built_in">format</span>=<span class="string">&#x27;%(asctime)s :%(levelname)% : %(name)% : %(message)s&#x27;</span>, datefmt=<span class="string">&#x27;%Y-%m/-%d %I:%M:%S %p&#x27;</span>,filename=<span class="string">&#x27;example.log&#x27;</span>,level=logging.DEBUG)</span><br><span class="line">logging.warning(<span class="string">&#x27;is when this event was logged.&#x27;</span>)</span><br><span class="line"></span><br><span class="line"><span class="comment">#2017-12-14 11:41:42 AM：WARNING: root : is when this event was logged.</span></span><br></pre></td></tr></table></figure>
<p>将日志记录时间也记录下来了。</p>
<h3 id="记录变量数据"><a href="#记录变量数据" class="headerlink" title="记录变量数据"></a>记录变量数据</h3><p>记录变量有三种写法<code>%</code>,<code>$</code>,<code>&#123;</code>：</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> logging</span><br><span class="line"></span><br><span class="line">logging.warning(<span class="string">&#x27;%s before you %s&#x27;</span>,<span class="string">&#x27;look&#x27;</span>,<span class="string">&#x27;leap!&#x27;</span>)</span><br><span class="line">logging.warning(<span class="string">&#x27;&#123;0&#125; before you &#123;1&#125;&#x27;</span>,<span class="string">&#x27;look&#x27;</span>,<span class="string">&#x27;leap!&#x27;</span>)</span><br><span class="line">logging.warning(<span class="string">&#x27;$a before you $b&#x27;</span>,a=<span class="string">&#x27;look&#x27;</span>,b=<span class="string">&#x27;leap!&#x27;</span>)</span><br></pre></td></tr></table></figure>
<p>Python3.2以后才支持<code>&#123;</code>和<code>$</code>写法。使用规则是<a target="_blank" rel="noopener" href="https://docs.python.org/3/library/stdtypes.html#str.format"><code>str.format()</code></a>和<a target="_blank" rel="noopener" href="https://docs.python.org/3/library/string.html#string.Template"><code>string.Template</code></a></p>
<h2 id="高级模式"><a href="#高级模式" class="headerlink" title="高级模式"></a><a target="_blank" rel="noopener" href="https://docs.python.org/3/howto/logging.html#logging-advanced-tutorial">高级模式</a></h2><p><code>logging</code>库使用模块方式提供四种组件用于定制日志系统：</p>
<ul>
<li><code>loggers</code> - 记录器，暴露给应用程序直接调用的接口。</li>
<li><code>handler </code> - 处理器，将记录器日志发送给合适的目的地。</li>
<li><code>filter</code> - 过滤器，提供更好的粒度设施来确定要输出的日志记录。</li>
<li><code>formatters</code> - 格式化器，指定最终输出中日志记录的布局。</li>
</ul>
<p>日志信息是在<a target="_blank" rel="noopener" href="https://docs.python.org/3/library/logging.html#logging.LogRecord"><code>LogRecord</code></a>实例的<code>loggers</code>,<code>handlers</code>,<code>filters</code>,<code>formatters </code>之间传递的。</p>
<p><code>logger</code>记录器是日志记录系统中执行开始单元。记录器是<a target="_blank" rel="noopener" href="https://docs.python.org/3/library/logging.html#logging.Logger"><code>Logger</code></a>类的实例化。通过<code>logging.getLogger(name)</code>获得。</p>
<h3 id="Logging工作流"><a href="#Logging工作流" class="headerlink" title="Logging工作流"></a>Logging工作流</h3><p>Logging工作流程图如下：</p>
<p><img src="https://docs.python.org/3/_images/logging_flow.png" alt="Logging flow"></p>
<p>使用<code>Logging</code>模块的全局作用域中的<code>getLogger</code>函数获得<code>Logger</code>实例。使用<code>Logger</code>对象中的<code>debug</code>,<code>info</code>,<code>error</code>,<code>warn</code>,<code>critical</code>等方法记录日志信息。</p>
<p>当调用日志记录方法后：</p>
<ul>
<li>判断日志的等级是否大于Logger对象设置的等级，如果大于则继续执行，否则结束。</li>
<li>产生日志。</li>
<li>记录器连接的过滤器是否拒绝记录，如果<code>yes</code>则结束，否则继续。</li>
<li>将日志传递给当前logger绑定的处理器，如果当前logger有处理器就交给处理器处理。</li>
<li>当前logger是否允许将日志传播给父级，如果<code>yes</code>则查找父级logger,如果找到将日志传递给父级处理器处理。</li>
<li>处理器接收到日志，先判断日志等级是否大于处理器设置的等级，如果大于则继续否则结束掉。</li>
<li>处理器将可以处理的日志交给于自己绑定的过滤器，如果过滤器拒绝则结束。</li>
<li>处理器的过滤器通过日志筛选，则日志最后按照处理器设定的打印格式输出到设定的目的地。</li>
</ul>
<h3 id="Loggers"><a href="#Loggers" class="headerlink" title="Loggers"></a><a target="_blank" rel="noopener" href="https://docs.python.org/3/howto/logging.html#loggers">Loggers</a></h3><p>Loggers实例是通过<code>logging.getLogger(name)</code>获得。它主要做三件事情：</p>
<ol>
<li>向应用代码提供运行时记录日志信息的方法。</li>
<li>根据严重性或通过过滤器确定采取的日志消息。</li>
<li>将日志信息传递给感兴趣的处理器</li>
</ol>
<p>logger对象的方法中分为两类：配置和发送信息。</p>
<h4 id="configuration"><a href="#configuration" class="headerlink" title="configuration"></a>configuration</h4><ul>
<li><a target="_blank" rel="noopener" href="https://docs.python.org/3/library/logging.html#logging.Logger.setLevel"><code>Logger.setLevel()</code></a>指定记录器处理日志的最低严重级别。</li>
<li><a target="_blank" rel="noopener" href="https://docs.python.org/3/library/logging.html#logging.Logger.addHandler"><code>Logger.addHandler()</code></a>和<a target="_blank" rel="noopener" href="https://docs.python.org/3/library/logging.html#logging.Logger.removeHandler"><code>Logger.removeHandler</code></a>给记录器添加或移除处理器。通过过滤的日志信息会交给处理器处理。处理器可以有多个，会依次执行处理日志信息。</li>
<li>[<code>Logger.addFilter()</code>]和[<code>Logger.removeFilter()</code>]添加或移除过滤器。通过记录器等级设置的日志信息会交给过滤器处理。过滤器可以有多个，会依次进行日志过滤。</li>
</ul>
<p>以上方法不是必须设定的。</p>
<p>记录日志方法有：</p>
<ul>
<li><code>Logger.debug()</code>,<code> Logger.info()</code>, <code>Logger.warning()</code>, <code>Logger.error()</code>, <code>Logger.critical()</code>。创建日志记录信息，根据它们名称代码严重等级。它们接收变量赋值。</li>
<li><a target="_blank" rel="noopener" href="https://docs.python.org/3/library/logging.html#logging.Logger.exception"><code>Logger.exception()</code></a>创建一个类似<code>Logger.error()</code>错误信息。但是它只能用于<code>exception</code>处理方法中。</li>
<li><a target="_blank" rel="noopener" href="https://docs.python.org/3/library/logging.html#logging.Logger.log"><code>Logger.log(lvl,msg)</code></a>接收整数参数（<strong>lvl</strong> ）作为信息等级。然后接收日志信息。一般用于记录大量日志信息。</li>
</ul>
<p>日志记录方法等级：</p>
<table>
<thead>
<tr>
<th>Level</th>
<th>Numeric value</th>
</tr>
</thead>
<tbody><tr>
<td>CRITICAL</td>
<td>50</td>
</tr>
<tr>
<td>ERROR</td>
<td>40</td>
</tr>
<tr>
<td>WARING</td>
<td>30</td>
</tr>
<tr>
<td>INFO</td>
<td>20</td>
</tr>
<tr>
<td>DEBUG</td>
<td>10</td>
</tr>
<tr>
<td>NOTSET</td>
<td>0</td>
</tr>
</tbody></table>
<p><a target="_blank" rel="noopener" href="https://docs.python.org/3/library/logging.html#logging.getLogger"><code>getLogger()</code></a>方法返回一个logger实例，如果不指定名称则默认时<strong>root</strong>。同一个名字调用多次<code>getLogger()</code>方法返回是同一个logger实例。</p>
<p>每个记录器有个名字，如果没有赋值默认是<code>root</code>。它们是<code>.</code>做为名字分隔符拥有上下级关系的空间结构。例如：一个记录器名字是<code>scan</code>,则它是<code>scan.html</code>,<code>scan.css</code>的父级。子级没有指定等级它会继承父级的等级。默认记录等级是(WARING)。</p>
<p><code>Logger</code>名字可以是任意形式的，这个记录器的名字就是创建它这块应用区域在日志系统中的名字。</p>
<p>记录器的名字用于追踪包或模块的层级，并直观的显示日志记录发生的位置。</p>
<p>记录器会将信息传播给父级记录器的处理器进行处理。你可以将<code>propagate </code>设为<code>Flase</code>关闭掉。</p>
<h3 id="Handlers"><a href="#Handlers" class="headerlink" title="Handlers"></a><a target="_blank" rel="noopener" href="https://docs.python.org/3/howto/logging.html#handlers">Handlers</a></h3><p><a target="_blank" rel="noopener" href="https://docs.python.org/3/library/logging.html#logging.Handler">Handler</a>对象目的是将日志信息（基于日志严重等级）分配到指定的目的地。<code>Logger</code>可以添加0个或多个<code>Handler</code>，通过<code>addHandler()</code>方法。例子：</p>
<p>一个脚本，需要将应用所有的日志信息写入日志文件，并将所有严重等级大于<code>higher</code>的日志使用标准方式输出，最后将<code>critical</code>等级的日志信息用邮件发送给指定邮箱。则这个脚本需要创建三个<code>handler</code>。</p>
<p>handler处理器拥有下这些方法：</p>
<ul>
<li><code>setLevel()</code>处理器处理等级</li>
<li><code>setFormatter()</code>处理器输出格式</li>
<li><code>addFilter()</code>和<code>removeFilter()</code>添加或移除绑定的过滤器。</li>
</ul>
<p>标准库已经包含了一些常用的处理<a target="_blank" rel="noopener" href="https://docs.python.org/3/howto/logging.html#useful-handlers">类型</a>(<a target="_blank" rel="noopener" href="https://docs.python.org/3/library/logging.handlers.html#logging.StreamHandler">StreamHandler</a> 和 <a target="_blank" rel="noopener" href="https://docs.python.org/3/library/logging.handlers.html#filehandler">FileHandler</a>)</p>
<h3 id="Formatters"><a href="#Formatters" class="headerlink" title="Formatters"></a><a target="_blank" rel="noopener" href="https://docs.python.org/3/howto/logging.html#formatters">Formatters</a></h3><p><a target="_blank" rel="noopener" href="https://docs.python.org/3/library/logging.html#logging.Formatter"><code>Formatter</code></a>对象负责配置日志消息的结构，顺序，内容。例子：</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> logging</span><br><span class="line">formatter = logging.Formatter(<span class="string">&#x27;%(asctime)s - %(name)s - %(levelname)s - %(message)s&#x27;</span>)</span><br></pre></td></tr></table></figure>
<p>上面代码指定了日志最后输出信息格式是：<code>当前时间-记录器名字-日志等级-日志信息</code>。</p>
<p>formatter支持变量如下：</p>
<table>
<thead>
<tr>
<th>Format</th>
<th>Description</th>
</tr>
</thead>
<tbody><tr>
<td><code>%(asctime)s</code></td>
<td>LogRecord创建时的可读时间</td>
</tr>
<tr>
<td><code>%(filename)s</code></td>
<td>文件名字</td>
</tr>
<tr>
<td><code>%(funcName)s</code></td>
<td>方法名</td>
</tr>
<tr>
<td><code>%(levelname)s</code></td>
<td>日志等级</td>
</tr>
<tr>
<td><code>%(levelno)s</code></td>
<td>日志等级数</td>
</tr>
<tr>
<td><code>%(lineno)d</code></td>
<td>记录调用发出的源行号</td>
</tr>
<tr>
<td><code>%(message)s</code></td>
<td>日志信息</td>
</tr>
<tr>
<td><code>%(module)s</code></td>
<td>模块名</td>
</tr>
<tr>
<td><code>%(name)s</code></td>
<td>记录器名字</td>
</tr>
<tr>
<td><code>%(pathname)s</code></td>
<td>发出日志记录调用的源文件的完整路径名（如果可用）。</td>
</tr>
<tr>
<td><code>%(process)d</code></td>
<td>进程ID（如果可用）</td>
</tr>
<tr>
<td><code>%(processName)s</code></td>
<td>进程名字</td>
</tr>
</tbody></table>
<h3 id="Configuring-Logging"><a href="#Configuring-Logging" class="headerlink" title="Configuring Logging"></a>Configuring Logging</h3><p>配置<code>logging</code>有三种方式：</p>
<ol>
<li>通过在Python 代码创建 loggers,handlers,formatters，使用配合方法将它们联系起来。</li>
<li>通过logging配置文件，然后通过<a target="_blank" rel="noopener" href="https://docs.python.org/3/library/logging.config.html#logging.config.fileConfig"><code>fileConfig()</code></a>方法读取。</li>
<li>创建一个字典类型的配置项，传给<a target="_blank" rel="noopener" href="https://docs.python.org/3/library/logging.config.html#logging.config.dictConfig"><code>dictConfig()</code></a>方法。</li>
</ol>
<p>在Python代码配置Logging规则：</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> logging</span><br><span class="line"></span><br><span class="line"><span class="comment"># 创建 logger</span></span><br><span class="line">logger = logging.getLogger(<span class="string">&#x27;simple_example&#x27;</span>)</span><br><span class="line">logger.setLevel(logging.DEBUG)</span><br><span class="line"></span><br><span class="line"><span class="comment"># 创建标准输出和DEBUG等级</span></span><br><span class="line">ch = logging.StreamHandler()</span><br><span class="line">ch.setLevel(logging.DEBUG)</span><br><span class="line"></span><br><span class="line"><span class="comment"># 创建规则</span></span><br><span class="line">formatter = logging.Formatter(<span class="string">&#x27;%(asctime)s - %(name)s - %(levelname)s - %(message)s&#x27;</span>)</span><br><span class="line"></span><br><span class="line"><span class="comment"># 将规则添加 进 ch 处理器</span></span><br><span class="line">ch.setFormatter(formatter)</span><br><span class="line"></span><br><span class="line"><span class="comment"># logger 绑定处理器</span></span><br><span class="line">logger.addHandler(ch)</span><br><span class="line"></span><br><span class="line"><span class="comment"># &#x27;application&#x27; code</span></span><br><span class="line">logger.debug(<span class="string">&#x27;debug message&#x27;</span>)</span><br><span class="line">logger.info(<span class="string">&#x27;info message&#x27;</span>)</span><br><span class="line">logger.warn(<span class="string">&#x27;warn message&#x27;</span>)</span><br><span class="line">logger.error(<span class="string">&#x27;error message&#x27;</span>)</span><br><span class="line">logger.critical(<span class="string">&#x27;critical message&#x27;</span>)</span><br></pre></td></tr></table></figure>
<p>运行自个模块，在命令行会输出这些：</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">$</span><span class="bash"> python simple_logging_module.py</span></span><br><span class="line">2005-03-19 15:10:26,618 - simple_example - DEBUG - debug message</span><br><span class="line">2005-03-19 15:10:26,620 - simple_example - INFO - info message</span><br><span class="line">2005-03-19 15:10:26,695 - simple_example - WARNING - warn message</span><br><span class="line">2005-03-19 15:10:26,697 - simple_example - ERROR - error message</span><br><span class="line">2005-03-19 15:10:26,773 - simple_example - CRITICAL - critical message</span><br></pre></td></tr></table></figure>

<p>通过<code>fileConfig()</code>加载配置规则：</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> logging</span><br><span class="line"><span class="keyword">import</span> logging.config</span><br><span class="line"></span><br><span class="line">logging.config.fileConfig(<span class="string">&#x27;logging.conf&#x27;</span>)</span><br><span class="line"></span><br><span class="line"><span class="comment"># create logger</span></span><br><span class="line">logger = logging.getLogger(<span class="string">&#x27;simpleExample&#x27;</span>)</span><br><span class="line"></span><br><span class="line"><span class="comment"># &#x27;application&#x27; code</span></span><br><span class="line">logger.debug(<span class="string">&#x27;debug message&#x27;</span>)</span><br><span class="line">logger.info(<span class="string">&#x27;info message&#x27;</span>)</span><br><span class="line">logger.warn(<span class="string">&#x27;warn message&#x27;</span>)</span><br><span class="line">logger.error(<span class="string">&#x27;error message&#x27;</span>)</span><br><span class="line">logger.critical(<span class="string">&#x27;critical message&#x27;</span>)</span><br></pre></td></tr></table></figure>
<p>配置文件：</p>
<blockquote><p>[loggers] # 定义loggers<br>keys=root,simpleExample</p>
<p>[handlers] # 定义handlers<br>keys=consoleHandler</p>
<p>[formatters] # 定义formatters<br>keys=simpleFormatter</p>
<p>[logger_root] # root logger<br>level=DEBUG<br>handlers=consoleHandler</p>
<p>[logger_simpleExample] # simpleExample logger<br>level=DEBUG<br>handlers=consoleHandler<br>qualname=simpleExample<br>propagate=0</p>
<p>[handler_consoleHandler] # consoleHandler handler<br>class=StreamHandler<br>level=DEBUG<br>formatter=simpleFormatter<br>args=(sys.stdout,) # 处理器参数</p>
<p>[formatter_simpleFormatter] # simpleFormatter formatter<br>format=%(asctime)s - %(name)s - %(levelname)s - %(message)s<br>datefmt=</p>
</blockquote>    

<p>它的输出和非文件配置几乎一样：</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">$</span><span class="bash"> python simple_logging_config.py</span></span><br><span class="line">2005-03-19 15:38:55,977 - simpleExample - DEBUG - debug message</span><br><span class="line">2005-03-19 15:38:55,979 - simpleExample - INFO - info message</span><br><span class="line">2005-03-19 15:38:56,054 - simpleExample - WARNING - warn message</span><br><span class="line">2005-03-19 15:38:56,055 - simpleExample - ERROR - error message</span><br><span class="line">2005-03-19 15:38:56,130 - simpleExample - CRITICAL - critical message</span><br></pre></td></tr></table></figure>
<p>配置文件格式规则是<a target="_blank" rel="noopener" href="https://docs.python.org/3/library/configparser.html#module-configparser"><code>configparser</code></a>。<br>配置文件将配置项从python代码中抽离出来，更便于管理和修改。</p>
<p><code>fileConfig()</code>有个默认参数<code>disable_existing_loggers</code>默认为<code>True</code>。它会导致在<code>fileConfig()</code>之前存在的<code>loggers</code>失效。将它设为<code>False</code>就可以了。</p>
<h2 id="重复打印"><a href="#重复打印" class="headerlink" title="重复打印"></a>重复打印</h2><p>在日志系统中因为我们代码写法不慎，经常会导致日志重复打印。</p>
<h3 id="basicConfig"><a href="#basicConfig" class="headerlink" title="basicConfig()"></a>basicConfig()</h3><p>basicConfig()方法时系统会默认创建一个handler，如果你再添加一个控制台handler时就会出现重复日志。</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> logging</span><br><span class="line"> </span><br><span class="line">logging.basicConfig(level=logging.DEBUG)</span><br><span class="line"> </span><br><span class="line">fmt = <span class="string">&#x27;%(levelname)s:%(message)s&#x27;</span></span><br><span class="line">console_handler = logging.StreamHandler()</span><br><span class="line">console_handler.setFormatter(logging.Formatter(fmt))</span><br><span class="line">logging.getLogger().addHandler(console_handler)</span><br><span class="line"> </span><br><span class="line">logging.info(<span class="string">&#x27;hello!&#x27;</span>)</span><br><span class="line"> </span><br><span class="line"><span class="comment"># INFO:root:hello!</span></span><br><span class="line"><span class="comment"># INFO:hello!</span></span><br></pre></td></tr></table></figure>

<h3 id="handler"><a href="#handler" class="headerlink" title="handler"></a>handler</h3><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> logging</span><br><span class="line"> </span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">get_logger</span>():</span></span><br><span class="line">    fmt = <span class="string">&#x27;%(levelname)s:%(message)s&#x27;</span></span><br><span class="line">    console_handler = logging.StreamHandler()</span><br><span class="line">    console_handler.setFormatter(logging.Formatter(fmt))</span><br><span class="line">    logger = logging.getLogger(<span class="string">&#x27;App&#x27;</span>)</span><br><span class="line">    logger.setLevel(logging.INFO)</span><br><span class="line">    logger.addHandler(console_handler)</span><br><span class="line">    <span class="keyword">return</span> logger</span><br><span class="line"> </span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">call_me</span>():</span></span><br><span class="line">    logger = get_logger()</span><br><span class="line">    logger.info(<span class="string">&#x27;hi&#x27;</span>)</span><br><span class="line"> </span><br><span class="line">call_me()</span><br><span class="line">call_me()</span><br><span class="line"> </span><br><span class="line"><span class="comment"># INFO:hi</span></span><br><span class="line"><span class="comment"># INFO:hi</span></span><br><span class="line"><span class="comment"># INFO:hi</span></span><br></pre></td></tr></table></figure>
<p>每次调用get_logger()方法时都会给它加一个新的handler。则一天信息就会经过累加的处理器。全局只配置<code>logger</code>一次。</p>
<h3 id="root"><a href="#root" class="headerlink" title="root"></a>root</h3><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> logging</span><br><span class="line"> </span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">get_logger</span>():</span></span><br><span class="line">    fmt = <span class="string">&#x27;%(levelname)s: %(message)s&#x27;</span></span><br><span class="line">    console_handler = logging.StreamHandler()</span><br><span class="line">    console_handler.setFormatter(logging.Formatter(fmt))</span><br><span class="line">    logger = logging.getLogger(<span class="string">&#x27;App&#x27;</span>)</span><br><span class="line">    logger.setLevel(logging.INFO)</span><br><span class="line">    logger.addHandler(console_handler)</span><br><span class="line">    <span class="keyword">return</span> logger</span><br><span class="line"> </span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">foo</span>():</span></span><br><span class="line">    logging.basicConfig(<span class="built_in">format</span>=<span class="string">&#x27;[%(name)s]: %(message)s&#x27;</span>)</span><br><span class="line">    logging.warn(<span class="string">&#x27;some module use root logger&#x27;</span>)</span><br><span class="line"> </span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">main</span>():</span></span><br><span class="line">    logger = get_logger()</span><br><span class="line">    logger.info(<span class="string">&#x27;App start.&#x27;</span>)</span><br><span class="line">    foo()</span><br><span class="line">    logger.info(<span class="string">&#x27;App shutdown.&#x27;</span>)</span><br><span class="line"> </span><br><span class="line">main()</span><br><span class="line"> </span><br><span class="line"><span class="comment"># INFO: App start.</span></span><br><span class="line"><span class="comment"># [root]: some module use root logger</span></span><br><span class="line"><span class="comment"># INFO: App shutdown.</span></span><br><span class="line"><span class="comment"># [App]: App shutdown.</span></span><br></pre></td></tr></table></figure>
<p>为嘛最后的App shutdown打印了两次？<br>只要你在程序中使用过root logger，那么默认你打印的所有日志都算它一份。</p>

      
    </div>

    
      
      

  <div class="post-copyright">
    <p class="copyright-item">
      <span>作者: </span>
      <span>Fynn</span>
    </p>
    <p class="copyright-item">
      <span>来源: </span>
      <a href="https://fynn90.github.io">https://fynn90.github.io</a>
    </p>
    <p class="copyright-item">
      <span>链接: </span>
      <a href="https://fynn90.github.io/2017/12/15/python-logging%20/">https://fynn90.github.io/2017/12/15/python-logging%20/</a>
    </p>

    <p class="copyright-item lincese">
      
      本文采用<a rel="license" href="http://creativecommons.org/licenses/by-nc/4.0/" target="_blank">知识共享署名-非商业性使用 4.0 国际许可协议</a>进行许可
    </p>
  </div>



      
      
  <div class="post-reward">
    <input type="checkbox" name="reward" id="reward" hidden />
    <label class="reward-button" for="reward">赞赏支持</label>
    <div class="qr-code">
      
      
        <label class="qr-code-image" for="reward">
          <img class="image" src="/image/reward/wechat.png" title="wechat">
          <div>wechat</div>
        </label>
      
      
        <label class="qr-code-image" for="reward">
          <img class="image" src="/image/reward/alipay.png" title="alipay">
          <div>alipay</div>
        </label>
      
    </div>
  </div>

    

    
      <footer class="post-footer">
        
          <div class="post-tags">
            
              <a href="/tags/Python-Logging/">Python-Logging</a>
            
          </div>
        
        
        
  <nav class="post-nav">
    
      <a class="prev" href="/2017/12/25/Nginx%E5%85%A5%E9%97%A8%E6%8C%87%E5%8D%97/">
        <i class="iconfont icon-left"></i>
        <span class="prev-text nav-default">Nginx入门指南</span>
        <span class="prev-text nav-mobile">上一篇</span>
      </a>
    
    
      <a class="next" href="/2017/12/12/Flask-SQLAlchemy/">
        <span class="next-text nav-default">Flask-SQLAlchemy</span>
        <span class="prev-text nav-mobile">下一篇</span>
        <i class="iconfont icon-right"></i>
      </a>
    
  </nav>

      </footer>
    

  </article>


          </div>
          
  <div class="comments" id="comments">
    
  </div>


        </div>  
      </main>

      <footer id="footer" class="footer">

  <div class="social-links">
    
      
        
          <a href="mailto:iamfatefan@outlook.com" class="iconfont icon-email" title="email"></a>
        
      
    
      
    
      
    
      
    
      
        
          <a target="_blank" rel="noopener" href="https://www.linkedin.com/in/%E5%B8%86-%E9%82%93-17163589/" class="iconfont icon-linkedin" title="linkedin"></a>
        
      
    
      
        
          <a target="_blank" rel="noopener" href="https://plus.google.com/u/0/117459332873536225443" class="iconfont icon-google" title="google"></a>
        
      
    
      
        
          <a target="_blank" rel="noopener" href="https://github.com/fatefan" class="iconfont icon-github" title="github"></a>
        
      
    
      
        
          <a target="_blank" rel="noopener" href="http://www.weibo.com/306019091" class="iconfont icon-weibo" title="weibo"></a>
        
      
    
      
        
          <a target="_blank" rel="noopener" href="https://www.zhihu.com/people/FynnDeng/activities" class="iconfont icon-zhihu" title="zhihu"></a>
        
      
    
      
    
    
    
  </div>


<div class="copyright">
  
  <span class="copyright-year">
    
    &copy; 
     
      2017 - 
    
    2021

    <span class="heart">
      <i class="iconfont icon-heart"></i>
    </span>
    <span class="author">Fynn</span>
  </span>
  
</div>
      </footer>

      <div class="back-to-top" id="back-to-top">
        <i class="iconfont icon-up"></i>
      </div>
    </div>

    
  

  
  




    
  





  
    <script type="text/javascript" src="/lib/jquery/jquery-3.1.1.min.js"></script>
  

  
    <script type="text/javascript" src="/lib/slideout/slideout.js"></script>
  

  
    <script type="text/javascript" src="/lib/fancybox/jquery.fancybox.pack.js"></script>
  


    <script type="text/javascript" src="/js/src/even.js?v=1.1.2"></script>
<script type="text/javascript" src="/js/src/bootstrap.js?v=1.1.2"></script>

    
  </body>
</html>
